"use strict";(self.webpackChunkvk=self.webpackChunkvk||[]).push([[64892],{891047:(e,t,r)=>{function s(e){return new Promise(((t,r)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>r(e.error)}))}function n(e,t){const r=indexedDB.open(e);r.onupgradeneeded=()=>r.result.createObjectStore(t);const n=s(r);return(e,r)=>n.then((s=>r(s.transaction(t,e).objectStore(t))))}let a;function o(){return a||(a=n("keyval-store","keyval")),a}function i(e,t=o()){return t("readonly",(t=>s(t.get(e))))}function c(e,t,r=o()){return r("readwrite",(r=>(r.put(t,e),s(r.transaction))))}function l(e,t,r=o()){return r("readwrite",(r=>new Promise(((n,a)=>{r.get(e).onsuccess=function(){try{r.put(t(this.result),e),n(s(r.transaction))}catch(e){a(e)}}}))))}function d(e,t=o()){return t("readwrite",(t=>(t.delete(e),s(t.transaction))))}function p(e=o()){return e("readwrite",(e=>(e.clear(),s(e.transaction))))}r.d(t,{clear:()=>p,createStore:()=>n,del:()=>d,get:()=>i,set:()=>c,update:()=>l})},904443:(e,t,r)=>{r.d(t,{VKWebAppCustomMessage:()=>s.VKWebAppCustomMessage,getStore:()=>n.getStore});var s=r(30757),n=r(684762)},684762:(e,t,r)=>{r.d(t,{getStore:()=>o});var s=r(798116),n=r(367431);function a(){return{onOrdData:(0,s.createDomain)("APPS_CONNECT/VKWebAppCustomMessage").createEvent()}}function o(){return(0,n.makeSharedState)("static/js/modules/shared/apps_connect/handlers/VKWebAppCustomMessage/store.ts",a,{version:0})()}},396316:(e,t,r)=>{r.d(t,{STICKERS_CONFDATA_KEY:()=>s,isNewStickerPicker:()=>a,isPromoVmojiCounterEnabled:()=>i,isUGCStickersEnabled:()=>o});var s,n=r(839470);function a(){return(0,n.partConfigEnabled)("new_sticker_picker")}function o(){return(0,n.partConfigEnabled)("stickers.ugc")}function i(){return(0,n.partConfigEnabled)("vmoji.promo.avatar_suggestion.promo_counter")}!function(e){e.UGC="stickers.ugc",e.PROMO_VMOJI_COUNTER="vmoji.promo.avatar_suggestion.promo_counter",e.NEW_STICKER_PICKER="new_sticker_picker"}(s||(s={}))},390433:(e,t,r)=>{r.d(t,{hideSnackbar:()=>k,showSnackbar:()=>R});var s=r(11010),n=r(785893),a=r(667294),o=r(973935),i=r(800325),c=r(228042),l=r(417873),d=r(773693),p=r(667465),h=r(584356),u=r(786858);const _={top:"notifier_snackbar_align_top",center:"notifier_snackbar_align_center",bottom:"notifier_snackbar_align_bottom"},m={ok:(0,i.getIcon24CheckCircleOutline)().icon,warning:(0,c.getIcon24WarningTriangleOutline)().icon,error:(0,l.getIcon24ErrorCircleOutline)().icon,ok28:(0,d.getIcon28CheckCircleOutline)().icon,loudspeaker28:(0,p.getIcon28LoudspeakerSlashOutline)().icon},E={ok:"notifier_snackbar_type_ok",warning:"notifier_snackbar_type_warning",error:"notifier_snackbar_type_error",ok28:"notifier_snackbar_type_ok",loudspeaker28:"notifier_snackbar_type_loudspeaker"};function R(e){return v.apply(this,arguments)}function v(){return(v=(0,s._)((function*({id:e,type:t,text:r,subtitle:s,action:a,before:o,after:i,link:c,timeout:l,align:d,onClick:p,onClose:R}){var v,k,b;let C;yield Promise.resolve();const A={id:e,link:O(c),timeout:l,onClick:p?()=>((0,u.assertNotNull)(C),p(C)):void 0,onHide:R},N={author_link:O(null==(k=o)||null==(v=k.avatar)?void 0:v.link),add_photo:O(null==(b=i)?void 0:b.url),tooltipHandler:e=>{var r,s,n,c,l,p,h,R,v,k;e.classList.add("notifier_snackbar"),t&&m[t]?(e.classList.add("notifier_snackbar_with_custom_before"),e.classList.add(E[t])):(null==(s=o)||null==(r=s.avatar)?void 0:r.url)||(null==(c=o)||null==(n=c.avatar)?void 0:n.content)?o.avatar.fill&&e.classList.add("notifier_snackbar_with_filled_avatar"):!(null==(p=o)||null==(l=p.avatar)?void 0:l.content)&&(null==(h=o)?void 0:h.content)&&e.classList.add("notifier_snackbar_with_custom_before"),(null==(k=null==(R=i)?void 0:R.rounded)||k)&&e.classList.add("notifier_snackbar_with_rounded_after");const S=d?_[d]:void 0;if(S&&e.classList.add(S),null==(v=a)?void 0:v.onClick){var O;null==(O=e.querySelector(".notifier_snackbar_action"))||O.addEventListener("click",(e=>{var t,r;(0,u.assertNotNull)(C),null==(t=(r=a).onClick)||t.call(r,e,C)}))}}};if(t&&m[t])N.avatar_custom_content=m[t];else if(o){var f,y,w,I;(null==(f=o.avatar)?void 0:f.url)?N.author_photo=O(o.avatar.url):(null==(y=o.avatar)?void 0:y.content)?N.avatar_custom_content=S(o.avatar.content):o.content&&(N.avatar_custom_content=S(o.content)),(null==(w=o.icon)?void 0:w.type)?N.icon_type=o.icon.type:(null==(I=o.icon)?void 0:I.url)&&(N.icon_custom={image_url:g(o.icon.url)})}const M=S((0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"notifier_snackbar_text",children:r}),s&&(0,n.jsx)("div",{className:"notifier_snackbar_subtitle",children:s}),a&&(0,n.jsx)("div",{children:(0,n.jsx)("a",{className:"notifier_snackbar_action",href:a.href,children:a.label})})]}));return C=yield(0,h.showDoneBoxAsync)(M,A,N),C}))).apply(this,arguments)}function k(e){var t;null==(t=window.Notifier)||t.hideEvent(e)}function S(e){const t=document.createElement("div");return(0,o.flushSync)((()=>{(0,o.render)((0,a.createElement)(a.Fragment,null,e),t)})),t.innerHTML}function O(e){return e&&g(e)}function g(e){return encodeURI(e).replace(/'/g,"%27")}},827502:(e,t,r)=>{r.d(t,{handleOrdMiniappOpen:()=>c});var s=r(96824),n=r(120718),a=r(29271),o=r(904443),i=r(390433);const c=(e,t,r)=>{var c,l,d,p,h;const u=e?(0,s.objectToQuerystring)(e,"#"):"";null==(p=(h=window).showWiki)||p.call(h,{w:`app${n.ORD_APP_ID}${u}`},null==(c=r)?void 0:c.edit,null==(l=r)?void 0:l.ev,null==(d=r)?void 0:d.options);const _=(0,o.getStore)().onOrdData.watch((s=>{var n,o,c,l,d,p;(null==(n=r)?void 0:n.isSnackbar)&&((null==(c=s)?void 0:c.is_ad)&&!(null==(l=e)?void 0:l.is_ad)?(0,i.showSnackbar)({text:a.getLang("global_ads_wall_post_ord_mark_as_ads_added"),timeout:3e3,type:"ok28"}):!(null==(d=s)?void 0:d.is_ad)&&(null==(p=e)?void 0:p.is_ad)&&(0,i.showSnackbar)({text:a.getLang("global_ads_wall_post_ord_mark_as_ads_removed"),timeout:3e3,type:"loudspeaker28"}));t(s,null==(o=r)?void 0:o.ref),_()}))}},800325:(e,t,r)=>{function s(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M14.96 9.26a.9.9 0 0 1 1.28 1.28l-4.6 4.6a.9.9 0 0 1-1.28 0l-2.6-2.6a.9.9 0 0 1 1.28-1.28L11 13.23l3.96-3.97Z"/><path fill-rule="evenodd" d="M12 2.1a9.9 9.9 0 1 1 0 19.8 9.9 9.9 0 0 1 0-19.8Zm0 1.8A8.1 8.1 0 0 0 3.9 12a8.1 8.1 0 0 0 8.1 8.1 8.1 8.1 0 0 0 8.1-8.1A8.1 8.1 0 0 0 12 3.9Z" clip-rule="evenodd"/></svg>',name:"check_circle_outline_24"}}r.d(t,{getIcon24CheckCircleOutline:()=>s})},417873:(e,t,r)=>{function s(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M4.93 4.93A9.97 9.97 0 0 1 12 2a9.97 9.97 0 0 1 7.07 2.93A9.97 9.97 0 0 1 22 12a9.97 9.97 0 0 1-2.93 7.07A9.97 9.97 0 0 1 12 22a9.97 9.97 0 0 1-7.07-2.93A9.97 9.97 0 0 1 2 12a9.97 9.97 0 0 1 2.93-7.07ZM12 3.8a8.17 8.17 0 0 0-5.8 2.4A8.17 8.17 0 0 0 3.8 12a8.17 8.17 0 0 0 2.4 5.8 8.17 8.17 0 0 0 5.8 2.4 8.17 8.17 0 0 0 5.8-2.4 8.17 8.17 0 0 0 2.4-5.8 8.17 8.17 0 0 0-2.4-5.8A8.17 8.17 0 0 0 12 3.8ZM13 16a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm-1-9a.9.9 0 0 1 .9.9v5.2a.9.9 0 0 1-1.8 0V7.9A.9.9 0 0 1 12 7Z" clip-rule="evenodd"/></svg>',name:"error_circle_outline_24"}}r.d(t,{getIcon24ErrorCircleOutline:()=>s})},228042:(e,t,r)=>{function s(){return{icon:'<svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor"><path clip-rule="evenodd" d="M9.49 4.55a2.9 2.9 0 0 1 5.02 0l6.93 12a2.9 2.9 0 0 1-2.51 4.35H5.07a2.9 2.9 0 0 1-2.51-4.35zm3.46.9a1.1 1.1 0 0 0-1.9 0l-6.93 12c-.42.73.1 1.65.95 1.65h13.86c.85 0 1.37-.92.95-1.65z" fill-rule="evenodd"/><path clip-rule="evenodd" d="M12 8c.5 0 .9.37.9.84v4.82c0 .47-.4.84-.9.84s-.9-.37-.9-.84V8.84c0-.47.4-.84.9-.84z" fill-rule="evenodd"/><path d="M13 16.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/></g></svg>',name:"warning_triangle_outline_24"}}r.d(t,{getIcon24WarningTriangleOutline:()=>s})},773693:(e,t,r)=>{function s(){return{icon:'<svg width="28" height="28" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg"><g id="check_circle_outline_28__Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="check_circle_outline_28__check_circle_outline_28" fill-rule="nonzero"><path d="M0 0h28v28H0z"/><path d="M14 2a12 12 0 1 1 0 24 12 12 0 0 1 0-24Zm0 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20Zm4.29 6.29a1 1 0 0 1 1.42 0 1 1 0 0 1 0 1.42l-7 7a1 1 0 0 1-1.42 0l-3.5-3.5a1 1 0 0 1 1.42-1.42L12 16.6Z" id="check_circle_outline_28__Icon-Color" fill="currentColor"/></g></g></svg>',name:"check_circle_outline_28"}}r.d(t,{getIcon28CheckCircleOutline:()=>s})},667465:(e,t,r)=>{function s(){return{icon:'<svg fill="none" height="28" viewBox="0 0 28 28" width="28" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor"><path d="M21.46 7.16a1 1 0 0 1 1.38.3A1 1 0 0 1 23 8v12.35a1 1 0 1 0 2 0V8a3 3 0 0 0-4.61-2.53L16.42 8h-3.77a1 1 0 1 0 0 2H15v2.34a1 1 0 1 0 2 0V10z"/><path clip-rule="evenodd" d="M16.75 17.34a1.01 1.01 0 0 0-.09-.1L4.71 5.3A1 1 0 0 0 3.3 6.7L5.48 8.9c-.18.12-.34.25-.5.37a5.52 5.52 0 0 0-.37 8.12 5.49 5.49 0 0 0 2.98 1.53l.45 2.6a3 3 0 1 0 5.91-1.04L13.7 19h1.9l6.7 6.71a1 1 0 0 0 1.42-1.41zm-9.82-7a7.37 7.37 0 0 0-.9.68 3.49 3.49 0 0 0 0 4.95c.63.64 1.5 1.03 2.47 1.03h5.08zM10 21.17 9.63 19h2.03l.32 1.82a1 1 0 0 1-.8 1.16 1 1 0 0 1-1.17-.8z" fill-rule="evenodd"/></g></svg>',name:"loudspeaker_slash_outline_28"}}r.d(t,{getIcon28LoudspeakerSlashOutline:()=>s})},176518:(e,t,r)=>{r.d(t,{Handler:()=>h});var s=r(434788),n=r(611374),a=r(953151),o=r(574021),i=r(120718),c=r(404145),l=r(664988),d=r(193452),p=r(602033);class h{get successDescriptor(){return`${this.params.originalHandlerName||this.params.handlerName}Result`}get errorDescriptor(){return`${this.params.originalHandlerName||this.params.handlerName}Failed`}get previousCallsCount(){var e,t;return(null==(t=this.app)||null==(e=t.context)?void 0:e.getHandlerCallsCount(this.params.handlerName))-1||0}shouldLogStat(){return!0}getEventHash(e=!1){return cur.app.options[`${i.VK_CONNECT_EVENTS[`${this.params.handlerName}${e?"Preload":""}`]}_hash`]}getEventHashes(e=!1){return cur.app.options[`${i.VK_CONNECT_EVENTS[`${this.params.handlerName}${e?"Preload":""}`]}_hashes`]}getEventName(e=!1){return i.VK_CONNECT_EVENTS[`${this.params.handlerName}${e?"Preload":""}`]}sendNetworkError(){this.errorHandler({code:i.ERROR_CODES.UNKNOWN,error_type:i.ERROR_TYPES.CLIENT,reason:i.ERROR_REASONS.UNKNOWN_ERROR})}sendConnectionLostError(){this.errorHandler({code:i.ERROR_CODES.CONNECTION_LOST,error_type:i.ERROR_TYPES.CLIENT,reason:i.ERROR_REASONS.CONNECTION_LOST})}sendUserDeniedError(){this.errorHandler({code:i.ERROR_CODES.USER_DENIED,error_type:i.ERROR_TYPES.CLIENT,reason:i.ERROR_REASONS.USER_DENIED})}handleApiError(e){var t,r,s;const n=null==(t=e)?void 0:t.error,a=null==(r=n)?void 0:r.error_msg,o=null==(s=n)?void 0:s.error_code;if(o)switch(o){case p.API_ERROR_ACCESS:this.errorHandler({code:i.ERROR_CODES.ACCESS_DENIED,error_type:i.ERROR_TYPES.CLIENT,reason:a});break;case p.API_ERROR_PARAM:this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,error_type:i.ERROR_TYPES.CLIENT,reason:a});break;default:this.errorHandler({code:i.ERROR_CODES.CUSTOM,error_type:i.ERROR_TYPES.CLIENT,reason:a||i.ERROR_REASONS.UNKNOWN_ERROR})}else this.errorHandler({code:i.ERROR_CODES.CONNECTION_LOST,error_type:i.ERROR_TYPES.CLIENT,reason:a||i.ERROR_REASONS.UNKNOWN_ERROR})}sendCustomError(e){this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:e||i.ERROR_REASONS.UNKNOWN_ERROR})}checkParams(e,t){for(let r=0;r<t.length;r++){const{param:s,type:n,isRequired:a,extraChecks:o}=t[r];if(!e.hasOwnProperty(s)&&a)return this.errorHandler({code:i.ERROR_CODES.MISSING_PARAM,reason:`Missing required param "${s}"`}),!1;if(e.hasOwnProperty(s)&&typeof e[s]!==n)return this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:`Param "${s}" should be ${n}`},this.callback),!1;if(e.hasOwnProperty(s)&&o&&o.length>0)for(let t=0;t<o.length;t++)if(!o[t].check(e[s]))return this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:o[t].error(s)},this.callback),!1}return!0}actionHandler(e){return this.callApi?ajax.post("apps.php",(0,s._)({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},e),{onDone:t=>{this.handleResponse(t,e,this.checkResponse)},onFail:e=>(this.errorHandler(e),!0)}):{}}checkResponse(e){1===e||0===e?this.successHandler(Boolean(e)):this.successHandler(e)}scopeStringToArray(e){return e?e.replace(/ /g,"").split(","):[]}denyUIAction(){this.errorHandler({error_type:"client_error",code:i.ERROR_CODES.USER_DENIED},null),n.default.pop(this.modal)}allowUIAction(e){this.actionHandler(e),n.default.pop(this.modal)}createDenyUIAction(e){this.params.modal.cancelAction=void 0!==e?()=>this.denyUIAction(e):this.denyUIAction}createAllowUIAction(e){this.params.modal.allowAction=void 0!==e?()=>this.allowUIAction(e):this.allowUIAction}launchUI(e){this.createDenyUIAction(),this.createAllowUIAction(),this.modal=new o.UIAction((0,s._)({},this.params.modal,e)),n.default.push(this.modal)}_enhanceBtnsWithActions(){this.params.modal.buttons&&this.params.modal.buttons.forEach(((e,t)=>{"deny"===e.type?this.params.modal.buttons[t].action=this.params.modal.cancelAction:this.params.modal.buttons[t].action=this.params.modal.allowAction}))}setData(e,t,r=null){r&&(this.callback=r),e.request_id&&(this.params.request_id=e.request_id),this.params.modal||(this.params.modal={}),e.containerId&&(this.params.modal.containerId=e.containerId),e.pic&&(this.params.modal.pic=e.pic),this.app=t}handleResponse(e,t,r,s){try{const s=JSON.parse(e);s.hasOwnProperty("error")?this.errorHandler(s.error):r(s,t)}catch(e){s?s(e):this.errorHandler(e)}}handler(e,t,r){if(this.setData(e,t),this.callback=r,this.isWebOnly&&(0,c.isMvk)()||this.isMobileWebOnly&&!(0,c.isMvk)())return this.errorHandler({code:i.ERROR_CODES.UNSUPPORTED_PLATFORM,error_type:i.ERROR_TYPES.CLIENT,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM});this.useUI?this.launchUI(e):this.useUI||this.actionHandler(e)}getAppWebviewUrl(){return cur.app.frame.src}successHandler(e,t=void 0){t&&t(),(0,l.isObject)(e)||(e={result:e}),this.params.request_id&&e&&(e.request_id=this.params.request_id),this.callback({type:this.successDescriptor,data:e},this.params.handlerName),(0,c.isMvk)()&&cur.app.frame.focus(),this.shouldLogStat()&&d.bridgeEventItemStat.logEvent(this.getAppWebviewUrl(),this.app.appId,{event_type:this.params.handlerName,is_success:!0})}errorHandler(e,t,r){"string"==typeof e&&(e={reason:e}),this.params.request_id&&(e.request_id=this.params.request_id);const s=new a.default(this.errorDescriptor,e,r);t&&t(),this.callback(s.selectErrorType()),(0,c.isMvk)()&&cur.app.frame.focus(),this.shouldLogStat()&&d.bridgeEventItemStat.logEvent(this.getAppWebviewUrl(),this.app.appId,{event_type:this.params.handlerName,is_success:!1},{error_type:s.type||i.ERROR_TYPES.CLIENT,error_code:s.data.code||i.ERROR_CODES.UNKNOWN})}constructor(e={}){this.params=(0,s._)({handlerName:"handler",method:"method"},e),this.callApi=!0,this.useUI=!1,this.callback=null,this.modal=null,this.isWebOnly=!1,this.isMobileWebOnly=!1,this.actionHandler=this.actionHandler.bind(this),this.errorHandler=this.errorHandler.bind(this),this.successHandler=this.successHandler.bind(this),this.denyUIAction=this.denyUIAction.bind(this),this.allowUIAction=this.allowUIAction.bind(this),cur.vkAppSuccessHandler=this.successHandler,cur.vkAppErrorHandler=this.errorHandler,this.checkResponse=this.checkResponse.bind(this)}}},30757:(e,t,r)=>{r.d(t,{VKWebAppCustomMessage:()=>l});var s=r(829596),n=r(176518),a=r(396316),o=r(404145),i=r(120718),c=r(684762);class l extends n.Handler{actionHandler(e){if(e.action&&e.payload){if(this.app.isTextliveApp){var t;const r=null==(t=window.Textlives)?void 0:t.onBridgeEvent(e);return void(r&&r.then(this.successHandler).catch(this.errorHandler))}if(this.app.appId===i.NFT_APP_ID)return this.handleSetNftAvatar(e),void this.successHandler({result:!0});if(this.app.appId===i.ORD_APP_ID)return this.handleSetOrdData(e),void this.successHandler({result:!0});if(this.app.appId===i.VMOJI_CONSTRUCTOR_APP_ID)return this.handleOpenStickerPicker(e),void this.successHandler({result:!0})}this.errorHandler("unknown error")}handleSetNftAvatar({action:e,payload:t}){var r;"VKWebAppSetNFTAvatar"===e&&((0,o.isMvk)()?window.OwnerPhotoUpload2.setNftAvatar(t):window.ajax.post("al_page.php",{act:"owner_avatar_upload",oid:null==(r=t)?void 0:r.oid},{onDone:(e,r)=>{window.handleVKBridgeSetNftAvatar(t,e,r)}}))}handleOpenStickerPicker({action:e,payload:t}){if("vmoji_character_recereate"!==e)return;const{promo:r,page:n}=t;var i;r&&(0,a.isNewStickerPicker)()&&!(0,o.isMvk)()&&(window.StickerPickerViewer.showLastPicker(s.ServicePackKey.VMOJI),(null==(i=n)?void 0:i.match("/preview"))||window.stManager.add(window.jsc("web/vmoji.js")).then((()=>{window.Vmoji.showAddedToStickerSnackbar()})))}handleSetOrdData({action:e,payload:t}){"ord_data"===e&&t&&(0,c.getStore)().onOrdData({is_ad:t.isAd||!1,ord_pred_id:t.predId||"",erid:t.erId||""})}constructor(e){super(e),this.params.handlerName="VKWebAppCustomMessage"}}},611374:(e,t,r)=>{r.d(t,{default:()=>s});const s=new class{push(e){e.init(),this.checkStack(),0===cur.vkMiniAppsStack.length&&e.show(),cur.vkMiniAppsStack.push(e)}clearLayerPopups(){this.checkStack(),cur.vkMiniAppsStack.length>0&&(cur.vkMiniAppsStack=cur.vkMiniAppsStack.filter((e=>!~e.appNode.id.indexOf("container_layer"))))}pop(e){const t=cur.vkMiniAppsStack.indexOf(e);~t&&(cur.vkMiniAppsStack.splice(t,1),this.checkForNext())}shift(){cur.vkMiniAppsStack=cur.vkMiniAppsStack.slice(1),this.checkForNext()}checkForNext(){cur.vkMiniAppsStack.length>0&&cur.vkMiniAppsStack[0].show()}constructor(){this.checkStack=()=>{cur.vkMiniAppsStack||(cur.vkMiniAppsStack=[])},this.checkStack(),cur.clearVKMiniAppsLayerPopups=this.clearLayerPopups.bind(this)}}},574021:(e,t,r)=>{r.d(t,{CLOSE_BUTTON_MODES:()=>_,UIAction:()=>k,renderCounter:()=>R,setCounter:()=>v});var s=r(11010),n=r(434788),a=r(820224),o=r(404145),i=r(278534),c=r(662273),l=r(698250),d=r(827916),p=r(783905),h=r(676324),u=r(839470);const _={INNER:0,OUTER:1},m="deny",E="extra",R=e=>{const t=document.createElement("span");return t.classList.add("VkAppModal__buttonCounter"),t.innerText=e,t},v=(e,t)=>{const r=e.find((e=>e.hasCounter));r&&r.counterElement&&(r.counterElement.innerText=t)};class k{addScroll(){(0,i.addPopupScroll)(this.modal.children[0],this.modalParentLayer)}init(){this.containerNode&&this.containerNode.appendChild(this.modal),this.modalParentLayer=this.modal.closest(".layer_wrap"),this.modalParentLayer?this.modalParentLayer.addEventListener("scroll",this.addScroll):window.addEventListener("scroll",this.addScroll)}show(){(0,o.isMvk)()&&document.body.classList.add("vk_app_fixed"),this.props.withoutAnimation?this.modal.classList.add("show"):setTimeout((()=>this.modal.classList.add("show")),300),this.initMvkCloseActions(),this.addScroll()}initMvkCloseActions(){(0,o.isMvk)()&&(window.DirectGames&&cur.app.isDirectGame&&window.DirectGames.onBoxOpen(this),this.props.onlyButtonHide||(this.modal.onclick=e=>{e.target===this.modal&&this.onAction(this.props.cancelAction)}))}close(){this.props.onlyButtonHide||this.onAction(this.props.cancelAction)}destroy(){window.removeEventListener("scroll",this.addScroll),this.modalParentLayer&&this.modalParentLayer.removeEventListener("scroll",this.addScroll),this._destroyed||((0,o.isMvk)()&&(document.body.classList.remove("vk_app_fixed"),window.DirectGames&&cur.app.isDirectGame&&(window.DirectGames.onBoxClose(this),cur.app.frame.focus())),this.modal.parentNode.removeChild(this.modal),this.callback&&this.callback(),this._destroyed=!0)}_disableButton(e,t=!0){e.disabled=t,e.element.disabled=t}_lockButton(e,t=!0){const r=(0,o.isMvk)()?(0,l.getIcon24Spinner)().icon:(0,d.getIcon16Spinner)().icon,s=`\n    <span class="vk_app_modal_btn__content">${e.title}</span>\n    <span class="vk_app_modal_btn__spinner">${r}</span>\n    `;e.loading=t,e.element.innerHTML=t?s:e.title,e.element.classList.toggle("vk_app_modal_btn--loading",t)}onAction(e){var t=this;return(0,s._)((function*(){yield e(),t.destroy()}))()}lockButtons(e=!0){const t={success:this._lockButton,[m]:this._disableButton,[E]:this._disableButton};this.props.buttons.forEach((r=>t[r.type](r,e)))}_setCounter(e){v(this.props.buttons,e)}_renderBtn(e){const t=document.createElement("button");if(t.setAttribute("type","button"),t.classList.add("vk_app_modal_btn"),t.classList.add(`vk_app_modal_btn--${e.type}`),t.innerText=e.title,t.addEventListener("click",(()=>e.type===E?e.action():this.onAction(e.action))),e.hasCounter){const r=R(0);t.appendChild(r),e.counterElement=r}return e.element=t,e.disabled&&this._disableButton(e),e.loading&&this._lockButton(e),t}_renderBtns(e){const t=e.querySelector(".vk_app_modal_btns"),{buttons:r}=this.props;if(t){r.forEach((e=>t.appendChild(this._renderBtn(e))));const e=r.find((e=>e.type===E));1===r.length&&t.classList.add("vk_app_modal_btns--single-btn"),e&&t.classList.add("vk_app_modal_btns--hasExtraButton")}}_renderCloseBtn(e){const t=document.createElement("button");t.setAttribute("type","button"),t.classList.add("vk_app_modal_close_btn"),(0,o.isMvk)()||this.props.closeButtonMode!==_.OUTER?t.innerHTML=(0,h.getIcon24Cancel)().icon:(t.classList.add("vk_app_modal_close_btn--outer"),t.innerHTML=(0,p.getIcon20Cancel)().icon),t.addEventListener("click",(()=>this.onAction(this.props.cancelAction))),e.children[0].appendChild(t)}_renderCheckboxFields(e,t){const r=document.createElement("div");r.classList.add("MiniAppsCheckbox__fields");const s=document.createElement("h5");if(s.classList.add("MiniAppsCheckbox__fields-title"),s.innerHTML=e,r.appendChild(s),t){const e=document.createElement("h6");e.classList.add("MiniAppsCheckbox__fields-description"),e.innerHTML=t,r.appendChild(e)}return r}_renderCheckbox(e){const{title:t,description:r}=e,s=(0,a._)(e,["title","description"]),n=document.createElement("label");n.classList.add("MiniAppsCheckbox");const o=document.createElement("input");o.type="checkbox",o.classList.add("MiniAppsCheckbox__checkbox"),o.addEventListener("change",(t=>e.checked=t.target.checked)),n.appendChild(o),Object.entries(s).forEach((([e,t])=>{o[e]=t}));const i=document.createElement("div");i.classList.add("MiniAppsCheckbox__fake_checkbox"),n.appendChild(i);const c=this._renderCheckboxFields(t,r);return n.appendChild(c),n}_renderCheckboxWrap(e){const t=e.querySelector(".MiniAppsModalCheckbox");t&&this.props.checkbox.map((e=>t.appendChild(this._renderCheckbox(e))))}_renderOuter(){const e=document.createElement("div");return e.classList.add("vk_app_modal_outer"),e}_enhanceBtnsWithActions(){this.props.buttons&&this.props.buttons.forEach(((e,t)=>{e.type===m?this.props.buttons[t].action=this.props.cancelAction:e.type===E?this.props.buttons[t].action=this.props.extraAction:this.props.buttons[t].action=this.props.allowAction}))}_renderScopes(e){return e.map(((e,t)=>{const r=getLang(`vkapps_scope_${e}`);return 0===t?r:r.toLowerCase()})).join(", ")}prepareScopes(e){return 0===e.length?["general"]:e}prepareExtraBtn(){const e=document.createElement("button");return e.setAttribute("type","button"),e.classList.add("vk_app_modal_btn","VkAppModal__button--extra","vk_app_modal_btn--transparent"),e.innerHTML=getLang("apps_connect_modal_messages_scopes_edit"),e.addEventListener("click",this.props.extraAction),e}getThumb(){if(this.props.svgIcon)return this.props.svgIcon;const e=this.props.picClass?this.props.picClass:"";return this.props.pic?`<img src="${this.props.pic}" class="vk_app_modal_container__pic MiniAppModalContainer__pic ${e}" alt aria-label="product">`:""}isHorizontalLayoutSupported(){return(0,o.isMvk)()&&(0,u.partConfigEnabled)("vk_bridge_modals_horizontal_layout")}renderModal(){this.props.containerClass=this.props.containerClass||"",this.props.buttonsClass=this.props.buttonsClass||"",this.props.isGradientModal&&(0,o.isMvk)()&&(this.props.containerClass+=" MiniAppsGradientModal"),this.props.isNoWrapButtons&&(0,o.isMvk)()&&(this.props.buttonsClass+=" MiniAppsNoWrapButtons");const e=this.props.scopes&&this.props.scopes.length&&this.props.extraAction;this.isHorizontalLayoutSupported()&&(this.props.containerClass+=" VkAppModal__Container--horizontalSupport",e&&(this.props.containerClass+=" VkAppModal__Container--withExtraButton"));let t=`\n    <div class="vk_app_modal_container vk_app_modal_container--flex ${this.props.containerClass||""}">\n      <div class="vk_app_modal_content">\n        ${this.getThumb()}\n        <h2 class="vk_app_modal_container__heading">${this.props.title}</h2>\n        ${this._renderSubheading()}\n        ${this._renderTextSeparator()}\n        ${this._renderText(this.props.text)}\n      `;this.props.scopes&&(t+=`\n          <p class="vk_app_modal_container__text">${getLang("apps_connect_modal_messages_scopes_text")}</p>\n          <p class="vk_app_modal_container__list">${this._renderScopes(this.prepareScopes(this.props.scopes))}.</p>`),t+=`\n          </div>\n          ${this.props.checkbox?'<div class="MiniAppsModalCheckbox"></div>':""}\n          <div class="vk_app_modal_btns ${this.props.buttonsClass}"></div>\n      </div>`,this._enhanceBtnsWithActions(),this.modal=this._renderOuter(),this.modal.innerHTML=t,this.props.showCloseBtn&&this._renderCloseBtn(this.modal),e&&this.modal.getElementsByClassName("vk_app_modal_content")[0].appendChild(this.prepareExtraBtn()),this._renderBtns(this.modal),this.props.checkbox&&this._renderCheckboxWrap(this.modal),this.props.scopes&&this._setCounter(this.props.scopes.length)}_renderText(e){if(!e)return"";return(Array.isArray(e)?e:[e]).map((e=>`<p class="vk_app_modal_container__text">${e}</p>`)).join("")}_renderSubheading(){return this.props.subheading?`<h3 class="vk_app_modal_container__subheading">${this.props.subheading}</h3>`:""}_renderTextSeparator(){return this.props.isTextSeparated?'<div class="vk_app_modal_container__text_separator"></div>':""}constructor(e,t){this.props=(0,n._)({},e),t&&(this.callback=t),this.props.buttons=this.props.buttons||[],this.containerNode=document.getElementById(this.props.containerId),this.modal=null,this.modalParentLayer=null,this.onAction=this.onAction.bind(this),this.addScroll=(0,c.throttle)(this.addScroll.bind(this),i.THROTTLE_TIME),this.renderModal(),this._destroyed=!1}}},278534:(e,t,r)=>{r.d(t,{THROTTLE_TIME:()=>n,addPopupScroll:()=>a});var s=r(404145);const n=300,a=(e,t)=>{const r=t?t.scrollTop:window.pageYOffset,n=window.cur.app;if(n&&!(0,s.isMvk)()){const t=n.frame.clientHeight-360,s=Math.max(103,Math.min(r,t)+102);requestAnimationFrame((function(){e.style.transform=`translateX(-50%) translateY(${s}px)`}))}}},953151:(e,t,r)=>{r.d(t,{default:()=>n});var s=r(120718);const n=class{_errorStrucuture(e,t){let r={type:this.method,data:{error_type:this.type,error_data:{error_code:e}}};return this.type===s.ERROR_TYPES.API?(r.data.error_data.error_msg=t,this.data.request_params&&(r.data.error_data.request_params=this.data.request_params)):r.data.error_data.error_reason=t,this.data.request_id&&(r.data.request_id=this.data.request_id),this.data.description&&(r.data.error_data.error_description=this.data.description),r}selectErrorType(){if(!this.data.hasOwnProperty("code"))return this.data.hasOwnProperty("error_code")?this._errorStrucuture(this.data.error_code,this.data.error_msg||s.ERROR_REASONS.UNKNOWN_ERROR):this.data.error_msg&&"operation denied by user"===this.data.error_msg.toLowerCase()?this._errorStrucuture(s.ERROR_CODES.USER_DENIED,"User denied"):this._errorStrucuture(s.ERROR_CODES.UNKNOWN,this.data.reason||this.data.error_msg||s.ERROR_REASONS.UNKNOWN_ERROR);switch(this.data.code){case s.ERROR_CODES.MISSING_PARAM:return this._errorStrucuture(s.ERROR_CODES.MISSING_PARAM,this.data.reason||"Missing required params or wrong type of param");case s.ERROR_CODES.CONNECTION_LOST:return this._errorStrucuture(s.ERROR_CODES.CONNECTION_LOST,this.data.reason||s.ERROR_REASONS.CONNECTION_LOST);case s.ERROR_CODES.USER_DENIED:return this._errorStrucuture(s.ERROR_CODES.USER_DENIED,this.data.reason||s.ERROR_REASONS.USER_DENIED);case s.ERROR_CODES.INVALID_PARAMS:return this._errorStrucuture(s.ERROR_CODES.INVALID_PARAMS,this.data.reason||s.ERROR_REASONS.INVALID_PARAMS);case s.ERROR_CODES.ACCESS_DENIED:return this._errorStrucuture(s.ERROR_CODES.ACCESS_DENIED,this.data.reason||s.ERROR_REASONS.ACCESS_DENIED);case s.ERROR_CODES.CUSTOM:return this._errorStrucuture(s.ERROR_CODES.CUSTOM,this.data.reason||this.data.error_msg);case s.ERROR_CODES.REQUESTS_LIMIT_REACHED:return this._errorStrucuture(s.ERROR_CODES.REQUESTS_LIMIT_REACHED,"Requests limit reached");case s.ERROR_CODES.UNKNOWN:return this._errorStrucuture(s.ERROR_CODES.UNKNOWN,s.ERROR_REASONS.UNKNOWN_ERROR);default:return this._errorStrucuture(this.data.code?this.data.code:s.ERROR_CODES.UNKNOWN,this.data.reason||this.data.error_msg||s.ERROR_REASONS.UNKNOWN_ERROR)}}constructor(e,t,r=s.ERROR_TYPES.CLIENT){this.data=t||{},this.method=e,this.type=r}}},96824:(e,t,r)=>{r.d(t,{destroyOpenedApp:()=>o,filterPostMessageOrigin:()=>c,getHostName:()=>a,isAllowedPostMessageOriginHost:()=>l,isVKPayApp:()=>i,objectToQuerystring:()=>n});var s=r(120718);const n=(e,t="?")=>Object.keys(e).reduce(((r,s,n)=>[r,0===n?t:"&",encodeURIComponent(s),"=",encodeURIComponent(e[s])].join("")),""),a=e=>{const t=e.match(/:\/\/(www[0-9]?\.)?(.[^/:]+)/i);return null!=t&&t.length>2&&"string"==typeof t[2]&&t[2].length>0?t[2].toLowerCase():null},o=e=>{if(cur.vkAppQueue){const t=Object.keys(cur.vkAppQueue).filter((t=>~t.indexOf(e)));if(t.length>0){const e=t[0];cur.vkAppQueue[e].destroyView(),delete cur.vkAppQueue[e]}}},i=e=>s.VKPAY_APPS.includes(e);function c(e,t){const r=a(t),s=e.vkApp?e.vk_app_url:e.src,n=a(s);if(r!==n&&!l(e,r))throw Error(`Insecure method call from ${r}. Call must be from ${n}`);return!0}function l(e,t){if(!e.allowed_origin_regexp)return!1;return new RegExp(e.allowed_origin_regexp).test(t)}},662273:(e,t,r)=>{function s(e,t){let r,s,n=!1;return function a(){if(n)return r=arguments,void(s=this);e.apply(this,arguments),n=!0,setTimeout((function(){n=!1,r&&(a.apply(s,r),r=s=null)}),t)}}r.d(t,{throttle:()=>s})},873004:(e,t,r)=>{r.d(t,{Atom:()=>s});class s{set(e,{notify:t=!0}={}){t&&this.base.notify(this.key)}getKey(){return`${this.base.options.storeName}-${this.key}`}constructor({key:e,base:t}){this.key=e,this.base=t}}},131966:(e,t,r)=>{r.d(t,{Store:()=>s});class s{subscribe(e,t){const r=this.getListeners(t);return r.add(e),()=>{r.delete(e)}}notify(e,t){this.getListeners(t).forEach((t=>{t(e)}))}refresh(){try{localStorage.setItem(this.key,""),localStorage.removeItem(this.key)}catch(e){}}destroy(){this.listeners.clear(),this.syncListeners.clear(),s.instances.delete(this.key)}get key(){const{dbName:e,storeName:t,version:r}=this.options;return`${e}-v${r}-${t}`}getListeners(e){return e?this.syncListeners:this.listeners}constructor(e){this.listeners=new Set,this.syncListeners=new Set,this.options=e,s.instances.set(this.key,this)}}s.instances=new Map,window.addEventListener("storage",(({key:e,newValue:t})=>{var r;e&&null!==t&&(null==(r=s.instances.get(e))||r.notify())}))},426775:(e,t,r)=>{r.d(t,{SyncAtom:()=>a,SyncAtomType:()=>s});var s,n=r(873004);!function(e){e.OBJECT="object",e.STRING="string",e.NUMBER="number",e.BOOLEAN="boolean",e.STRING_NUMBER="string_number"}(s||(s={}));class a extends n.Atom{get(){const e=this.getKey();try{let t=localStorage.getItem(e);if(!t)return null;switch(this.type){case s.OBJECT:try{t=JSON.parse(t)}catch(e){return null}break;case s.NUMBER:t=Number(t)||0;break;case s.STRING_NUMBER:t=Number(t)||t;break;case s.BOOLEAN:t=Boolean(Number(t))}return t}catch(t){return console.log(`${e}: Ошибка чтения данных из хранилища`),console.log(t),this.cache||null}}set(e,t){const r=this.getKey();let n;switch(this.type){case s.OBJECT:n=JSON.stringify(e);break;case s.BOOLEAN:n=String(Number(e));break;default:n=String(e)}try{localStorage.setItem(r,n)}catch(t){console.log(`${r}: Не удалось записать данные в хранилище`),console.log(t),this.cache=e}super.set(e,t)}delete(){const e=this.getKey();try{delete this.cache,localStorage.removeItem(e)}catch(t){console.log(`${e}: Ошибка удаления ключа из хранилища`),console.log(t)}}getKey(){return`${this.base.key}-${this.key}`}constructor(e){super(e);const{base:t,type:r}=e;this.base=t,this.type=r}}},380312:(e,t,r)=>{r.d(t,{createSyncStore:()=>o});var s=r(131966),n=r(426775);class a extends s.Store{createAtom(e,t){return new n.SyncAtom({key:e,type:t,base:this})}constructor(e){super(e)}}function o(e){return new a(e)}},348354:(e,t,r)=>{r.d(t,{stickersEmojiKeyboard:()=>s});const s=(0,r(798116).createDomain)()},616912:(e,t,r)=>{r.d(t,{$userEnv:()=>a,setUserEnv:()=>n});var s=r(348354);const n=s.stickersEmojiKeyboard.createEvent(),a=s.stickersEmojiKeyboard.createStore({}).on(n,((e,t)=>t))}}]);try{stManager.done("dist/6b701f2f332ae627fff451104bcd1364.dc4475a5b6d28ad8f82a.js")}catch(e){}