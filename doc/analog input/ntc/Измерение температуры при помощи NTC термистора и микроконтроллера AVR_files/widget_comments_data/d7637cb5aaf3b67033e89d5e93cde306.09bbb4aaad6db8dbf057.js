"use strict";(self.webpackChunkvk=self.webpackChunkvk||[]).push([[67723],{377976:(e,t,s)=>{s.d(t,{API:()=>v});var r,i,o=s(434788),n=s(393356),a=s(401623),c=s(283085),d=s(618430),l=s(647827),u=s(183746),h=s(722223);const p="undefined"!=typeof window&&(null==(i=window.vk)||null==(r=i.apiConfigDomains)?void 0:r.apiDomain)||"api.vk.com";class v extends a.CallbackService{setOptions(e){this.options=(0,o._)({},this.options,e)}execute(e){return this.call("execute",e)}procedure(e,t){return this.call(`execute.${e}`,t)}call(e,t){return this.callWithRequest(new a.APIRequest({method:e,params:t,api:this}))}callWithRequest(e){return this.worker.enqueue(e),e.promise}getWorker(){switch(this.options.mode){case h.APIMode.PARALLEL:return new c.ParallelWorker(this);case h.APIMode.SEQUENTIAL:return new d.SequentialWorker(this)}}constructor(e,t={}){super(),this.globalParams=new Map,this.options=(0,o._)({token:"",mode:h.APIMode.SEQUENTIAL,requestMode:h.APIRequestMode.SEQUENTIAL,requestMethod:h.APIRequestMethod.FETCH,wait:3e3,limit:3,bridge:!1,version:n.API_VERSION,baseUrl:`https://${p}`,retryLimit:3,timeout:6e4,executeCount:25,language:"ru",executeUnsupportedMethods:["photos.save","photos.saveWallPhoto","photos.saveOwnerPhoto","photos.saveMessagesPhoto","messages.setChatPhoto","photos.saveMarketPhoto","photos.saveMarketAlbumPhoto","audio.save","docs.save","photos.saveOwnerCoverPhoto","stories.save","polls.savePhoto"]},e);for(const e of l.methodGroups)this[e]=new Proxy(Object.create(null),{get:(t,s)=>(t,r)=>this.callWithRequest(new a.APIRequest({api:this,method:`${e}.${s}`,params:t,options:r}))});this.worker=this.getWorker(),this.updates=new u.Updates(this,t)}}},513222:(e,t,s)=>{s.d(t,{CaptchaType:()=>o,MINIMUM_TIME_INTERVAL_API:()=>i,POLLING_VERSION:()=>r});const r=10,i=1133;var o;!function(e){e.API="API",e.DIRECT_AUTH="DIRECT_AUTH",e.IMPLICIT_FLOW_AUTH="IMPLICIT_FLOW_AUTH",e.ACCOUNT_VERIFICATION="ACCOUNT_VERIFICATION"}(o||(o={}))},432043:(e,t,s)=>{s.d(t,{APIError:()=>o});var r=s(602033),i=s(5874);class o extends i.VKError{constructor(e){const t=Number(e.error_code);switch(super({code:t,message:`Code №${t} - ${e.error_msg}`}),this.params=e.request_params,t===r.API_ERROR_CAPTCHA&&(this.captchaSid=Number(e.captcha_sid),this.captchaImg=e.captcha_img),t){case r.API_ERROR_CAPTCHA:this.captchaSid=Number(e.captcha_sid),this.captchaImg=e.captcha_img;break;case r.API_ERROR_AUTH_VALIDATION:this.redirectUri=e.redirect_uri;break;case r.API_ERROR_NEED_CONFIRMATION:this.confirmationText=e.confirmation_text}}}},752448:(e,t,s)=>{s.d(t,{ExecuteError:()=>i});var r=s(432043);class i extends r.APIError{constructor(e){super({error_code:e.error_code,error_msg:e.error_msg,request_params:[]}),this.method=e.method}}},695007:(e,t,s)=>{s.d(t,{OAuthError:()=>i});var r=s(5874);class i extends r.VKError{constructor({error:e,error_description:t}){super({code:e,message:t})}}},869489:(e,t,s)=>{s.d(t,{UpdatesError:()=>i});var r=s(5874);class i extends r.VKError{}},5874:(e,t,s)=>{var r;s.d(t,{SharedErrorCode:()=>r,VKError:()=>i}),function(e){e.UNSUPPORTED_MODE="UNSUPPORTED_MODE",e.MISSING_CAPTCHA_HANDLER="MISSING_CAPTCHA_HANDLER",e.MISSING_TOKEN_REGENERATE_HANDLER="MISSING_TOKEN_REGENERATE_HANDLER"}(r||(r={}));class i extends Error{constructor({code:e,message:t}){super(t),this.code=e,this.name=this.constructor.name}}},526511:(e,t,s)=>{s.d(t,{CallbackService:()=>i});var r=s(5874);class i{get hasCaptchaHandler(){return void 0!==this.captchaHandler}onCaptcha(e){return this.captchaHandler=e,this}processingCaptcha(e){const{captchaHandler:t}=this;return t?new Promise(((s,r)=>{t(e,(e=>new Promise(((t,i)=>{if(e instanceof Error)return i(e),void r(e);s({key:e,validate:{resolve:t,reject:i}})}))))})):Promise.reject(new r.VKError({code:r.SharedErrorCode.MISSING_CAPTCHA_HANDLER,message:"Missing captcha handler"}))}get hasTokenRegenerateHandler(){return void 0!==this.tokenRegenerateHandler}onTokenRegenerate(e){return this.tokenRegenerateHandler=e,this}processingTokenRegenerate(){const{tokenRegenerateHandler:e}=this;return void 0===e?Promise.reject(new r.VKError({code:r.SharedErrorCode.MISSING_TOKEN_REGENERATE_HANDLER,message:"Missing token regenerate handler"})):new Promise(((t,s)=>{e((e=>new Promise(((r,i)=>{if(e instanceof Error)return i(e),void s(e);t({token:e,validate:{resolve:r,reject:i}})}))))}))}}},565579:(e,t,s)=>{s.d(t,{EventDispatcher:()=>r});class r{hasEventListener(e,t){return this.listeners.some((s=>s.type===e&&s.listener===t))}addEventListener(e,t,s={}){return this.hasEventListener(e,t)||this.listeners.push({type:e,listener:t,options:s}),this}removeEventListener(e,t){const s=this.listeners.findIndex((s=>s.type===e&&s.listener===t));return-1!==s&&this.listeners.splice(s,1),this}removeEventListeners(){return this.listeners=[],this}dispatchEvent(e){return this.listeners.filter((t=>t.type===e.type)).forEach((t=>{const{type:s,listener:r,options:{once:i}}=t;r.call(this,e),i&&this.removeEventListener(s,r)})),this}constructor(){this.listeners=[]}}},401623:(e,t,s)=>{s.d(t,{APIRequest:()=>r.APIRequest,CallbackService:()=>i.CallbackService});var r=s(17318),i=s(526511)},17318:(e,t,s)=>{s.d(t,{APIRequest:()=>d});var r=s(11010),i=s(434788),o=s(363476),n=s.n(o),a=s(372322),c=s(48989);class d{toString(){return(0,c.getExecuteMethod)(this.method,this.params)}get filteredParams(){const{options:{token:e,version:t,language:s}}=this.api;return Object.fromEntries([...Object.entries((0,i._)({},!this.isCustomMethod&&{v:t,access_token:e},{lang:s},this.params)),...this.api.globalParams.entries()].filter((([,e])=>void 0!==e)))}get isCustomMethod(){const{requestMethod:e}=this.api.options;return"function"==typeof e}make(){var e=this;return(0,r._)((function*(){const{options:{timeout:t,requestMethod:s}}=e.api;e.timeout=setTimeout((()=>{var t;return null==(t=e.options.abortController)?void 0:t.abort()}),t);try{return e.isCustomMethod?yield e.custom():yield e[s]()}finally{clearTimeout(e.timeout)}}))()}fetch(){var e;const{abortController:t}=this.options,{options:{baseUrl:s}}=this.api;return fetch(new URL(`/method/${this.method}`,s),{method:"POST",signal:null==(e=t)?void 0:e.signal,headers:{connection:"keep-alive"},body:new URLSearchParams(this.filteredParams)}).then((e=>e.json()))}bridge(){const{abortController:e}=this.options;return new Promise(((t,s)=>{var r,i;(null==(r=e)?void 0:r.signal.aborted)&&s(e.signal.reason),null==(i=e)||i.signal.addEventListener("abort",(()=>{s(e.signal.reason)})),n().send("VKWebAppCallAPIMethod",{method:this.method,params:this.filteredParams}).then(t).catch((e=>{var s;const{error_data:r}=e;t({error:(null==(s=r)?void 0:s.error_reason)||r||e})}))}))}script(){const{abortController:e}=this.options,{options:{baseUrl:t}}=this.api;return new Promise(((s,r)=>{var i,o;(null==(i=e)?void 0:i.signal.aborted)&&r(e.signal.reason);const n=(0,a.generateId)(20),c=new URLSearchParams(this.filteredParams);c.set("callback",n);const d=document.createElement("script");d.type="text/javascript",d.async=!0,d.src=new URL(`/method/${this.method}?${c}`,t).toString(),window[n]=e=>{d.remove(),delete window[n],s(e)},null==(o=e)||o.signal.addEventListener("abort",(()=>{d.remove(),delete window[n],r(e.signal.reason)})),document.head.appendChild(d)}))}custom(){const{abortController:e}=this.options,{requestMethod:t}=this.api.options;if("function"==typeof t)return new Promise(((s,r)=>{var i,o;(null==(i=e)?void 0:i.signal.aborted)&&r(e.signal.reason),null==(o=e)||o.signal.addEventListener("abort",(()=>{r(e.signal.reason)})),t(this.method,this.filteredParams).then(s).catch(r)}))}constructor({api:e,method:t,params:s={},options:r={}}){var o;this.retries=0,this.api=e,this.method=t,this.params=(0,i._)({},s),this.options=(0,i._)({},r),null!=(o=this.options).abortController||(o.abortController=new AbortController),this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}},506945:(e,t,s)=>{s(667294)},964548:(e,t,s)=>{s.d(t,{API:()=>r.API,StickersQueueEventType:()=>a.StickersQueueEventType,UpdatesSource:()=>o.UpdatesSource,VKError:()=>i.VKError,VmojiQueueEventType:()=>n.VmojiQueueEventType,getRandomId:()=>c.getRandomId});var r=s(377976),i=(s(722223),s(695007),s(869489),s(752448),s(5874)),o=(s(432043),s(183746)),n=s(563772),a=s(513080),c=(s(85158),s(456079),s(187684),s(969042),s(506945),s(167718));s(153473),s(517283)},647827:(e,t,s)=>{s.d(t,{methodGroups:()=>r});const r=["account","accountVerification","actionLinks","address","adex","admin","admins","ads","adsint","adsweb","aliexpress","antispam","appWidgets","apps","articles","asr","audio","audioBooks","audioSearch","auth","authorsMarketplace","autotests","badges","bestFriends","biz","blogforce","board","bot","botsConf","bugtracker","calls","callsOk","captcha","cashout","catalog","channels","classifieds","combo","coupons","crowd","cua","database","deliveryClub","devAdmin","docs","documentation","donut","downloadedGames","ecosystem","education","educationCloud","educationEjd","educationForeign","educationParents","educationPolls","educationReport","educationUser","email","esia","exchange","exchangeRates","execute","experts","explore","externalAudioMatching","externalUsers","fave","finance","findMe","forbiddenRegistry","fortuneSquare","fortuneWheel","friends","gamesPromo","gifts","golunch","goodsOrders","groups","healthApp","healthCommon","healthCourses","healthFeed","healthLoyalty","id","identity","instManager","interests","internal","leadForms","leads","lifeEvents","likes","lovina","loyalty","loyaltyTeen","market","marusia","masks","memories","messages","microlandings","mobile","money","multiaccount","musicManager","narratives","newsfeed","nft","nftMarket","nospam","notes","notifications","odnoklassniki","onboarding","orders","pages","phones","photos","places","platform","platformConsole","podcasts","podcastsOffice","polls","prettyCards","promoCodes","questions","queue","recomSettings","reports","restore","rewardedAds","rightholders","search","secure","serverEffects","settings","shortVideo","signals","situationalSuggests","sms","social","specials","statEvents","stats","statsDashboard","status","stickers","storage","store","stories","streaming","studentsVerification","studio","superApp","superAppPromo","support","survey","tabbar","tags","textlives","tickets","tinkoff","translations","uma","users","utils","uxpolls","verification","video","videoPostcards","vkCharity","vkIdHub","vkMusic","vkRun","vkStart","vkTaxi","vkUp","vkdrive","vkstore","vmoji","voicerooms","wall","weather","widgets","widgetsIOS","widgetsKit","wishlists"]},722223:(e,t,s)=>{var r,i,o;s.d(t,{APIMode:()=>r,APIRequestMethod:()=>o,APIRequestMode:()=>i}),function(e){e.PARALLEL="parallel",e.SEQUENTIAL="sequential"}(r||(r={})),function(e){e.SEQUENTIAL="sequential",e.BURST="burst"}(i||(i={})),function(e){e.FETCH="fetch",e.SCRIPT="script",e.BRIDGE="bridge"}(o||(o={}))},513080:(e,t,s)=>{var r;s.d(t,{StickersQueueEvent:()=>i,StickersQueueEventType:()=>r}),function(e){e.UGC_USER_UPDATE="ugc_user_update",e.UGC_PACK_UPDATE="ugc_pack_update",e.UGC_OWNER_UPDATE="ugc_owner_update",e.UGC_STICKER_UPDATE="ugc_sticker_update"}(r||(r={}));class i extends CustomEvent{constructor(e,t){super(e,{detail:t})}}},718557:(e,t,s)=>{s.d(t,{handlerStickersQueueEvent:()=>c});var r=s(513080),i=s(85158),o=s(456079),n=s(187684),a=s(969042);function c(e,{data:t}){const{type:s}=t;switch(s){case r.StickersQueueEventType.UGC_PACK_UPDATE:e.dispatchEvent(new i.StickersUGCPackUpdate(t));break;case r.StickersQueueEventType.UGC_USER_UPDATE:e.dispatchEvent(new o.StickersUGCUserUpdate(t));break;case r.StickersQueueEventType.UGC_OWNER_UPDATE:e.dispatchEvent(new n.StickersUGCOwnerUpdate(t));break;case r.StickersQueueEventType.UGC_STICKER_UPDATE:e.dispatchEvent(new a.StickersUGCStickerUpdate(t))}}},187684:(e,t,s)=>{s.d(t,{StickersUGCOwnerUpdate:()=>i});var r=s(513080);class i extends r.StickersQueueEvent{constructor(e){super(r.StickersQueueEventType.UGC_OWNER_UPDATE,e)}}},85158:(e,t,s)=>{s.d(t,{StickersUGCPackUpdate:()=>i});var r=s(513080);class i extends r.StickersQueueEvent{constructor(e){super(r.StickersQueueEventType.UGC_USER_UPDATE,e)}}},969042:(e,t,s)=>{s.d(t,{StickersUGCStickerUpdate:()=>i});var r=s(513080);class i extends r.StickersQueueEvent{constructor(e){super(r.StickersQueueEventType.UGC_STICKER_UPDATE,e)}}},456079:(e,t,s)=>{s.d(t,{StickersUGCUserUpdate:()=>i});var r=s(513080);class i extends r.StickersQueueEvent{constructor(e){super(r.StickersQueueEventType.UGC_USER_UPDATE,e)}}},563772:(e,t,s)=>{var r;s.d(t,{VmojiQueueEvent:()=>i,VmojiQueueEventType:()=>r}),function(e){e.AVATAR="avatar",e.STICKERS="stickers",e.CHARACTER="character",e.STICKERS_PRINT_REQUEST="stickers_print_request"}(r||(r={}));class i extends CustomEvent{constructor(e,t){super(e,{detail:t})}}},208911:(e,t,s)=>{s.d(t,{handleVmojiQueueEvent:()=>i});var r=s(563772);function i(e,{data:t}){const{type:s,query_id:i}=t;i&&e.dispatchEvent(new r.VmojiQueueEvent(i,t)),e.dispatchEvent(new r.VmojiQueueEvent(s,t))}},183746:(e,t,s)=>{s.d(t,{Updates:()=>m,UpdatesSource:()=>r});var r,i,o,n=s(11010),a=s(434788),c=s(820224),d=s(869489),l=s(565579),u=s(208911),h=s(718557),p=s(131942),v=s(513222);!function(e){e.USER="user",e.GROUP="group",e.VMOJI="vmoji",e.STICKERS="stickers"}(r||(r={})),function(e){e.CHECK="a_check",e.RELEASE="a_release"}(i||(i={})),function(e){e.NEED_RESTART="NEED_RESTART",e.POLLING_REQUEST_FAILED="POLLING_REQUEST_FAILED"}(o||(o={}));class m extends l.EventDispatcher{start(){var e=this;return(0,n._)((function*(){if(!e.started){e.started=!0;try{const t=yield e.getLongPollServer();if(!t)return;const{server:s,key:o,ts:n}=t;switch(0===e.ts&&(e.ts=n),e.url=new URL(s),e.url.searchParams.set("key",o),e.url.searchParams.set("act",i.CHECK),e.url.searchParams.set("wait","25"),e.url.searchParams.set("mode",String(e.mode)),e.url.searchParams.set("version",String(v.POLLING_VERSION)),e.source){case r.VMOJI:case r.STICKERS:e.url.searchParams.set("id",String(e.userId))}e.startFetchLoop()}catch(t){throw e.started=!1,t}}}))()}getLongPollServer(){var e=this;return(0,n._)((function*(){let t;switch(e.source){case r.GROUP:t=yield e.api.groups.getLongPollServer({group_id:e.groupId});break;case r.VMOJI:case r.STICKERS:var s;s=yield e.api[e.source].subscribeToQueue().then((e=>{var{base_url:t}=e,s=(0,c._)(e,["base_url"]);return(0,a._)({server:t},s)})),t=s;break;default:return}const{server:i}=t;return t.server=`${i.startsWith("https")?"":"https://"}${i}`,t}))()}stop(){var e=this;return(0,n._)((function*(){e.started=!1,e.restarted=0}))()}startFetchLoop(){var e=this;return(0,n._)((function*(){try{for(;e.started;)yield e.fetchUpdates()}catch(t){if(t.code!==o.NEED_RESTART&&e.restarted!==e.retryLimit)return e.restarted+=1,yield(0,p.wait)(3e3),void e.startFetchLoop();for(;e.started;)try{yield e.stop(),yield e.start();break}catch(t){console.log(t),e.started=!0,yield(0,p.wait)(e.wait)}}}))()}fetchUpdates(){var e=this;return(0,n._)((function*(){e.url.searchParams.set("ts",String(e.ts));const t=new AbortController,s=setTimeout((()=>t.abort()),3e4);let r;try{const s=yield fetch(e.url,{method:"GET",signal:t.signal,headers:{connection:"keep-alive"}});if(!s.ok)throw new d.UpdatesError({code:o.POLLING_REQUEST_FAILED,message:"Polling request failed"});r=yield s.json()}finally{clearTimeout(s)}if(void 0!==r.failed){if(1===r.failed)return void(e.ts=r.ts);throw e.ts=0,new d.UpdatesError({code:o.NEED_RESTART,message:"The server has been failed"})}e.restarted=0,e.ts=r.ts,r.pts&&(e.pts=Number(r.pts)),r.updates=r.updates||r.events||[];for(const t of r.updates)e.handleUpdate(t)}))()}handleUpdate(e){switch(this.source){case r.VMOJI:(0,u.handleVmojiQueueEvent)(this,e);break;case r.STICKERS:(0,h.handlerStickersQueueEvent)(this,e)}}constructor(e,t={}){super(),this.mode=202,this.started=!1,this.ts=0,this.pts=0,this.restarted=0,this.api=e;const{source:s,userId:r,groupId:i,wait:o,retryLimit:n}=t;this.source=s,this.userId=r,this.groupId=i,this.wait=o||3e3,this.retryLimit=n||3}}},372322:(e,t,s)=>{function r(e){const t="abcdefghijklmnopqrstuvwxyz";let s="";for(let r=0;r<e;r++)s+=t.charAt(Math.floor(26*Math.random()));return s}s.d(t,{generateId:()=>r})},517283:(e,t,s)=>{var r;s(363476);!function(e){e.WALL="wall",e.DOCS="docs",e.STATS="stats",e.VIDEO="video",e.PAGES="pages",e.NOTES="notes",e.MANAGE="manage",e.MARKET="market",e.PHOTOS="photos",e.STATUS="status",e.GROUPS="groups",e.OFFLINE="offline",e.STORIES="stories",e.FRIENDS="friends",e.MESSAGES="messages",e.APP_WIDGET="app_widget"}(r||(r={}))},868728:(e,t,s)=>{function r(e){return`return [${e.join(",")}];`}s.d(t,{getChainReturn:()=>r})},48989:(e,t,s)=>{s.d(t,{getExecuteMethod:()=>i});var r=s(206467);function i(e,t={}){return`API.${e}(${(0,r.getExecuteParams)(t)})`}},206467:(e,t,s)=>{function r(e){return JSON.stringify(e,((t,s)=>"object"==typeof s&&s!==e?String(s):s))}s.d(t,{getExecuteParams:()=>r})},153473:(e,t,s)=>{s(11010),s(432043),s(695007),s(131942)},167718:(e,t,s)=>{function r(){const e=Math.pow(2,32)/2-1;return Math.floor(Math.random()*e)}s.d(t,{getRandomId:()=>r})},708672:(e,t,s)=>{function r(e,t){let s=0;t.response.forEach(((r,i)=>{const o=e[i];!1===r?(o.reject(t.errors[s]),s++):o.resolve(r)}))}s.d(t,{resolveExecuteTask:()=>r})},131942:(e,t,s)=>{function r(e){return new Promise((t=>{setTimeout(t,e)}))}s.d(t,{wait:()=>r})},283085:(e,t,s)=>{s.d(t,{ParallelWorker:()=>c});var r=s(11010),i=s(401623),o=s(618430),n=s(868728),a=s(708672);class c extends o.SequentialWorker{execute(){var e=this,t=()=>super.execute;return(0,r._)((function*(){const{queue:s}=e;if(e.isAllowedMethod(s[0].method))return void t().call(e);const{executeCount:r}=e.api.options,o=[];for(let t=0;t<e.queue.length&&(e.isAllowedMethod(s[t].method)||(o.push(s.splice(t,1)[0]),t-=1,!(o.length>=r)));t+=1);if(0===o.length)return;const c=new i.APIRequest({api:e.api,method:"execute",params:{code:(0,n.getChainReturn)(o.map(String))}});t().call(e,c);try{(0,a.resolveExecuteTask)(o,yield c.promise)}catch(e){for(const t of o)t.reject(e)}}))()}isAllowedMethod(e){return e.startsWith("execute")||this.api.options.executeUnsupportedMethods.includes(e)}}},618430:(e,t,s)=>{s.d(t,{SequentialWorker:()=>l});var r=s(11010),i=s(602033),o=s(614531),n=s(432043),a=s(752448),c=s(131942),d=s(513222);class l extends o.APIWorker{execute(e){var t=this;return(0,r._)((function*(){var s;if(e||(e=t.queue.shift()),!e)return;const{method:r}=e;let i;try{i=yield e.make()}catch(s){const{options:r}=t.api;var o;return e.retries===r.limit?(null==(o=e.captchaValidate)||o.reject(s),void e.reject(s)):(e.retries+=1,yield(0,c.wait)(r.wait),void t.requeue(e))}var d;void 0===i.error?(null==(s=e.captchaValidate)||s.resolve(),r.startsWith("execute")?e.resolve({response:i.response,errors:(i.execute_errors||[]).map((e=>new a.ExecuteError(e)))}):e.resolve(null!=(d=i.response)?d:i)):t.handleError(e,new n.APIError(i.error))}))()}handleError(e,t){var s=this;return(0,r._)((function*(){var r,o;const{code:n}=t,{options:a}=s.api;if(e.retries!==a.limit){if(e.retries+=1,n===i.API_ERROR_TOO_MANY)return s.paused?void s.requeue(e):(s.pause(),yield(0,c.wait)(d.MINIMUM_TIME_INTERVAL_API),s.requeue(e),void s.resume());if(null==(r=e.captchaValidate)||r.reject(t),null==(o=e.tokenRegenerateValidate)||o.reject(t),n===i.API_ERROR_CAPTCHA&&s.api.hasCaptchaHandler)try{const{captchaSid:r}=t,{key:i,validate:o}=yield s.api.processingCaptcha({type:d.CaptchaType.API,src:t.captchaImg,sid:r,request:e});e.captchaValidate=o,e.params.captcha_sid=r,e.params.captcha_key=i,s.requeue(e)}catch(t){e.reject(t)}else if(n===i.API_ERROR_AUTH&&s.api.hasTokenRegenerateHandler)try{const{token:t,validate:r}=yield s.api.processingTokenRegenerate();s.api.options.token=t,e.tokenRegenerateValidate=r,yield(0,c.wait)(d.MINIMUM_TIME_INTERVAL_API),s.requeue(e)}catch(t){e.reject(t)}else e.reject(t)}else e.reject(t)}))()}}},614531:(e,t,s)=>{s.d(t,{APIWorker:()=>i});var r=s(513222);class i{enqueue(e){this.queue.push(e),this.immediateHeat()}requeue(e){this.queue.unshift(e),this.immediateHeat()}pause(){this.paused=!0}resume(){this.paused=!1,this.immediateHeat()}heat(){if(this.paused||this.busy||!this.queue.length)return;this.busy=!0;const{requestMode:e}=this.api.options;this[e]()}sequential(){this.execute(),setTimeout((()=>{this.busy=!1,this.immediateHeat()}),this.intervalPerRequests)}burst(){const e=Math.min(this.api.options.limit,this.queue.length);for(let t=0;t<e&&0!==this.queue.length;t+=1)this.execute();const t=Math.ceil(r.MINIMUM_TIME_INTERVAL_API-e*this.intervalPerRequests);setTimeout((()=>{this.busy=!1,this.immediateHeat()}),t<=0?r.MINIMUM_TIME_INTERVAL_API:t)}immediateHeat(){setTimeout((()=>this.heat()))}constructor(e){this.busy=!1,this.paused=!1,this.queue=[],this.api=e,this.intervalPerRequests=Math.ceil(r.MINIMUM_TIME_INTERVAL_API/this.api.options.limit)}}},822158:(e,t,s)=>{s.d(t,{AsyncAtom:()=>n});var r=s(11010),i=s(891047),o=s(873004);class n extends o.Atom{get(){const e=this.getKey();return(0,i.get)(e,this.base.store).then((e=>e||this.cache||null)).catch((t=>(console.log(`${e}: Ошибка чтения данных из хранилища`),console.log(t),this.cache||null)))}set(e,t){var s=this,o=()=>super.set;return(0,r._)((function*(){const r=s.getKey();s.cache=e,yield(0,i.set)(r,e,s.base.store).catch((e=>{console.log(`${r}: Не удалось записать данные в хранилище`),console.log(e)})),o().call(s,e,t)}))()}delete(){const e=this.getKey();return delete this.cache,(0,i.del)(e,this.base.store).then((()=>{this.base.notify(this.key)})).catch((t=>{console.log(`${e}: Ошибка удаления ключа из хранилища`),console.log(t)}))}constructor(e){super(e);const{base:t}=e;this.base=t}}},559205:(e,t,s)=>{s.d(t,{createAsyncStore:()=>a});var r=s(891047),i=s(131966),o=s(822158);class n extends i.Store{createAtom(e){return new o.AsyncAtom({key:e,base:this})}clear(){return(0,r.clear)(this.store).then((()=>{this.notify()}))}constructor(e){super(e);const{dbName:t,version:s}=e;this.store=(0,r.createStore)(`${t}-v${s}`,t)}}function a(e){return new n(e)}},503967:(e,t,s)=>{s.d(t,{PackContext:()=>l});var r=s(570912),i=s(615816),o=s(820224),n=(0,i._)("_options"),a=(0,i._)("_pack"),c=(0,i._)("_product"),d=(0,i._)("_stockItem");class l{get rawData(){return(0,r._)(this,a)[a]||(0,r._)(this,d)[d]||(0,r._)(this,c)[c]}get isPack(){return Boolean((0,r._)(this,a)[a])}get isProduct(){return Boolean((0,r._)(this,c)[c])}get isStockItem(){return Boolean((0,r._)(this,d)[d])}get isStoreItem(){return this.isProduct||this.isStockItem}get stockItem(){return(0,r._)(this,d)[d]}get id(){var e,t,s,i;const o=null==(t=(0,r._)(this,n)[n])||null==(e=t.redefine)?void 0:e.id;if(void 0!==o)return o;const d=null==(s=(0,r._)(this,c)[c])?void 0:s.id;return void 0!==d?d:null==(i=(0,r._)(this,a)[a])?void 0:i.id}setHint(e){return(0,r._)(this,n)[n]?((0,r._)(this,n)[n].hint=e,this):this}get hintId(){var e,t;return null==(t=(0,r._)(this,n)[n])||null==(e=t.hint)?void 0:e.id}get hintWidth(){var e,t;return null==(t=(0,r._)(this,n)[n])||null==(e=t.hint)?void 0:e.width}get index(){var e;return null==(e=(0,r._)(this,n)[n])?void 0:e.index}get referrer(){var e;return null==(e=(0,r._)(this,n)[n])?void 0:e.referrer}get tooltip(){var e;return null==(e=(0,r._)(this,n)[n])?void 0:e.tooltip}get title(){var e,t,s;return(null==(t=(0,r._)(this,n)[n])||null==(e=t.redefine)?void 0:e.title)||(null==(s=(0,r._)(this,c)[c])?void 0:s.title)||""}get stickers(){var e,t,s,i;return(null==(t=(0,r._)(this,n)[n])||null==(e=t.redefine)?void 0:e.stickers)||(null==(s=(0,r._)(this,a)[a])?void 0:s.stickers)||(null==(i=(0,r._)(this,c)[c])?void 0:i.stickers)}get baseId(){var e;return null==(e=(0,r._)(this,c)[c])?void 0:e.base_id}get isStyle(){return void 0!==this.baseId}get hasStyles(){var e;return Boolean(null==(e=this.styleIds)?void 0:e.length)}get styleIds(){var e;return null==(e=(0,r._)(this,c)[c])?void 0:e.style_ids}get canGift(){var e;return Boolean(null==(e=(0,r._)(this,d)[d])?void 0:e.can_gift)}get vmojiAvatar(){var e;return null==(e=(0,r._)(this,c)[c])?void 0:e.vmoji_avatar}get isVmoji(){var e;return Boolean(this.vmojiAvatar||(null==(e=(0,r._)(this,c)[c])?void 0:e.is_vmoji))}get isNew(){var e;return null==(e=(0,r._)(this,c)[c])?void 0:e.is_new}get previews(){var e;return null==(e=(0,r._)(this,c)[c])?void 0:e.previews}constructor(e){var{pack:t}=e,s=(0,o._)(e,["pack"]);Object.defineProperty(this,n,{writable:!0,value:void 0}),Object.defineProperty(this,a,{writable:!0,value:void 0}),Object.defineProperty(this,c,{writable:!0,value:void 0}),Object.defineProperty(this,d,{writable:!0,value:void 0}),(0,r._)(this,n)[n]=s,t&&("product"in t?((0,r._)(this,d)[d]=t,(0,r._)(this,c)[c]=t.product):"id"in t&&"type"in t?(0,r._)(this,c)[c]=t:(0,r._)(this,a)[a]=t)}}},879706:(e,t,s)=>{s.d(t,{$api:()=>c,APIGate:()=>d,changeAPIOptions:()=>a});var r=s(798116),i=s(504190),o=s(348354),n=s(478748);const a=o.stickersEmojiKeyboard.createEvent(),c=o.stickersEmojiKeyboard.createStore(new n.API({})).on(a,((e,{api:t})=>t)),d=(0,i.createGate)();(0,r.forward)({from:d.state,to:a})},63767:(e,t,s)=>{var r,i;s.d(t,{AtomNameByHelpHintId:()=>a,AtomNameByPromoId:()=>d,AvatarSuggestionAtomName:()=>o,HelpHintAtomNames:()=>n,HelpHintIdTypes:()=>r,HelpHintPromoTypes:()=>i}),function(e){e.VMOJI_AVATAR_SUGGESTION="keyboard:stickers_vmoji_avatar_suggestion"}(r||(r={})),function(e){e.VMOJI_AVATAR_SUGGESTION="vmoji_avatar_suggestion_stickers_keyboard_hint"}(i||(i={}));const o="avatarSuggestion",n=[o],a={[r.VMOJI_AVATAR_SUGGESTION]:o},c="avatarSuggestionCounter",d={[i.VMOJI_AVATAR_SUGGESTION]:c}},326157:(e,t,s)=>{s.d(t,{$favoriteStickers:()=>o,setFavoriteStickers:()=>i});var r=s(348354);const i=r.stickersEmojiKeyboard.createEvent(),o=r.stickersEmojiKeyboard.createStore(null).on(i,((e,t)=>t))},237341:(e,t,s)=>{s.d(t,{$hasAvatar:()=>o,setHasAvatar:()=>i});var r=s(348354);const i=r.stickersEmojiKeyboard.createEvent(),o=r.stickersEmojiKeyboard.createStore(null).on(i,((e,t)=>t))},829596:(e,t,s)=>{s.d(t,{$packs:()=>p,ServicePackKey:()=>r});var r,i,o=s(798116),n=s(944952),a=s(734264),c=s(237341),d=s(703104),l=s(730368),u=s(326157),h=s(503967);!function(e){e[e.FAVORITE=-1]="FAVORITE",e[e.RECENT=-2]="RECENT",e[e.VMOJI=-3]="VMOJI",e[e.UGC=-4]="UGC"}(r||(r={})),function(e){e.RECENT="recent",e.FAVORITE="favourite",e.KEYBOARD="keyboard"}(i||(i={}));const p=(0,o.combine)(n.$ugcInfo,a.$ugcPacks,d.$stockItems,l.$recentStickers,u.$favoriteStickers,c.$hasAvatar,((e,t,s,o,n,a)=>{var c,d,l,u,p,v,m;const g=new Map;let _=[];const k=new Map;let f=0;if(!s||!o||!n)return{};n.length&&(g.set(r.FAVORITE,new h.PackContext({index:f,referrer:i.FAVORITE,redefine:{id:r.FAVORITE,title:"stickers_picker_favorite",stickers:n}})),_.push(r.FAVORITE),f++),o.length&&(g.set(r.RECENT,new h.PackContext({index:f,referrer:i.RECENT,redefine:{id:r.RECENT,title:"stickers_picker_recently_used",stickers:o}})),_.push(r.RECENT),f++);-1!==(null==(c=s)?void 0:c.findIndex((({product:{vmoji_avatar:e}})=>void 0!==e)))||a||(g.set(r.VMOJI,new h.PackContext({index:f,referrer:i.KEYBOARD,redefine:{id:r.VMOJI,title:"stickers_picker_vmoji"}})),_.push(r.VMOJI),f++);const E=null==(d=t)?void 0:d[0],y=null==(l=e)?void 0:l.can_edit,I=null==(p=E)||null==(u=p.stickers)?void 0:u.length,S=(null==(v=e)?void 0:v.show_keyboard_onboarding)&&y;if(!(null==(m=e)?void 0:m.is_keyboard_hidden)&&(I||S)){const e=new h.PackContext({pack:E,index:f,referrer:i.KEYBOARD,tooltip:{header:"stickers_picker_ugc_tooltip_title",text:"stickers_picker_ugc_tooltip_description"},redefine:{id:r.UGC,title:"stickers_picker_ugc"}});y&&e.setHint({id:"stickers:ugc_keyboard_onboarding_tooltip",width:176}),g.set(r.UGC,e),_.push(r.UGC),f++}return s.forEach((e=>{const{product:{id:t,vmoji_avatar:s}}=e;if(g.set(t,new h.PackContext({index:f,referrer:i.KEYBOARD,pack:e})),s){let e=k.get(s.id);e||(e=_.push([])-1,k.set(s.id,e));const r=_[e];Array.isArray(r)&&r.push(t)}else _.push(t);f++})),{packs:g,packsGroups:_}}))},703104:(e,t,s)=>{s.d(t,{$stockItems:()=>o,setStockItems:()=>i});var r=s(348354);const i=r.stickersEmojiKeyboard.createEvent(),o=r.stickersEmojiKeyboard.createStore(null).on(i,((e,t)=>t))},730368:(e,t,s)=>{s.d(t,{$recentStickers:()=>o,setRecentStickers:()=>i});var r=s(348354);const i=r.stickersEmojiKeyboard.createEvent(),o=r.stickersEmojiKeyboard.createStore(null).on(i,((e,t)=>t))},944952:(e,t,s)=>{s.d(t,{$ugcInfo:()=>u,reloadUGCInfo:()=>d,setUGCInfo:()=>c});var r=s(11010),i=s(798116),o=s(879706),n=s(348354),a=s(910850);const c=n.stickersEmojiKeyboard.createEvent(),d=n.stickersEmojiKeyboard.createEvent(),l=n.stickersEmojiKeyboard.createEffect((0,r._)((function*(e){return e.cache.ugcInfo.get().catch((()=>null))}))),u=n.stickersEmojiKeyboard.createStore(null).on(c,((e,t)=>t)).on(l.doneData,((e,t)=>t)).on(a.submitUGCReportFx.doneData,(()=>null));(0,i.sample)({clock:d,source:o.$api,target:l})},734264:(e,t,s)=>{s.d(t,{$ugcPacks:()=>n,setUGCPacks:()=>o});var r=s(348354),i=s(910850);const o=r.stickersEmojiKeyboard.createEvent(),n=r.stickersEmojiKeyboard.createStore(null).on(o,((e,t)=>t)).on(i.submitUGCReportFx.doneData,(()=>null))},910850:(e,t,s)=>{s.d(t,{submitUGCReport:()=>n,submitUGCReportFx:()=>a});var r=s(798116),i=s(879706),o=s(348354);const n=o.stickersEmojiKeyboard.createEvent(),a=o.stickersEmojiKeyboard.createEffect((e=>{e.cache.clearUGC()}));(0,r.sample)({clock:n,source:i.$api,target:a})},478748:(e,t,s)=>{s.d(t,{API:()=>d});var r=s(434788),i=s(820224),o=s(964548),n=s(164702),a=s(960294),c=s(254734);class d extends o.API{constructor(e){var{onAPIRequest:t}=e,s=(0,i._)(e,["onAPIRequest"]);const{userId:d}=s;super({requestMethod:t},{userId:d,source:"stickers"}),this.cache=new n.Cache((0,r._)({api:this},s)),this.updates.addEventListener(o.StickersQueueEventType.UGC_OWNER_UPDATE,a.stickersUGCOwnerUpdateHandler.bind(this)),this.updates.addEventListener(o.StickersQueueEventType.UGC_STICKER_UPDATE,c.stickersUGCStickerUpdateHandler.bind(this))}}},960294:(e,t,s)=>{function r({detail:{owner_global_id:e}}){this.cache.reloadUGC(e)}s.d(t,{stickersUGCOwnerUpdateHandler:()=>r})},254734:(e,t,s)=>{s.d(t,{stickersUGCStickerUpdateHandler:()=>n});var r=s(11010);const i=new Map,o=new Set;function n(e){return a.apply(this,arguments)}function a(){return(a=(0,r._)((function*({detail:{stickers:e}}){const{peerId:t}=this.cache.options;e.forEach((e=>{if(e.owner_id!==t)return;let s=i.get(t);s||(s=[],i.set(t,s));const r=s.findIndex((t=>t.id===e.id&&t.pack_id===e.pack_id&&t.owner_id===e.owner_id));-1!==r?s[r]=e:s.push(e)})),c.call(this)}))).apply(this,arguments)}function c(){return d.apply(this,arguments)}function d(){return(d=(0,r._)((function*(){var e,t;const{peerId:s}=this.cache.options;if(!s||o.has(s))return;const r=i.get(s);if(!(null==(e=r)?void 0:e.length))return;o.add(s),i.delete(s);const n=yield this.cache.ugcPacks.get();if(!(null==(t=n)?void 0:t.length))return;const a=new Map(n.map((e=>[e.id,e])));r.forEach((e=>{const{id:t,pack_id:s}=e;if(void 0===s)return;const r=a.get(s);if(!r)return;const i=r.stickers.findIndex((e=>e.id===t));-1!==i&&(r.stickers[i]=e)})),yield this.cache.ugcPacks.set(n).catch((()=>{})),o.delete(s),c.call(this)}))).apply(this,arguments)}},153526:(e,t,s)=>{s.d(t,{reloadFavoriteStickers:()=>i});var r=s(11010);function i(){return o.apply(this,arguments)}function o(){return(o=(0,r._)((function*(){const e=yield this.options.api.store.getFavoriteStickers().then((({items:e})=>e)).catch((()=>null));return!!e&&(yield this.favoriteStickers.set(e),!0)}))).apply(this,arguments)}},859668:(e,t,s)=>{s.d(t,{reloadGlobal:()=>i});var r=s(11010);function i(){return o.apply(this,arguments)}function o(){return(o=(0,r._)((function*(){var e,t,s,r,i,o,n,a,c,d,l,u,h;if(this.reloading)return!0;this.setReloading(!0);const p=yield this.global.get();let[v,m,g]=yield Promise.all([this.options.api.store.hasNewItems({type:"stickers",version_hash:String(null==(e=p)?void 0:e.stickers_version_hash)}).catch((()=>null)),this.stockItems.get(),this.imageConfigs.get()]);if(!v)return this.setReloading(!1),!1;(h=v).sticker_packs_version_hashes||(h.sticker_packs_version_hashes=null==(t=p)?void 0:t.sticker_packs_version_hashes);const{stickers_version_hash:_,sticker_packs_version_hashes:k,favorite_stickers_version_hash:f,image_configs_version_hash:E,sticker_packs_chunk_size_limit:y,vmoji_promotion:I}=v;_!==(null==(s=p)?void 0:s.stickers_version_hash)&&(m=null,this.stickersListAsync.clear());const S=[this.reloadStockItems({cachedStockItems:m,actualPacksHashes:k,chunkSize:y}),this.reloadUGC(),this.reloadVmoji(),this.reloadRecentStickers()];f!==(null==(r=p)?void 0:r.favorite_stickers_version_hash)&&S.push(this.reloadFavoriteStickers()),g&&E===(null==(i=p)?void 0:i.image_configs_version_hash)||S.push(this.reloadImageConfigs());const A=!(null==(n=I)||null==(o=n.avatar_suggestion)?void 0:o.character_id);return!A&&(null==(c=I)||null==(a=c.avatar_suggestion)?void 0:a.character_id)!==(null==(u=p)||null==(l=u.vmoji_promotion)||null==(d=l.avatar_suggestion)?void 0:d.character_id)?S.push(this.reloadHelpHint()):A&&this.clearAllHelpHint(),Promise.all(S).then((e=>{this.setReloading(!1);const t=-1===e.findIndex((e=>!e));return t&&v&&(this.global.set(v),this.stickersSync.notify(void 0,!0)),t}))}))).apply(this,arguments)}},978025:(e,t,s)=>{s.d(t,{clearAllHelpHint:()=>o,clearHelpHintById:()=>i});var r=s(63767);function i(e){var t;null==(t=this[r.AtomNameByHelpHintId[e]])||t.delete()}function o(){r.HelpHintAtomNames.forEach((e=>this[e].delete()))}},870308:(e,t,s)=>{s.d(t,{hideHelpHint:()=>i});var r=s(11010);function i(e){return o.apply(this,arguments)}function o(){return(o=(0,r._)((function*(e){return this.clearHelpHintById(e),this.options.api.account.hideHelpHint({hint_id:e}).then(Boolean).catch((()=>!1))}))).apply(this,arguments)}},787039:(e,t,s)=>{s.d(t,{reloadHelpHint:()=>o});var r=s(11010),i=s(63767);function o(){return n.apply(this,arguments)}function n(){return(n=(0,r._)((function*(){var e;let t=i.HelpHintAtomNames.slice();const s=yield this.options.api.account.getHelpHints({categories:"vmoji_promo"}).catch((()=>null));return(null==(e=s)?void 0:e.items)?(s.items.forEach((e=>{const s=e.id,r=i.AtomNameByHelpHintId[s];var o;r in this&&(null==(o=this[r])||o.set(e,{notify:!0}),t=t.filter((e=>e!==r)))})),t.forEach((e=>{this[e].delete()})),!0):(this.clearAllHelpHint(),!0)}))).apply(this,arguments)}},539442:(e,t,s)=>{s.d(t,{markHelpHintAsViewed:()=>o});var r=s(63767);const i=(0,s(659397).throttle)((function(e,t,s){e.options.api.stickers.markPromoAsViewed({promo_id:t,count:s})}),3e4);function o(e){var t;const s=this[r.AtomNameByPromoId[e]],o=((null==(t=s)?void 0:t.get())||0)+1;i.call(this,this,e,o),s.set(o)}},441695:(e,t,s)=>{s.d(t,{reloadImageConfigs:()=>i});var r=s(11010);function i(){return o.apply(this,arguments)}function o(){return(o=(0,r._)((function*(){const e=yield this.options.api.store.getStickersImageConfigs().catch((()=>null));return!!e&&(this.imageConfigs.set(e),!0)}))).apply(this,arguments)}},957627:(e,t,s)=>{s.d(t,{reloadRecentStickers:()=>i});var r=s(11010);function i(){return o.apply(this,arguments)}function o(){return(o=(0,r._)((function*(){const e=yield this.options.api.messages.getRecentStickers().then((({items:e})=>e)).catch((()=>null));return e&&this.recentStickers.set(e),!0}))).apply(this,arguments)}},844411:(e,t,s)=>{s.d(t,{getStickers:()=>i});var r=s(11010);function i(e){return o.apply(this,arguments)}function o(){return(o=(0,r._)((function*(e){const t=yield Promise.all(e.map((e=>this.stickersListAsync.createAtom(String(e)).get())));if(!t.includes(null))return t;const s=new Map,r=t.reduce(((t,r,i)=>{if(!r){const r=e[i];t.push(r),s.set(r,i)}return t}),[]);return(yield this.options.api.store.getStickers({sticker_ids:String(r)})).forEach((e=>{const{sticker_id:r}=e;if(!r)return;this.stickersListAsync.createAtom(String(r)).set(e);const i=s.get(r);i&&(t[i]=e)})),t}))).apply(this,arguments)}},161260:(e,t,s)=>{function r({active:e}){return this.stockItems.get().then((t=>(t&&(t=t.sort((({product:{vmoji_avatar:e}},{product:{vmoji_avatar:t}})=>Number(Boolean(t))-Number(Boolean(e)))),e&&(t=t.filter((({product:{active:e}})=>e)))),t)))}s.d(t,{getStockItems:()=>r})},801115:(e,t,s)=>{s.d(t,{loadStockItems:()=>i});var r=s(11010);function i(e){return o.apply(this,arguments)}function o(){return(o=(0,r._)((function*({productId:e,stickerId:t}){const s=yield this.stockItems.get();let r;return s&&(e&&(r=s.find((({product:{id:t}})=>t===e))),t&&!r&&(r=s.find((({product:{stickers:e}})=>e&&-1!==e.findIndex((({sticker_id:e})=>e===t)))))),r||(e&&(r=yield this.options.api.store.getStockItemByProductId({type:"stickers",product_id:String(e)}).catch((()=>{}))),r?(this.updateStockItems([r]),r):(t&&(r=yield this.options.api.store.getStockItemByStickerId({sticker_id:t}).catch((()=>{}))),r&&this.updateStockItems([r]),r))}))).apply(this,arguments)}},744035:(e,t,s)=>{s.d(t,{reloadStockItems:()=>n});var r=s(11010),i=s(659397);const o=new Map;function n(e){return a.apply(this,arguments)}function a(){return(a=(0,r._)((function*({chunkSize:e=25,cachedStockItems:t,actualPacksHashes:s}){var r,n,a;let c=o.get(this.stickersSync.key);c||(c=new Map,o.set(this.stickersSync.key,c));let d=null==(r=t)?void 0:r.reduce(((e,{product:{id:t},version_hash:r})=>{var i;const o=null==(i=s)?void 0:i.find((({pack_id:e})=>e===t));if(!o)return e;return o.hash!==r&&e.push(t),e}),[]);const l=!d;if(l&&(d=yield this.options.api.store.getProducts({type:"stickers",filters:"active"}).then((({items:e})=>e.map((({id:e})=>e)))).catch((()=>{}))),!(null==(n=d)?void 0:n.length))return!0;this.stickersListAsync.clear();let u=yield Promise.all((0,i.chunkArray)(d,e).map((e=>{var t;const s=String(e);return(null==(t=c)?void 0:t.get(s))||this.options.api.store.getStockItems({type:"stickers",product_ids:s}).then((e=>{var t;return null==(t=c)||t.set(s,e),e}))}))).then((e=>e.reduce(((e,{items:t})=>(e.push(...t),e)),[]).filter((e=>!Array.isArray(e))))).catch((()=>null));if(!u)return!1;if(null==(a=t)?void 0:a.length){const e=new Map(u.map((e=>[e.product.id,e])));u=t=t.map((t=>e.get(t.product.id)||t))}return u&&d&&l&&(u=u.sort((({product:{id:e}},{product:{id:t}})=>{var s,r;return Number(null==(s=d)?void 0:s.indexOf(e))-Number(null==(r=d)?void 0:r.indexOf(t))}))),yield this.stockItems.set(u),o.delete(this.stickersSync.key),!0}))).apply(this,arguments)}},895883:(e,t,s)=>{s.d(t,{updateStockItems:()=>i});var r=s(11010);function i(e,t){return o.apply(this,arguments)}function o(){return(o=(0,r._)((function*(e,t){let s=yield this.stockItems.get();if(s){const t=new Map(s.map((e=>{const{product:{id:t}}=e;return[t,e]})));e.forEach((e=>{const{product:{id:s}}=e;t.set(s,e)})),s=[...t.values()]}return this.stockItems.set(s||e,t)}))).apply(this,arguments)}},352319:(e,t,s)=>{function r(){this.ugcInfo.delete(),this.ugcPacks.delete()}s.d(t,{clearUGC:()=>r})},767374:(e,t,s)=>{s.d(t,{hideUGCOnboarding:()=>i});var r=s(11010);function i(){return o.apply(this,arguments)}function o(){return(o=(0,r._)((function*(){var e;const t=yield this.ugcInfo.get();if(!(null==(e=t)?void 0:e.show_keyboard_onboarding))return!1;const{owner_id:s}=t;return t.show_keyboard_onboarding=!1,this.ugcInfo.set(t),this.options.api.stickers.hideUGCKeyboardOnboarding({owner_id:s}).then(Boolean).catch((()=>!1))}))).apply(this,arguments)}},725055:(e,t,s)=>{s.d(t,{reloadUGC:()=>n});var r=s(11010),i=s(723062),o=s(744165);function n(e){return a.apply(this,arguments)}function a(){return(a=(0,r._)((function*(e){if(!(0,o.isUgcStickersEnabled)())return this.clearUGC(),!0;const{peerId:t}=this.options;if(!t||!i.Ranges.isChatOrChannelPeer(t))return!0;const s=yield this.ugcPacks.get(),r=yield this.options.api.stickers.getUGCPackLists({owner_ids:String(t),owner_global_ids:e}).then((({lists:e})=>e[0])).catch((()=>{}));if(!r)return this.ugcInfo.delete(),this.ugcPacks.delete(),!0;this.ugcInfo.set(r);const{items:n}=r;if(!n.length)return this.ugcPacks.delete(),!0;const a=s?new Map(s.map((({id:e,hash:t})=>[e,t]))):void 0,c=n.reduce(((e,{pack_id:t,hash:s})=>{var r;return(null==(r=a)?void 0:r.get(t))!==s&&e.push(t),e}),[]);if(!c.length)return!0;const d=yield this.options.api.stickers.getUGCPacks({owner_id:t,pack_ids:String(c)}).then((({packs:e})=>e)).catch((()=>{}));return!d||(this.ugcPacks.set(d),!0)}))).apply(this,arguments)}},295266:(e,t,s)=>{s.d(t,{clearVmojiPromotionDot:()=>i});var r=s(11010);function i(){return o.apply(this,arguments)}function o(){return(o=(0,r._)((function*(){var e;const t=yield this.global.get();(null==(e=t)?void 0:e.vmoji_promotion)&&(t.vmoji_promotion.dot_color=void 0,this.global.set(t,{notify:!1}))}))).apply(this,arguments)}},20830:(e,t,s)=>{s.d(t,{reloadVmoji:()=>i});var r=s(11010);function i(){return o.apply(this,arguments)}function o(){return(o=(0,r._)((function*(){return this.hasAvatar.get()||(yield this.options.api.vmoji.getAvatar().then((({characters:e})=>{var t;this.hasAvatar.set(Boolean(null==(t=e)?void 0:t.length))})).catch((()=>{}))),!0}))).apply(this,arguments)}},164702:(e,t,s)=>{s.d(t,{Cache:()=>A});var r=s(380312),i=s(559205),o=s(426775),n=s(352319),a=s(725055),c=s(20830),d=s(844411),l=s(870308),u=s(859668),h=s(161260),p=s(787039),v=s(801115),m=s(744035),g=s(895883),_=s(539442),k=s(767374),f=s(441695),E=s(957627),y=s(295266),I=s(153526),S=s(978025);class A{subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}get reloading(){return this.isReloading}setReloading(e){this.isReloading=e}destroy(){this.stickersSync.destroy(),this.stickersAsync.destroy(),this.stickersListAsync.destroy()}constructor(e){this.isReloading=!1,this.listeners=new Set,this.reload=u.reloadGlobal.bind(this),this.reloadVmoji=c.reloadVmoji.bind(this),this.clearVmojiPromotionDot=y.clearVmojiPromotionDot.bind(this),this.getStockItem=v.loadStockItems.bind(this),this.getStockItems=h.getStockItems.bind(this),this.updateStockItems=g.updateStockItems.bind(this),this.reloadStockItems=m.reloadStockItems.bind(this),this.reloadUGC=a.reloadUGC.bind(this),this.clearUGC=n.clearUGC.bind(this),this.hideUGCOnboarding=k.hideUGCOnboarding.bind(this),this.reloadRecentStickers=E.reloadRecentStickers.bind(this),this.reloadFavoriteStickers=I.reloadFavoriteStickers.bind(this),this.reloadImageConfigs=f.reloadImageConfigs.bind(this),this.getStickers=d.getStickers.bind(this),this.reloadHelpHint=p.reloadHelpHint.bind(this),this.clearHelpHintById=S.clearHelpHintById.bind(this),this.clearAllHelpHint=S.clearAllHelpHint.bind(this),this.hideHelpHint=l.hideHelpHint.bind(this),this.markHelpHintAsViewed=_.markHelpHintAsViewed.bind(this);const{userId:t,peerId:s}=e;this.options=e;const A=(0,r.createSyncStore)({dbName:"stickers",storeName:String(t),version:1}),b=(0,i.createAsyncStore)({dbName:"stickers",storeName:String(t),version:1}),P=(0,i.createAsyncStore)({dbName:"stickers-list",storeName:String(t),version:1});this.stickersSync=A,this.stickersAsync=b,this.stickersListAsync=P,this.global=b.createAtom("global"),this.stockItems=b.createAtom("stockItems"),this.imageConfigs=b.createAtom("imageConfigs"),this.recentStickers=b.createAtom("recentStickers"),this.favoriteStickers=b.createAtom("favoriteStickers"),this.avatarSuggestion=b.createAtom("avatarSuggestion"),this.hasAvatar=A.createAtom("hasAvatar",o.SyncAtomType.BOOLEAN),this.recentEmoji=A.createAtom("recentEmoji",o.SyncAtomType.OBJECT),this.tabbarActiveTab=A.createAtom("tabbarActiveTab",o.SyncAtomType.STRING),this.stickersActiveTab=A.createAtom("stickersActiveTab",o.SyncAtomType.NUMBER),this.avatarSuggestionCounter=A.createAtom("avatarSuggestionCounter",o.SyncAtomType.NUMBER);const C=(0,i.createAsyncStore)({dbName:"stickers-ugc",storeName:`${t}-${s}`,version:1});this.ugcAsync=C,this.ugcInfo=C.createAtom("ugcInfo"),this.ugcPacks=C.createAtom("ugcPacks"),this.getStickersImageConfigs=this.imageConfigs.get.bind(this.imageConfigs)}}},744165:(e,t,s)=>{s.d(t,{isPromoVmojiCounterEnabled:()=>n,isUgcStickersEnabled:()=>o});var r=s(616912);function i(e){return Boolean(r.$userEnv.getState()[e])}const o=()=>i("stickers.ugc"),n=()=>i("vmoji.promo.avatar_suggestion.promo_counter")},570912:(e,t,s)=>{function r(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}s.d(t,{_:()=>r})},615816:(e,t,s)=>{s.d(t,{_:()=>i});var r=0;function i(e){return"__private_"+r+++"_"+e}}}]);try{stManager.done("dist/d7637cb5aaf3b67033e89d5e93cde306.09bbb4aaad6db8dbf057.js")}catch(e){}