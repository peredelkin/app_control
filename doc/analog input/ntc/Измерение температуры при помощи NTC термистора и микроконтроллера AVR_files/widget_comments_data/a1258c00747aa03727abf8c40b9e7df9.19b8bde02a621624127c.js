"use strict";(self.webpackChunkvk=self.webpackChunkvk||[]).push([[43639],{401703:(e,t,i)=>{i.d(t,{Icon24Gift:()=>o});var o=(0,i(28178).makeIcon)("Icon24Gift","gift_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="gift_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path fill="currentColor" d="M21 10v2a1 1 0 0 1-1 1h-1v6.5a2.5 2.5 0 0 1-2.5 2.5h-9A2.5 2.5 0 0 1 5 19.5V13h1-2a1 1 0 0 1-1-1v-2a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2Zm-8 3h6v2h-6v7h-2v-7H5v-2h6V8h2v5Zm-1-5C9 8 5.5 7 5.5 5.5s2-3 3.5-2.5c1 .333 2 2 3 5 1-3 2-4.667 3-5 1.5-.5 3.5 1 3.5 2.5S15 8 12 8Z" /></g></symbol>',24,24,!1,void 0)},225892:(e,t,i)=>{i.d(t,{isHintsOfMentionsOpen:()=>s});var o=i(795558);const s=e=>{var t;const i=(0,o.data)(e,"composer");return(null==(t=i)?void 0:t.wdd)&&(0,o.isVisible)(i.wdd.listWrap)}},72230:(e,t,i)=>{i.d(t,{cachedStickersKeywordsTime:()=>_,getStickerKeywordsCacheData:()=>a,setStickerKeywordsCacheData:()=>l});var o=i(891047),s=i(531730),n=i(839470);const r="stickers_keywords",c=(()=>{let e=!1;try{indexedDB}catch(t){if("SecurityError"!==t.name)throw t;e=!0}return(0,n.partConfigEnabled)("stickers_keywords_idb_cache")&&"indexedDB"in window.self&&!e})()?(0,o.createStore)("emoji-db-v1","emoji-cache"):null;function a(){return c?(0,o.get)(r,c):Promise.resolve(s.ls.get(r))}function l(e){return c?(0,o.set)(r,e,c).then((()=>{s.ls.remove(r)})):Promise.resolve(s.ls.set(r,e))}function _(){return a().then((e=>{var t;const i=(null==(t=e)?void 0:t.time)||0;return Math.floor(i/1e3)}))}},391650:(e,t,i)=>{i.d(t,{initStickersKeywords:()=>a,setStickersKeywords:()=>l});var o=i(795558),s=i(72230),n=i(664988),r=i(790287),c=i(531730);function a(){window.stickersKeywordsData?l(window.stickersKeywordsData):(0,s.getStickerKeywordsCacheData)().then((e=>{if(!e)return;const{keywords:t,time:i}=e;i>(0,n.vkNow)()-r.Emoji.stickersKeywordsExpire&&(window.stickersKeywordsData=t),window.stickersKeywordsData&&l(window.stickersKeywordsData)}))}function l(e,t){if(!e)return;window.stickersKeywords={};let i="";const a=e.reduce(((e,t)=>{const{user_stickers:o,promoted_stickers:s}=t;let{words:n}=t;const r=s.map((e=>-e)),c=o.concat(r);return Array.isArray(n)||(n=[...Object.values(n)]),n.forEach((t=>{i+="\n"+t,e.push(c)})),e}),[]);if(i=function(e){const t=document.createElement("div");return(0,o.val)(t,e),t.textContent||t.innerText}(i),i&&i.slice(1).split("\n").forEach(((e,t)=>{window.stickersKeywords[e]=a[t]})),!r.Emoji.stickers[r.Emoji.TAB_RECENT_STICKERS]){let e=c.ls.get("recent_stickers");e&&(r.Emoji.stickers[r.Emoji.TAB_RECENT_STICKERS]=e)}t&&(0,s.setStickerKeywordsCacheData)({time:(0,n.vkNow)(),keywords:e}).then((()=>{r.Emoji.updateStickersHints(!0)}))}},582389:(e,t,i)=>{i.d(t,{moveStickersHintsToStickerPicker:()=>s});const o="StickersHints__marginTransition",s=(e,t)=>{var i;const s=window.Emoji.opts[e];if(!(null==(i=s)?void 0:i.txt))return;const n=s.txt.parentNode.querySelector("._sticker_hints");if(!n)return;if(!("none"!==getComputedStyle(n).getPropertyValue("display")))return;t&&(n.classList.add(o),requestAnimationFrame((()=>n.classList.remove(o)))),n.style.setProperty("margin-left","0px");const{right:r}=n.getBoundingClientRect();if(window.StickerPickerViewer){const{isShown:e,isDown:t,wrapper:i}=window.StickerPickerViewer;if(!e||!i||t)return;const o=-(r-i.getBoundingClientRect().left+10);n.style.setProperty("margin-left",`${o}px`)}}},386776:(e,t,i)=>{i.d(t,{initNewStickerPicker:()=>c,setUserEnvForStickerPicker:()=>a});var o=i(11010),s=i(616912),n=i(396316);let r=0;const c=(0,o._)((function*(){if(r++,!(r>3))try{const{StickerPickerViewer:e}=yield Promise.all([i.e(98066),i.e(24509),i.e(76429),i.e(38288),i.e(13492),i.e(16493),i.e(65040),i.e(76244),i.e(58443),i.e(68346)]).then(i.bind(i,140654));window.StickerPickerViewer=new e}catch(e){setTimeout((()=>{c()}),3e3)}})),a=()=>{(0,s.setUserEnv)({[n.STICKERS_CONFDATA_KEY.UGC]:(0,n.isUGCStickersEnabled)(),[n.STICKERS_CONFDATA_KEY.PROMO_VMOJI_COUNTER]:(0,n.isPromoVmojiCounterEnabled)()})}},630686:(e,t,i)=>{i.d(t,{showPackByClickOnSticker:()=>r});var o,s=i(396316);!function(e){e.MESSAGE="message"}(o||(o={}));const n=e=>window.Emoji.previewSticker(e,!1,{sticker_referrer:"message"}),r=(e,t)=>{var i;(0,s.isNewStickerPicker)()?null==(i=window.StickerPickerViewer)||i.api.getPack({productId:e}).then((i=>{var o,s;var r;Boolean(null==(s=i)||null==(o=s.product)?void 0:o.active)?null==(r=window.StickerPickerViewer)||r.showPack(e,t):n(e)})).catch((()=>{n(e)})):window.Emoji.getStickerPack(e).then((i=>{Boolean(i&&i[window.Emoji.PACK_FIELD_IS_ACTIVE])?window.Emoji.showPackInKeyboard(e,t):n(e)}))}},34672:(e,t,i)=>{i.d(t,{default:()=>_});var o=i(785893),s=i(667294),n=i(659397),r=i(997650),c=i(899033),a=i(263031),l=i(821126);const _=({className:e,sticker:t,theme:i=c.Theme.LIGHT,width:_,height:d})=>{const[u,m]=(0,r.useInView)({threshold:0}),h=void 0!==t.animation,[p,f]=(0,s.useState)(!1);return(0,o.jsx)("div",{className:(0,n.classNames)("Sticker",e),ref:u,onMouseEnter:()=>{f(!0)},onMouseLeave:()=>{f(!1)},children:h?(0,o.jsx)(l.default,{sticker:t,theme:i,width:_,height:d,isInView:m,play:p}):(0,o.jsx)(a.default,{sticker:t,theme:i,width:_,height:d,isInView:m})})}},821126:(e,t,i)=>{i.d(t,{default:()=>_});var o=i(434788),s=i(785893),n=i(667294),r=i(659397),c=i(211248),a=i.n(c),l=i(457299);const _=({className:e,sticker:t,theme:i,width:c,height:_,isInView:d=!0,play:u=!1})=>{const m=(0,n.useRef)(null),[h,p]=(0,n.useState)(null),f=(0,l.getStickerAnimationUrl)(t,i);return(0,n.useEffect)((()=>{if(!h||!h.isLoaded)return;const e=u&&d;e&&!h.playing&&(h.item.play(),p((0,o._)({},h,{playing:!0}))),!e&&h.playing&&(h.item.pause(),p((0,o._)({},h,{playing:!1})))}),[h,u,d]),(0,n.useEffect)((()=>{if(!h||h.url!==f)if(h&&h.item.destroy(),f&&d){const e=a().loadAnimation({container:m.current,path:f,renderer:"svg",autoplay:!1,loop:!0,rendererSettings:{className:"StickerAnimation__animation",progressiveLoad:!0,hideOnTransparent:!0}}),t={url:f,isLoaded:!1,item:e,playing:!1};e.addEventListener("DOMLoaded",(()=>{p((0,o._)({},t,{isLoaded:!0}))})),p(t)}else p(null)}),[f,d]),(0,s.jsx)("div",{className:(0,r.classNames)("StickerAnimation",e),style:{width:c,height:_},ref:m})}},263031:(e,t,i)=>{i.d(t,{default:()=>c});var o=i(785893),s=i(667294),n=i(659397),r=i(457299);const c=({className:e,sticker:t,theme:i,width:c,height:a,isInView:l=!0})=>{const _=(0,s.useRef)(null),d=(0,r.getStickerImageUrl)(t,c,a,i);return(0,s.useLayoutEffect)((()=>{_.current&&_.current.src!==d&&l&&(_.current.src=d)}),[l,d]),(0,o.jsx)("div",{className:(0,n.classNames)("StickerImage",e),style:{width:c,height:a},children:(0,o.jsx)("img",{className:"StickerImage__image",ref:_})})}},685463:(e,t,i)=>{i.d(t,{default:()=>I});var o=i(785893),s=i(667294),n=i(86894),r=i(584356),c=i(514986),a=i(221780),l=i(29271),_=i(832550),d=i(331533),u=i(401703),m=i(899033),h=i(874162),p=i(898718),f=i(991243),k=i(86601),g=i(467558),w=i(617512),S=i(138255),E=i(34672),v=i(775680),b=i(142886),T=i(358740),j=i(753884),C=i(68003),y=i(659397),P=i(359639);const I=({pack:e,cart:t,options:{recipientIds:i=[],ref:I,gift_ref:O},closeBox:R})=>{const[M]=(0,k.usePack)(e.id);M&&(e=M);const[L,B]=(0,g.useStyles)(e.style_ids||[]),[A,x]=(0,S.useCart)((()=>t)),[D]=(0,w.useWithProducts)(A.getItems()),N=A.getProducts(),H=A.getOrder(),K=(0,p.getSticker)(e.sticker_ids[0]),W=function(e){if(!e)return null;const t=[],i=[];for(const o of e.items){const{product:e,error:s}=o;e&&!s&&((0,m.isPackProduct)(e)?t.push(o):(0,m.isStyleProduct)(e)&&i.push(o))}const o=i.reduce(((e,t)=>{var i;return e+((null==(i=t.price)?void 0:i.current)||0)}),0);if(t.length){const e=t.reduce(((e,t)=>{var i;return e+((null==(i=t.price)?void 0:i.current)||0)}),0);return e?i.length?o?(0,a.langStr)(l.getLang("purchases_stickers_order_summary_pack_for_styles_for",i.length),"pack_price",l.getLang("global_n_votes",e),"styles_num",i.length,"styles_price_sum",o):(0,a.langStr)(l.getLang("purchases_stickers_order_summary_pack_for_styles_free",i.length),"pack_price",l.getLang("global_n_votes",e),"styles_num",i.length):(0,a.langStr)(l.getLang("purchases_stickers_order_summary_pack_for"),"pack_price",l.getLang("global_n_votes",e)):i.length?o?(0,a.langStr)(l.getLang("purchases_stickers_order_summary_pack_free_styles_for",i.length),"styles_num",i.length,"styles_price_sum",l.getLang("global_n_votes",o)):(0,a.langStr)(l.getLang("purchases_stickers_order_summary_pack_free_styles_free",i.length),"styles_num",i.length):(0,a.langStr)(l.getLang("purchases_stickers_order_summary_pack_free"))}if(i.length)return o?(0,a.langStr)(l.getLang("purchases_stickers_order_summary_styles_for",i.length),"styles_num",i.length,"styles_price_sum",l.getLang("global_n_votes",o)):(0,a.langStr)(l.getLang("purchases_stickers_order_summary_styles_free",i.length),"styles_num",i.length);return null}(H),V=!x&&H&&!H.error,[U,F]=(0,s.useState)(!1);let $=null;if(H)if(H.error){if(H.error===h.ORDER_ERRORS.NOT_SIGNED_IN){const e=()=>{(0,r.showDoneBox)(l.getLang("purchases_please_sign_in").replace(/\{link\}(.*?)\{\/link\}/,"<a href=\"/join\" onclick=\"return !showBox('join.php', { act: 'box', from: nav.strLoc }, {}, event)\">$1</a>"))};$=(0,o.jsx)(_.Button,{mode:"primary",size:"m",loading:x,onClick:e,children:l.getLang("purchases_stickers_get_pack_btn")})}else if(H.error===h.ORDER_ERRORS.NO_VALID_ITEMS){if(1===H.items.length){const{product:e,error:t}=H.items[0];if(e&&t!==h.ORDER_ITEM_ERRORS.DUPLICATE_PRODUCT&&e.purchase_details){const{label:t,title:i,text:s,button_title:n,button_url:r}=e.purchase_details,a=()=>{(0,c.showFastBox)(i||l.getLang("purchases_stickers_catalog_purchase_details_title"),s,r&&n||void 0,r?()=>{window.location.href=r}:void 0)};$=(0,o.jsx)(_.Button,{mode:"primary",size:"m",loading:x,onClick:a,children:t||l.getLang("purchases_stickers_product_unavailable")})}}if(!$){const e=!H.items.find((e=>e.error!==h.ORDER_ITEM_ERRORS.DUPLICATE_PRODUCT));$=(0,o.jsx)(_.Button,{mode:"secondary",size:"m",disabled:!0,children:e?l.getLang("purchases_stickers_product_purchased"):l.getLang("purchases_stickers_product_unavailable")})}}}else{const e=()=>{U||(F(!0),A.order({ref:I,gift_ref:O}).then((e=>{F(!1),e&&!e.error&&(0,r.showDoneBox)((0,f.getPurchaseResult)(e))}),(()=>{})))},t=x||U;$=(0,o.jsx)(T.default,{mode:"primary",size:"m",loading:t,disabled:t,price:H.price,text:H.price.current?l.getLang("purchases_stickers_buy_for"):l.getLang("purchases_stickers_get_for_free"),onClick:e})}const z=!x&&void 0!==N.find((e=>{var t;return null==(t=e)?void 0:t.can_gift})),q=D.reduce(((e,t)=>(t.product&&t.product.copyright&&e.add(t.product.copyright),e)),new Set),Y=C.colorScheme.isDarkScheme()?m.Theme.DARK:m.Theme.LIGHT;return(0,o.jsxs)("article",{className:"StickerPackPreview",children:[(0,o.jsxs)("header",{className:"StickerPackPreview__header",children:[(0,o.jsx)(P.MessageBoxDismissButton,{onClick:R}),K&&(0,o.jsx)(E.default,{className:"StickerPackPreview__icon",sticker:K,theme:Y,width:128,height:128}),(0,o.jsxs)("div",{className:"StickerPackPreview__info",children:[(0,o.jsx)(d.InnerHTML,{Component:"h1",className:"StickerPackPreview__title",children:e.title}),(0,o.jsx)(d.InnerHTML,{Component:"div",className:"StickerPackPreview__author",children:e.author}),(0,o.jsx)(d.InnerHTML,{Component:"div",className:"StickerPackPreview__description",children:e.description})]})]}),L.length>0&&(0,o.jsx)(v.default,{className:"StickerPackPreview__styles",styles:L,isLoading:B,isAdded:e=>A.hasProduct(e.id),add:e=>A.addProduct(e.id),remove:e=>A.removeProduct(e.id),gift:e=>{return t=e.id,void(0,j.giftStickerProducts)([t],i);var t}}),(0,o.jsxs)("div",{className:"StickerPackPreview__footerContainer",children:[(0,o.jsx)("section",{className:"StickerPackPreview__items",children:D.map((e=>(0,o.jsx)(b.default,{item:e,showHeader:L.length>0,remove:e.product&&(0,m.isStyleProduct)(e.product)?()=>A.removeProduct(e.product_id):void 0},e.product_id)))}),q.size>0&&(0,o.jsx)("section",{className:"StickerPackPreview__copyrights",children:Array.from(q).map(((e,t)=>(0,o.jsx)("div",{className:"StickerPackPreview__copyright",children:(0,y.decodeHTMLEntities)(e)},t)))}),(0,o.jsxs)("footer",{className:"StickerPackPreview__footer",children:[!x&&(V||z)&&(0,o.jsx)("div",{className:"StickerPackPreview__footerNote",children:W}),(0,o.jsxs)(n.ButtonGroup,{children:[z&&(0,o.jsx)(_.Button,{mode:"primary",size:"m",onClick:()=>(()=>{const e=A.copy();e.setRecipientIds(i),(0,j.giftStickersCart)(e)})(),before:(0,o.jsx)(u.Icon24Gift,{width:20,height:20}),children:l.getLang("purchases_stickers_gift")}),$]})]})]})]})}},714117:(e,t,i)=>{i.d(t,{default:()=>v});var o=i(434788),s=i(785893),n=i(667294),r=i(86894),c=i(221780),a=i(29271),l=i(549309),_=i(562329),d=i(331533),u=i(832550),m=i(899033),h=i(581522),p=i(902220),f=i(86601),k=i(467558),g=i(775680),w=i(740906),S=i(358740),E=i(753884);const v=({pack:e,options:t,closeBox:i,updateBox:v})=>{const[b,T]=(0,f.usePack)(e.id);b&&(e=b);const[j,C]=(0,k.useStyles)(e.style_ids||[]),y=T||C;(0,n.useEffect)((()=>{v()}),[y]);const P=(0,o._)({},e,{base_id:e.id,title:a.getLang("purchases_stickers_product_preview_title_base_pack"),style_sticker_ids:e.sticker_ids}),I=[P,...j],O=I.find((e=>e&&e.is_active))||P,[R,M]=(0,n.useState)(),L=R&&I.find((e=>e&&e.id===R)),B=e=>{M(e&&e.id)},A=L||O,x=A===P?a.getLang("purchases_stickers_product_preview_title_base_pack"):(0,c.langStr)(a.getLang("purchases_stickers_product_preview_title_style"),"title",A.title);(0,n.useEffect)((()=>{A.is_new&&(0,h.updateUserProductState)(A.id,m.UserProductStateKey.IsNew,0).finally((()=>{}))}),[A,A.is_new]);const[D,N]=(0,n.useState)(!1),[H,K]=(0,n.useState)(!1);return(0,s.jsxs)("article",{className:"StickerPackSettings",children:[(0,s.jsx)(l.ModalHeader,{className:"StickerPackSettings__header",title:e?(0,c.langStr)(a.getLang("purchases_stickers_style_selection_for_pack"),"title",e.title):"",onClose:i}),y?(0,s.jsx)("section",{className:"StickerPackSettings__content StickerPackSettings__content--loading",children:(0,s.jsx)(_.default,{size:24})}):(0,s.jsxs)(n.Fragment,{children:[I.length>0&&(0,s.jsx)(g.default,{className:"StickerPackSettings__styles",styles:I,isLoading:C,activeStyle:O,selectedStyle:A,select:e=>B(e)}),(0,s.jsxs)("div",{className:"StickerPackSettings__footerContainer",children:[(0,s.jsxs)("section",{className:"StickerPackSettings__stylePreview",children:[(0,s.jsx)(d.InnerHTML,{Component:"h2",className:"StickerPackSettings__stylePreviewTitle",children:x}),(0,s.jsx)(w.default,{product:A})]}),(0,s.jsx)("footer",{className:"StickerPackSettings__footer",children:(0,s.jsxs)(r.ButtonGroup,{children:[A.can_gift&&(0,s.jsx)(u.Button,{mode:"secondary",size:"m",onClick:()=>{return e=A.id,void(0,E.giftStickerProducts)([e],t.recipientIds||[]);var e}}),A.is_purchased?(0,s.jsx)(u.Button,{mode:"primary",size:"m",disabled:A===O,loading:H,onClick:()=>{return e=A,void(H||(K(!0),(0,h.activateProduct)(e).then((()=>{K(!1),B(void 0)}),(()=>{}))));var e},children:a.getLang("purchases_stickers_product_settings_save")}):(0,s.jsx)(S.default,{className:"StickerPackSettings__buy",mode:"primary",size:"m",price:A.price.purchase,text:A.price.purchase.current?a.getLang("purchases_stickers_buy_for"):a.getLang("purchases_stickers_get_for_free"),loading:D,onClick:()=>{return e=A,void(D||(N(!0),p.Cart.create([e.id]).load().then((e=>e.order())).then((()=>{N(!1)}),(()=>{}))));var e}})]})})]})]})]})}},333330:(e,t,i)=>{i.d(t,{default:()=>l});var o=i(785893),s=i(832550),n=i(221780),r=i(29271),c=i(549309),a=i(740906);const l=({style:e,options:{add:t},closeBox:i})=>(0,o.jsxs)("article",{className:"StickerStylePreview",children:[(0,o.jsx)(c.ModalHeader,{className:"StickerStylePreview__header",title:(0,n.langStr)(r.getLang("purchases_stickers_stickers_of_style"),"title",e.title),onClose:i}),(0,o.jsx)(a.default,{className:"StickerStylePreview__content",product:e}),(0,o.jsxs)("footer",{className:"StickerStylePreview__footer",children:[(0,o.jsx)(s.Button,{mode:"tertiary",size:"m",onClick:i,children:r.getLang("global_cancel")}),t&&(0,o.jsx)(s.Button,{mode:"primary",size:"m",onClick:()=>t(e),children:r.getLang("purchases_stickers_preview_add_item")})]})]})},775680:(e,t,i)=>{i.d(t,{default:()=>_});var o=i(785893),s=i(659397),n=i(29271),r=i(401840),c=i(159868),a=i(206198),l=i(652219);const _=({className:e,styles:t,isLoading:i,isAdded:_,add:d,remove:u,gift:m,activeStyle:h,selectedStyle:p,select:f})=>{const k=(0,a.default)({wrapperSelector:".StickerStylesMenu__wrapper",itemSelector:".StickerStylesMenu__item"});if(i)return(0,o.jsx)("section",{className:(0,s.classNames)("StickerStylesMenu","StickerStylesMenu--loading",e),children:(0,o.jsx)(c.default,{className:"StickerStylesMenu__progress"})});const g=[{title:n.getLang("purchases_stickers_purchased_styles"),styles:t.filter((e=>e.is_purchased&&!e.is_disabled))},{title:n.getLang("purchases_stickers_other_styles"),styles:t.filter((e=>!e.is_purchased&&!e.is_disabled&&!e.is_hidden)),tooltip:n.getLang("purchases_stickers_styles_hint")}].filter((e=>e.styles.length));return g.length?(0,o.jsxs)("section",{className:(0,s.classNames)("StickerStylesMenu",e),ref:k.ref,onWheel:e=>k.onWheel(e),children:[(0,o.jsx)("a",{className:(0,s.classNames)("StickerStylesMenu__nav","StickerStylesMenu__nav--prev",{"StickerStylesMenu__nav--disabled":!k.hasPrev}),onClick:()=>k.prev()}),(0,o.jsx)("a",{className:(0,s.classNames)("StickerStylesMenu__nav","StickerStylesMenu__nav--next",{"StickerStylesMenu__nav--disabled":!k.hasNext}),onClick:()=>k.next()}),(0,o.jsx)("div",{className:"StickerStylesMenu__wrapper",children:g.map(((e,t)=>(0,o.jsxs)("section",{className:"StickerStylesMenu__group",children:[(0,o.jsxs)("h2",{className:"StickerStylesMenu__groupTitle",children:[e.title,e.tooltip&&(0,o.jsx)(r.HintIcon,{gap:"l",tooltip:{text:e.tooltip,placement:"bottom"}})]}),(0,o.jsx)("div",{className:"StickerStylesMenu__groupItems",children:e.styles.map((e=>(0,o.jsx)(l.default,{className:"StickerStylesMenu__item",style:e,isLoading:i,isAdded:_&&_(e),add:d&&(()=>d(e)),remove:u&&(()=>u(e)),gift:m&&(()=>m(e)),isActive:void 0===h?void 0:e===h,isSelected:void 0===p?void 0:e===p,select:f&&(()=>f(e))},e.id)))})]},t)))})]}):null}},652219:(e,t,i)=>{i.d(t,{default:()=>d});var o=i(785893),s=i(659397),n=i(29271),r=i(589897),c=i(331533),a=i(898718),l=i(401703),_=i(34672);const d=({className:e,style:t,isAdded:i=!1,add:d,remove:u,gift:m,isActive:h,isSelected:p,select:f})=>{let k;k=t.is_new?t.title.trim().replace(/(^|\s)([^\s]+)$/,'$1<span class="StickerStylesMenuItem__titleLastWord">$2</span>'):t.title;const g=(0,a.getSticker)(t.style_sticker_ids[0]),w=e=>t=>{t.stopPropagation(),e()};return(0,o.jsxs)("div",{className:(0,s.classNames)("StickerStylesMenuItem",e,{"StickerStylesMenuItem--selected":Boolean(p),"StickerStylesMenuItem--added":Boolean(i),"StickerStylesMenuItem--new":t.is_new}),onClick:()=>{f?f():i?u&&u():d&&d()},children:[g&&(0,o.jsx)(_.default,{className:"StickerStylesMenuItem__icon",sticker:g,width:100,height:100}),(0,o.jsx)(c.InnerHTML,{Component:"div",className:"StickerStylesMenuItem__title",children:k}),t.is_purchased?void 0===h?(0,o.jsx)("div",{className:"StickerStylesMenuItem__notice",children:n.getLang("purchases_stickers_you_have_it")}):h&&(0,o.jsx)("div",{className:"StickerStylesMenuItem__notice",children:n.getLang("purchases_stickers_active_style")}):t.price.purchase.regular?(0,o.jsx)("div",{className:"StickerStylesMenuItem__price",children:n.getLang("global_n_votes",t.price.purchase.current)}):(0,o.jsx)("div",{className:"StickerStylesMenuItem__price",children:n.getLang("purchases_for_free_btn")}),(d||u||m&&t.can_gift)&&(0,o.jsxs)("div",{className:"StickerStylesMenuItem__actions",children:[i?u&&(0,o.jsx)(r.default,{className:"StickerStylesMenuItem__remove",mode:"secondary",size:"s",onClick:w(u),children:n.getLang("purchases_stickers_preview_remove_item")}):d&&(0,o.jsx)(r.default,{className:"StickerStylesMenuItem__add",mode:"primary",size:"s",onClick:w(d),children:n.getLang("purchases_stickers_preview_add_item")}),m&&t.can_gift&&(0,o.jsx)(r.default,{className:"StickerStylesMenuItem__gift",size:"s",mode:"primary",onClick:w(m),children:(0,o.jsx)(l.Icon24Gift,{width:20,height:20,className:"StickerStylesMenuItem__giftIcon"})})]})]})}},142886:(e,t,i)=>{i.d(t,{default:()=>l});var o=i(785893),s=i(221780),n=i(29271),r=i(331533),c=i(899033),a=i(740906);const l=({item:e,showHeader:t=!1,remove:i})=>{if(!e.product)return null;let l="";return(0,c.isPackProduct)(e.product)?l=(0,s.langStr)(n.getLang("purchases_stickers_product_preview_title_pack"),"title",e.product.title):(0,c.isStyleProduct)(e.product)&&(l=(0,s.langStr)(n.getLang("purchases_stickers_product_preview_title_style"),"title",e.product.title)),(0,o.jsxs)("div",{className:"StickersCartItem",children:[t&&(0,o.jsxs)("div",{className:"StickersCartItem__header",children:[(0,o.jsx)(r.InnerHTML,{Component:"span",className:"StickersCartItem__title",children:l}),i&&(0,o.jsx)("span",{className:"StickersCartItem__actions",children:(0,o.jsx)("button",{className:"StickersCartItem__remove",onClick:()=>i(),children:n.getLang("purchases_stickers_preview_remove_item")})})]}),(0,o.jsx)(a.default,{className:"StickersCartItem__preview",product:e.product})]})}},740906:(e,t,i)=>{i.d(t,{default:()=>l});var o=i(785893),s=i(659397),n=i(68003),r=i(899033),c=i(898718),a=i(34672);const l=({className:e,product:t})=>{if(!(0,r.isPackProduct)(t)&&!(0,r.isStyleProduct)(t))return null;const i=(0,c.getStickers)((0,r.isStyleProduct)(t)?t.style_sticker_ids:t.sticker_ids),l=n.colorScheme.isDarkScheme()?r.Theme.DARK:r.Theme.LIGHT;return(0,o.jsx)("div",{className:(0,s.classNames)("StickersProductPreview",e),children:(0,o.jsx)("ul",{className:"StickersProductPreview__stickers",children:i.map((e=>e&&(0,o.jsx)(a.default,{className:"StickersProductPreview__sticker",sticker:e,width:128,height:128,theme:l},e.id)))})})}},86601:(e,t,i)=>{i.d(t,{usePack:()=>n});var o=i(899033),s=i(324502);const n=e=>{const[t,i]=(0,s.useProduct)(e);return t&&(0,o.isPackProduct)(t)?[t,i]:[void 0===t?void 0:null,i]}},324502:(e,t,i)=>{i.d(t,{useProduct:()=>n});var o=i(667294),s=i(581522);const n=e=>{const[,t]=(0,o.useState)({}),i=(0,s.getProductFromCache)(e);return void 0===i?((0,s.getProduct)(e,!1).then((()=>t({})),(()=>{})),[i,!0]):[i,!1]}},83877:(e,t,i)=>{i.d(t,{useProducts:()=>n});var o=i(667294),s=i(581522);const n=e=>{const[,t]=(0,o.useState)({}),i=(0,s.getProductsFromCache)(e);return i.some((e=>void 0===e))?((0,s.getProducts)(e,!1).then((()=>t({})),(()=>{})),[i,!0]):[i,!1]}},206198:(e,t,i)=>{i.d(t,{default:()=>l});var o=i(434788),s=i(667294);const n={getOffset:()=>({x:0,y:0}),scrollTo:()=>{},scrollBy:()=>{},onWheel:()=>{},updateItems:()=>{},hasPrev:!1,hasNext:!1,prev:()=>{},next:()=>{}};function r(e,t){switch(t.type){case"updateState":return(0,o._)({},e,t.state);case"updateNav":return t.hasPrev!==e.hasPrev||t.hasNext!==e.hasNext?(0,o._)({},e,{hasPrev:t.hasPrev,hasNext:t.hasNext}):e;default:throw new Error}}const c=e=>{const t=Array.from(e.entries());for(let e=0;e<t.length;e++){const[i,o]=t[e];if(o&&o.intersectionRatio)return o.intersectionRatio<1?i:t[e-1]?t[e-1][0]:null}return null},a=e=>{const t=Array.from(e.entries());for(let e=t.length-1;e>=0;e--){const[i,o]=t[e];if(o&&o.intersectionRatio)return o.intersectionRatio<1?i:t[e+1]?t[e+1][0]:null}return null};const l=function(e){const t=(0,s.useRef)(null),[i,l]=(0,s.useReducer)(r,n),_=(0,s.useCallback)((e=>{l({type:"updateState",state:e})}),[l]),d=(0,s.useCallback)((s=>{if(t.current&&i.onMouseWheel&&t.current.removeEventListener("mousewheel",i.onMouseWheel),s){const t=s.querySelector(e.wrapperSelector);if(t){let n={x:0,y:0};const r=new Map,d=()=>n;let u;const m=()=>{u&&u.disconnect(),u=new IntersectionObserver((e=>{for(const t of e)r.has(t.target)&&r.set(t.target,t);l({type:"updateNav",hasPrev:null!==c(r),hasNext:null!==a(r)})}),{root:s,threshold:[0,1]}),r.clear();for(const t of s.querySelectorAll(e.itemSelector))r.set(t,null),u.observe(t)},h=i=>{let o=0;t.offsetWidth>s.offsetWidth&&(o=Math.max(0,Math.min(t.offsetWidth-s.offsetWidth,i.x)));let r=0;t.offsetHeight>s.offsetHeight&&(r=Math.max(0,Math.min(t.offsetHeight-s.offsetHeight,i.y))),t.style.transform=`translate3d(-${o}px, -${r}px, 0)`,t.style.transitionDuration=i.noTransition?"0s":"",n={x:o,y:r},e.onScroll&&e.onScroll(o,r)},p=e=>{h((0,o._)({},e,{x:n.x+e.x,y:n.y+e.y}))},f=e=>{p({x:e.deltaX,y:e.deltaY,noTransition:!0})},k=()=>{const e=c(r);if(e){const i=getComputedStyle(t),o=parseInt(i.paddingLeft)||0,s=parseInt(i.paddingTop)||0,n=t.getBoundingClientRect(),r=e.getBoundingClientRect();h({x:r.left-n.left-o,y:r.top-n.top-s})}},g=()=>{const e=a(r);if(e){const i=getComputedStyle(t),o=parseInt(i.paddingBottom)||0,n=parseInt(i.paddingRight)||0,r=s.getBoundingClientRect(),c=t.getBoundingClientRect(),a=e.getBoundingClientRect();h({x:a.left-c.left-r.width+a.width+n,y:a.top-c.top-r.height+a.height+o})}},w=e=>{e.deltaX&&e.preventDefault()};s.addEventListener("mousewheel",w),_((0,o._)({},i,{onMouseWheel:w,updateItems:m,getOffset:d,scrollTo:h,scrollBy:p,onWheel:f,prev:k,next:g}))}}t.current=s}),[e.wrapperSelector,e.itemSelector,e.onScroll]);return(0,s.useLayoutEffect)((()=>{i.updateItems()})),(0,o._)({ref:d},i)}},467558:(e,t,i)=>{i.d(t,{useStyles:()=>n});var o=i(899033),s=i(83877);const n=e=>{const[t,i]=(0,s.useProducts)(e),n=[];for(const e of t)e&&(0,o.isStyleProduct)(e)&&n.push(e);return[n,i]}},617512:(e,t,i)=>{i.d(t,{useWithProducts:()=>r});var o=i(434788),s=i(667294),n=i(83877);function r(e){const[t,i]=(0,n.useProducts)(e.map((e=>e.product_id)));return[(0,s.useMemo)((()=>e.map(((e,i)=>(0,o._)({},e,{product:t[i]})))),[e]),i]}},623348:(e,t,i)=>{i.d(t,{previewSticker:()=>g,previewStickerProduct:()=>w});var o=i(434788),s=i(785893),n=i(973935),r=i(869048),c=i(514986),a=i(29271),l=i(899033),_=i(581522),d=i(898718),u=i(902220),m=i(584356),h=i(685463),p=i(714117),f=i(333330);const k=new Map;function g(e,t){const i=(0,m.showBoxLoader)();(0,d.getPackByStickerId)(e).then((e=>{!(0,m.isBoxLoadingCancelled)(i)&&e&&((0,m.hideBoxLoader)(),w(e.id,t))}),(()=>{}))}function w(e,t){let i;const d=(0,o._)({},t);function g(){var e;return null==(e=i)?void 0:e.bodyNode.querySelector(".StickersProductPreviewBox")}function w(){var e;null==(e=i)||e.hide(),window.nav.objLoc[0].match(/^stickers\/(.*?)$/)&&window.nav.setLoc({0:"stickers"})}function S(){var e;null==(e=i)||e.updateBoxCoords()}function E(e,t){let i=null,o=null;var c;if((0,l.isPackProduct)(e))i=e.is_purchased&&(null==(c=d)?void 0:c.settings)?(0,s.jsx)(p.default,{pack:e,options:d,closeBox:w,updateBox:S}):(0,s.jsx)(h.default,{pack:e,cart:t,options:d,closeBox:w,updateBox:S}),o=e.name;else if((0,l.isStyleProduct)(e)){const n=(0,_.getProductFromCache)(e.base_id);if(n)return t.addProduct(n.id,!0),void E(n,t);i=(0,s.jsx)(f.default,{style:e,options:d,closeBox:w,updateBox:S}),o=e.name}const a=g();if(a&&i&&(n.render((0,s.jsx)(r.AppRootProvider,{children:i}),a),o)){const e=window.nav.objLoc[0].split("/");"stickers"===e[0]&&e[1]!==o&&window.nav.setLoc({0:"stickers/"+o})}}const v=(0,m.showBoxLoader)(!1),b=u.Cart.create([e]);return Promise.all([b.load(),window.stManager.add(["stickers.css"])]).then((([t])=>{if((0,m.isBoxLoadingCancelled)(v))return;(0,m.hideBoxLoader)();const o=(0,_.getProductFromCache)(e);o&&!o.is_disabled?(i=new c.MessageBox({hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:640,onShow(){E(o,t),requestAnimationFrame((()=>{S(),function(){if(k.has(e)){const t=(0,m.getBoxLayerWrap)();t&&(t.scrollTop=k.get(e)||0),k.delete(e)}}()}))},onBeforeHide(){!function(){const t=(0,m.getBoxLayerWrap)();t&&k.set(e,t.scrollTop)}()},onHideAttempt:()=>(function(){const e=g();e&&n.unmountComponentAtNode(e)}(),!0)}),i.content('<div class="StickersProductPreviewBox"></div>'),i.show()):(0,c.showFastBox)(a.getLang("global_box_error_title"),a.getLang("purchases_stickers_product_not_found"))}),(()=>{})),{hide:w}}},946331:(e,t,i)=>{i.d(t,{VmojiLangSection:()=>h,storeActivateProduct:()=>u,storeDeactivateProduct:()=>m,vmojiGetAvatar:()=>r,vmojiGetCharacterById:()=>_,vmojiGetLangs:()=>p,vmojiGetStickerPacks:()=>l,vmojiGetStickerPacksRecommendationBlock:()=>a,vmojiGetStickerPacksRecommendationBlocks:()=>c,vmojiPurchaseProduct:()=>n,vmojiSetAvatarState:()=>d,vmojiSubscribeToQueue:()=>s});var o=i(599809);const s=()=>(0,o.api)("vmoji.subscribeToQueue",{}),n=(e,t=!1)=>(0,o.api)("vmoji.purchaseProduct",{product_id:e,confirm:t?1:0}),r=e=>{const t={};return e&&Object.assign(t,{avatar_id:e}),(0,o.api)("vmoji.getAvatar",t)},c=e=>(0,o.api)("vmoji.getStickerPacksRecommendationBlocks",e),a=(e,t)=>{const i={block_id:e};return t&&Object.assign(i,{count:t}),(0,o.api)("vmoji.getStickerPacksRecommendationBlock",i)},l=e=>(0,o.api)("vmoji.getStickerPacks",e),_=(e,t)=>(0,o.api)("vmoji.getCharacterById",{character_id:e,with_stickers:t?1:0}),d=(e,t)=>(0,o.api)("vmoji.setAvatarState",{avatar_id:e,is_active:t?1:0}),u=e=>(0,o.api)("store.activateProduct",{type:"stickers",product_id:e}),m=e=>(0,o.api)("store.deactivateProduct",{type:"stickers",product_id:e});var h;!function(e){e.LAYER="layer",e.PURCHASE="purchase"}(h||(h={}));const p=e=>new Promise(((t,i)=>{window.ajax.post("al_vmoji.php",{act:"lang_keys",section:e},{onDone:()=>{t()},onFail:()=>(i(),!1)})}))},168892:(e,t,i)=>{function o(){return{icon:'<svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M6 12A6 6 0 1 0 6 0a6 6 0 0 0 0 12z" fill="#99a2ad"/><path clip-rule="evenodd" d="M8.78 3.97c.3.3.3.77 0 1.06L5.53 8.28c-.3.3-.77.3-1.06 0L3.22 7.03a.75.75 0 0 1 1.06-1.06l.72.72 2.72-2.72c.3-.3.77-.3 1.06 0z" fill="#fff" fill-rule="evenodd"/></svg>',name:"check_circle_fill_12"}}i.d(t,{getIcon12CheckCircleFill:()=>o})},538701:(e,t,i)=>{function o(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="m7.22 3.38.01-.03a4.15 4.15 0 0 1 .17-.48c.36-.82.95-1.29 1.86-1.36l.16-.01h1.21c1.05.03 1.74.6 2.1 1.7l.05.18.05.16c.01.07.03.14.06.2l.05.14.03.02.06-.02.11-.04.14-.06a5.36 5.36 0 0 1 .17-.08l.03-.01a4.23 4.23 0 0 1 .43-.15c.93-.27 1.68-.08 2.32.61l.1.13.72.88c.63.83.61 1.72 0 2.68l-.12.16-.1.14-.12.18-.06.1-.03.05v.02l.08.05.11.06.13.08c1.21.61 1.71 1.42 1.52 2.54l-.03.16-.22.92c-.13.59-.24.87-.67 1.25a2.13 2.13 0 0 1-1.05.52h-.01a3.92 3.92 0 0 1-.44.06l-.2.02H15.63l-.16.01-.16.02.01.13.01.08.03.15c.07.32.1.62.1.9a2.04 2.04 0 0 1-1.13 1.87l-.15.08-1.02.5c-.9.4-1.72.23-2.48-.47a3.93 3.93 0 0 1-.15-.14l-.13-.14-.11-.13a2.94 2.94 0 0 0-.15-.17l-.09-.08-.04-.04-.08.08-.09.1-.1.1c-.83.99-1.7 1.34-2.77.93l-.15-.06-.91-.45-.28-.13a1.78 1.78 0 0 1-.87-.92 2.15 2.15 0 0 1-.2-1.01v-.02c0-.19.02-.39.06-.6l.04-.2.04-.2.01-.15-.1-.02-.12-.01h-.15a4.14 4.14 0 0 1-.86-.1h-.01a2.05 2.05 0 0 1-1.61-1.53l-.05-.16-.25-1.1c-.2-1.03.2-1.82 1.19-2.41l.17-.1.15-.08.19-.1.13-.1v-.01l-.05-.1-.07-.1-.09-.13a5.2 5.2 0 0 1-.29-.42c-.54-.9-.53-1.72.05-2.52l.1-.14.72-.87c.68-.8 1.56-.96 2.64-.56l.18.08.16.07a2.9 2.9 0 0 0 .19.08l.12.04.03-.02.03-.07.04-.12.04-.15.04-.16Zm4.24.84.01.04.05.14a1.5 1.5 0 0 0 .75.83l.03.01a1.5 1.5 0 0 0 1.13.08l.06-.02a1.47 1.47 0 0 0 .07-.02l.12-.04.06-.03.13-.06.04-.01a2.7 2.7 0 0 1 .41-.16c.27-.08.41-.06.47-.04.06.01.16.05.32.22l.07.09.69.84c.13.18.15.29.15.35 0 .09-.03.27-.23.58l-.08.12-.08.1a4.4 4.4 0 0 0-.18.27l-.02.02-.06.1v.01l-.01.02-.03.05a1.5 1.5 0 0 0-.18 1.06v.01a1.5 1.5 0 0 0 .65.96l.08.05.05.04.1.06.07.03.13.08.04.01c.45.24.62.43.67.52.04.06.09.16.04.42l-.02.12-.2.89c-.07.28-.1.35-.11.37h-.01a.97.97 0 0 1-.1.11.65.65 0 0 1-.36.16 2.36 2.36 0 0 1-.25.04h-.16l-.13.01h-.08a4.55 4.55 0 0 0-.28.02l-.15.02a1.5 1.5 0 0 0-1.32 1.63l.01.12v.07l.02.09.01.06.03.15v.05c.06.23.07.42.07.55 0 .2-.04.3-.07.35a.72.72 0 0 1-.28.24l-.1.05-.98.47c-.2.1-.32.09-.38.07-.08-.01-.23-.06-.46-.28a2.38 2.38 0 0 1-.08-.07l-.1-.1-.09-.11a4.39 4.39 0 0 0-.21-.24l-.02-.01-.08-.09a1.43 1.43 0 0 0-.04-.03l-.04-.04a1.5 1.5 0 0 0-2.05.01l-.08.08a1.43 1.43 0 0 0-.04.04l-.1.1a1.53 1.53 0 0 0-.04.04l-.1.12-.03.03c-.31.37-.53.5-.64.53-.08.03-.19.05-.42-.03l-.1-.04-.86-.42-.24-.12a1.19 1.19 0 0 1-.13-.08v-.01a1.08 1.08 0 0 1-.09-.15.67.67 0 0 1-.06-.34l.04-.36.04-.18a4.38 4.38 0 0 0 .06-.35l.01-.15a1.5 1.5 0 0 0-.43-1.22 1.5 1.5 0 0 0-.86-.43h-.1a1.4 1.4 0 0 0-.06-.02h-.13a1.54 1.54 0 0 0-.06-.01h-.19a2.66 2.66 0 0 1-.55-.07c-.22-.05-.3-.11-.35-.15a.7.7 0 0 1-.17-.32L3.26 12l-.24-1.05c-.04-.22 0-.33.02-.38.04-.08.15-.23.46-.42l.13-.08.12-.06a4.43 4.43 0 0 0 .31-.18l.14-.09a1.5 1.5 0 0 0 .65-.94v-.02a1.5 1.5 0 0 0-.17-1.07l-.05-.09a1.49 1.49 0 0 0-.04-.06l-.07-.11a1.5 1.5 0 0 0-.04-.06l-.09-.12a1.52 1.52 0 0 0-.02-.03c-.31-.4-.37-.65-.38-.76 0-.06 0-.18.15-.4L4.2 6l.68-.83c.16-.18.27-.21.33-.23.1-.02.28-.03.63.1l.13.06.13.05a4.42 4.42 0 0 0 .31.13l.12.04a1.5 1.5 0 0 0 1.14-.05l.03-.02a1.5 1.5 0 0 0 .76-.82l.03-.08.02-.07.04-.12.02-.06.04-.14.01-.04.03-.12.12-.32c.1-.23.19-.32.24-.36.04-.03.13-.09.34-.1l.1-.01h1.14c.24.01.34.07.39.11.07.06.2.2.3.54l.05.14.03.13.1.3ZM10 11.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Zm0 1.5a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" clip-rule="evenodd"/></svg>',name:"gear_outline_20"}}i.d(t,{getIcon20GearOutline:()=>o})},378711:(e,t,i)=>{function o(){return{icon:'<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g id="gift_outline_20__Icons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="gift_outline_20__Icons-20/gift_outline_20"><g id="gift_outline_20__gift_outline_20"><path d="M0 0h20v20H0z"/><path d="M14.85 2.31c1.02 1.03 1.23 2.88-.26 4.19h.91a3 3 0 0 1 3 3v.5c0 .82-.1 1.15-.27 1.48a1.88 1.88 0 0 1-1.23.94v1.61c0 1.56-.16 2.13-.47 2.7-.3.57-.75 1.02-1.32 1.32l-.2.1c-.48.23-1.04.35-2.23.37h-5.3c-1.55 0-2.12-.16-2.69-.47a3.18 3.18 0 0 1-1.32-1.32l-.1-.2A5.12 5.12 0 0 1 3 14.3V12.4a1.88 1.88 0 0 1-1.23-.93c-.16-.3-.25-.6-.27-1.3V9.5a3 3 0 0 1 3-3h.91c-1.49-1.31-1.28-3.16-.26-4.19C6.37 1.1 8.74 1.04 10 3.57c1.26-2.53 3.63-2.47 4.85-1.26ZM9.25 12.5H4.5v1.76l.01.4c.02.6.08.92.2 1.2l.08.16c.17.31.4.54.7.71l.17.08c.33.14.72.2 1.6.2h1.99V12.5Zm6.25 0h-4.75v4.52h2l.4-.01c.6-.02.91-.08 1.19-.2l.16-.08c.31-.17.54-.4.71-.7.19-.36.27-.7.29-1.56V12.5ZM9.16 8H4.5C3.67 8 3 8.67 3 9.5v.87c.02.23.04.31.09.4.03.06.08.1.14.14.11.06.22.08.63.09h5.39V8h-.09Zm6.34 0h-4.76v3h5.4c.4 0 .52-.03.63-.09.06-.03.1-.08.14-.14.06-.12.09-.25.09-.78V9.5c0-.83-.67-1.5-1.5-1.5ZM9.22 6.16c-.43-3.1-1.96-3.83-3-2.79C5.16 4.42 5.9 5.95 9 6.38l.26.04Zm1.56 0-.03.19.01.06.24-.03c3.1-.43 3.83-1.96 2.79-3-1.05-1.05-2.58-.32-3.01 2.78Z" id="gift_outline_20__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></g></svg>',name:"gift_outline_20"}}i.d(t,{getIcon20GiftOutline:()=>o})},61667:(e,t,i)=>{function o(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M10 2.9a.9.9 0 0 1-.9.9 5.3 5.3 0 0 0-5.3 5.3.9.9 0 0 1-1.8 0A7.1 7.1 0 0 1 9.1 2a.9.9 0 0 1 .9.9ZM8.5 9.55a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Zm5.96.75a2.39 2.39 0 0 1 2.76.31.77.77 0 0 1 .06 1.13.88.88 0 0 1-1.19.06l-.08-.07c-.26-.18-.48-.16-.75-.03a.98.98 0 0 0-.15.1l-.08.06a.88.88 0 0 1-1.11-.12.77.77 0 0 1 .06-1.13c.1-.09.26-.2.48-.3Zm-.1 4.7c.1-.55-.36-1-.91-1h-2.9c-.55 0-1 .45-.9 1 .02.13.05.25.09.34a2.44 2.44 0 0 0 1.32 1.32c.3.13.62.2.94.2a2.46 2.46 0 0 0 2.26-1.52 1.84 1.84 0 0 0 .1-.35ZM2 14.9a.9.9 0 0 1 1.8 0 5.3 5.3 0 0 0 5.3 5.3.9.9 0 1 1 0 1.8A7.1 7.1 0 0 1 2 14.9Zm12-12a.9.9 0 0 0 .9.9 5.3 5.3 0 0 1 5.3 5.3.9.9 0 0 0 .9.9.91.91 0 0 0 .9-.9A7.1 7.1 0 0 0 14.9 2a.9.9 0 0 0-.9.9ZM21.1 14a.9.9 0 0 0-.9.9 5.3 5.3 0 0 1-5.3 5.3.9.9 0 1 0 0 1.8 7.1 7.1 0 0 0 7.1-7.1.9.9 0 0 0-.9-.9Z"/></svg>',name:"vmoji_outline_24"}}i.d(t,{getIcon24VmojiOutline:()=>o})},774578:(e,t,i)=>{i.d(t,{default:()=>f});var o=i(839470),s=i(472207),n=i(679177),r=i(664988),c=i(301230);const a=Object.entries(n.EMOJI_HINTS).map((([e,[t,i]])=>[new RegExp(`(\\s|^)(${(0,r.escapeRE)(i)}${i.endsWith(")")||i.endsWith("(")?"+":""})([\\s\\.,]|$)`,"gi"),e])),l={q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з","[":"х","]":"ъ",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",";":"ж","'":"э",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",",":"б",".":"ю","/":"."};c.browser.mac?l["\\"]="ё":l["`"]="ё";const _=new RegExp(`[${(0,r.escapeRE)(Object.keys(l).join(""))}]`,"gi"),d=e=>e.replace(_,(e=>l[e])),u=Object.entries(l).reduce(((e,[t,i])=>(e[i]=t,e))),m=new RegExp(`[${(0,r.escapeRE)(Object.keys(u).join(""))}]`,"gi"),h=e=>e.replace(m,(e=>u[e])),p=-184940019;const f=class{setConfig(e){Object.assign(this.config,e)}getQueries(e){if(!e||e.length>this.config.maxInputLength)return[""];const t=window.Wall&&window.Wall.replyNamesRE||window.post&&window.post.replyNamesRE;if(t){const i=t();i&&(e=e.replace(i,""))}e=e.toLowerCase(),e=(e=a.reduce(((e,[t,i])=>e.replace(t,((e,t,o,n)=>(t||"")+(0,s.emojiByteHexToSymbol)(i)+(n||"")))),e)).replace(/^[\s\uFEFF\xA0]+|\n+$/g,"");const i=[e=(0,s.emojiRemoveSkinToneModifiers)(e)];for(const e of[...i])i.push(d(e)),i.push(h(e));for(const e of[...i])i.push(e.replace(/ё/g,"е")),i.push(e.replace(/е/g,"ё"));for(const e of[...i])i.push(e.replace(/[.!?]+$/,""));return Object.keys(i.reduce(((e,t)=>(e[t]=1,e)),{}))}isBotLinkEnabled(){return(0,o.partConfigEnabled)("stickers_bot_link")&&this.config.peerId!==p}getBotLinkUrl(){return this.config.mvk?`/mail?act=show&peer=${p}`:`/im?sel=${p}`}getBotLinkImageUrl(e,t="light"){return`/images/stickers_suggestions_bot_${t}_${e}.png`}getBotLinkClickStatName(){return"stickers_suggestions_bot_link"}getBotLinkClickStatKeys(){return[]}isMoneyTransferEnabled(){return(0,o.partConfigEnabled)("stickers_money_transfer_suggestions")&&(this.isMoneySendEnabled()||this.isMoneyRequestEnabled())}isMoneySendEnabled(){return Boolean(this.config.moneyTransfer&&this.config.moneyTransfer.send)}isMoneyRequestEnabled(){return Boolean(this.config.moneyTransfer&&this.config.moneyTransfer.request)}constructor(e){this.config={mvk:!1,peerId:null,maxInputLength:256},this.setConfig(e)}}},790287:(e,t,i)=>{i.d(t,{Emoji:()=>ue});var o=i(434788),s=i(659397),n=i(679177),r=i(301230),c=i(643897),a=i(504867),l=i(970978),_=i(96756),d=i(584356),u=i(893106),m=i(438221),h=i(953908),p=i(472207),f=i(666920),k=i(286283),g=i(933943),w=i(839470),S=i(82161),E=i(795558),v=i(783098),b=i(774578),T=i(943938),j=i(501087),C=i(725296),y=i(514986),P=i(320422),I=i(29271),O=i(664988),R=i(755320),M=i(931917),L=i(854099),B=i(899033),A=i(457299),x=i(581522),D=i(623348),N=i(753884),H=i(902220),K=i(898718),W=i(991243),V=i(91525),U=i(475117),F=i(538701),$=i(378711),z=i(168892),q=i(61667),Y=i(68003),G=i(814323),J=i(946331),X=i(824478),Z=i(84543),Q=i(72230),ee=i(391650),te=i(582389),ie=i(385036),oe=i(374884),se=i(630686),ne=i(396316),re=i(386776),ce=i(225892),ae=i(766698),le=i(849222),_e=i(494774);function de(){return(0,w.partConfigEnabled)("stickers_web_new_ui")}const ue={opts:{},raw:{},last:0,shownId:!1,hasNewStickers:!1,preventMouseOver:!1,stickerPacksToLoad:[],ttShift:45,favoriteAvailable:!1,favoriteRemindOn:!1,favoriteRemindOff:!1,favoriteLimit:20,favoriteLimitNoticed:!1,isStickersPreloading:!1,stickerSizes:{},stickers:{},TAB_EMOJI:0,TAB_RECENT_STICKERS:-1,TAB_FAVORITE_STICKERS:-2,TAB_NEW_CONVO_STICKERS:-3,TAB_VMOJI:-4,CLICK_DELAY:500,SORTED_EMOJI_SECTIONS_CODES:[-1,1,3,8,2,4,5,6,7,9],CACHED_HEIGHT_PROP:"_emojiHeight",CACHED_WIDTH_PROP:"_emojiWidth",BOTTOM_REST_FOR_ADD_EMOJI_CATEGORY:150,SHOW_TT_TIMEOUT:100,HIDE_TT_TIMEOUT:300,SHOWN_TT_CLS:"emoji_tt_shown",STICKER_REFERRERS:{RECENT:"recent",FAVORITE:"favourite",NEW_CONVO:"new_convo",KEYBOARD:"keyboard",STORY_KEYBOARD:"story_keyboard"},SHOW_STICKER_PACK_VIEWS_DELAY:32,STICKER_PACK_VIEW_MARGIN_TOP:3,STICKERS_IN_RAW:4,STICKER_SIDE_SIZE:70,STICKER_PACK_HEADER_HEIGHT:30,FAV_ICON_TT_MIN_HEIGHT:35,SUGGESTION_WORD_MAX_LENGTH:256,logHintsDelay:0,tabDefaultId:0,stickersKeywordsExpire:36e5*(6+2*Math.random()),PACK_FIELD_ID:0,PACK_FIELD_IS_ACTIVE:1,PACK_FIELD_COUNT:6,STICKER_FIELD_IMAGES:6,STICKER_FIELD_IS_FAVORITE:4,STICKER_PACKS_CONTAINER_CLASS:"sticker_pack_views_container",shown:!1,init:function(e,t){let i=ue.last;ue.tabDefaultId=ue.TAB_RECENT_STICKERS,t.txt=e,t.id=i,t.fieldWrap=(0,E.gpeByClass)("_emoji_field_wrap",e),t.emojiWrap=(0,E.domByClass)(t.fieldWrap,"_emoji_wrap"),t.emojiBtn=(0,E.domByClass)(t.emojiWrap,"_emoji_btn"),t.emojiWrap&&(0,E.data)(t.emojiWrap,"optId",i),e.emojiId=i,t.lastLoadedEmojiCategoriesIdxes={},t.preventDoubleClick=(0,O.vkNow)(),t.suggestions=new b.default(t.suggestionsConfig),t.packViews=new Map,t.activePackViews=new Map,t.packViewsTotalHeight=0,t.renderedPackViews=new Map,t.packsToShow=new Set,t.packsToHide=new Set;const o=(0,S.isRetina)()?128:64;if(ue.stickerSizes[o]=!0,(0,ne.isNewStickerPicker)()&&(0,re.initNewStickerPicker)(),t.forceTxt)t.editable=0,(0,_.placeholderInit)(e);else{if(t.editable=1,setTimeout((function(){(0,_.placeholderInit)(e,{editable:1,editableFocus:ue.editableFocus,global:t.global}),t.shouldFocus&&ue.editableFocus(e,!1,!0)}),0),r.browser.mozilla)try{document.execCommand("enableObjectResizing",!1,!1),cur.destroy.push((function(){document.execCommand("enableObjectResizing",!1,!0)}))}catch(e){}(0,h.addEvent)(window,"mousemove",ue.preventMouseOverHandle),(0,h.addEvent)(e,r.browser.opera&&!r.browser.chrome?"click":"mousedown",(function(o){if(o.target&&"IMG"==o.target.tagName&&ue.getCode(o.target))return ue.editableFocus(e,o.target,o.offsetX>8),(0,h.cancelEvent)(o);ue.shown&&!(0,ne.isNewStickerPicker)()&&ue.ttClick(i,(0,E.geByClass1)("emoji_smile",t.controlsCont),!0)})),t.noLineBreaks&&(0,h.addEvent)(e,"blur",(function(t){e.textContent||e.innerText||(0,S.each)((0,E.geByTag)("br",e),(function(e,t){(0,E.re)(t)}))})),(0,h.addEvent)(e,"keypress keydown keyup input paste",(function(o){if(o.canceled)return!1;if("keydown"===o.type){var s;t.onChange&&(ue.raw[i]=e.innerHTML);let a=t.ctrlSend?t.ctrlSend():t.noEnterSend;const l=o.ctrlKey||r.browser.mac&&o.metaKey;if((0,ne.isNewStickerPicker)()&&(null==(s=window.StickerPickerViewer)?void 0:s.isShown)){const e=o.keyCode===h.KEY.ENTER&&!a,i=o.shiftKey,s=e&&!i&&!l;if(e&&l)return t.onSend&&t.onSend(),(0,h.cancelEvent)(o);if(s)return}if(o.keyCode==h.KEY.RETURN||10==o.keyCode){if(t.forceEnterSend&&t.onSend)return t.onSend(),(0,h.cancelEvent)(o);let s=cur.ctrl_submit&&!t.noCtrlSend;if((s||a)&&l||!s&&!o.shiftKey&&!l){if(!ue.emojiEnter(i,o)||!ue.stickerHintMove(o)||(0,ce.isHintsOfMentionsOpen)(e))return!1;if(!a||l)return(0,ne.isNewStickerPicker)()||ue.ttClick(i,(0,E.geByClass1)("emoji_smile",t.controlsCont),!0),t.onSend&&t.onSend(),(0,h.cancelEvent)(o)}if(t.noLineBreaks)return(0,h.cancelEvent)(o)}if(o.ctrlKey&&o.keyCode==h.KEY.RETURN){let i=this.value;if(t.editable)ue.insertHTML("<div><br/></div>");else{if("number"==typeof this.selectionStart&&"number"==typeof this.selectionEnd){let e=this.selectionStart;this.value=i.slice(0,e)+"\n"+i.slice(this.selectionEnd),this.selectionStart=this.selectionEnd=e+1}else if(document.selection&&document.selection.createRange){this.focus();let e=document.selection.createRange();e.text="\r\n",e.collapse(!1),r.browser.opera&&!r.browser.chrome&&(e.moveEnd("character",0),e.moveStart("character",0)),e.select()}e.autosize.update(),setTimeout((function(){e.autosize.update()}),0)}return!1}const _=(0,j.hasAccessibilityMode)()&&(0,w.partConfigEnabled)("emoji_tooltip_a11y_mode");if(o.keyCode===h.KEY.TAB&&!l&&!_){var n,c;let s=(0,E.geByClass1)("_sticker_hints",(0,E.domPN)(t.txt));if(s&&(0,E.isVisible)(s)){let e=(0,E.geByClass1)("over",s);if(e?ue.stickerHintKeyOut(i,e):ue.stickerHintKeyOver(i,(0,E.geByClass1)("emoji_sticker_item",s)),!ue.shown)return(0,h.cancelEvent)(o)}if((0,ce.isHintsOfMentionsOpen)(e))return(0,h.cancelEvent)(o);const r=null==(c=t.txt)||null==(n=c.parentNode)?void 0:n.querySelector(".emoji_smile");return(0,ne.isNewStickerPicker)()?ue.shown?(ue.editableFocus(e,!1,!0,!1,!0),ue.hide()):ue.show(r):ue.shown?(ue.editableFocus(e,!1,!0,!1,!0),ue.ttClick(i,r,!0)):ue.ttClick(i,r,!1,!0,void 0,!0),(0,h.cancelEvent)(o)}if(o.keyCode==h.KEY.ESC){let s=(0,E.geByClass1)("_sticker_hints",(0,E.domPN)(t.txt)),n=!1;if(s&&(0,E.isVisible)(s)&&(ue.stickerHintKeyOut(i,(0,E.geByClass1)("emoji_sticker_item",s)),ue.stickersHintsHide(s,t,100),n=!0),ue.shown&&(ue.editableFocus(e,!1,!0,!1,!0),ne.isNewStickerPicker?ue.hide():ue.ttClick(i,(0,E.geByClass1)("emoji_smile",t.controlsCont),!0),n=!0),n)return(0,h.cancelEvent)(o);if(t.onEsc)return t.onEsc(o)}}return"paste"===o.type?(ue.onEditablePaste(e,t,i,o),t.checkEditable&&setTimeout((()=>t.checkEditable(i,e)),0),ue.checkStickersKeywords(i,t)):"keyup"===o.type?(!t.noLineBreaks||e.textContent||e.innerText||(0,S.each)((0,E.geByTag)("br",e),(function(e,t){(0,E.re)(t)})),t.checkEditable&&t.checkEditable(i,e),ue.checkStickersKeywords(i,t),t.onChange&&(ue.raw[i]!=e.innerHTML&&ue.onChange(t),delete ue.raw[i])):"keydown"!==o.type&&"input"!==o.type||(t.checkEditable&&setTimeout((()=>t.checkEditable(i,e)),0),ue.checkStickersKeywords(i,t)),t.onKeyAction&&t.onKeyAction(o),cur.onReplyFormSizeUpdate&&cur.onReplyFormSizeUpdate(o),!0}))}return window.Notifier&&Notifier.addRecvClbk("emoji",0,ue.lcRecv,!0),(0,ee.initStickersKeywords)(),ue.initPromotedStickerUrls(),ue.checkNewStickers(t),ue.opts[ue.last]=t,ue.last++},setSuggestionsConfig:function(e,t){ue.opts[e].suggestions.setConfig(t)},onChange:function(e){(0,O.isFunction)(e.onChange)&&setTimeout(e.onChange,0)},preventMouseOverHandle:function(){ue.preventMouseOver=!1},lcRecv:function(e){if("updateTabs"===e.act)ue.updateTabs(e.newStickers,e.keywords)},correctCaret:function(e){let t=e?(0,T.getCaretBoundingRect)(e).bottom:0;(t<0||t>e.offsetHeight)&&(e.scrollTop+=t-e.offsetHeight)},insertWithBr:function(e,t){if(t){let e=t.replace(/\n/g,"<br/>"),i=(0,E.ce)("div",{innerHTML:e});ue.cleanCont(i),ue.insertHTML(i.innerHTML)}},insertWithoutNL:function(e,t){if(t){let e=t.replace(/\n/g,""),i=(0,E.ce)("div",{innerHTML:e});ue.cleanCont(i),ue.insertHTML(i.innerHTML)}},focusTrick:function(e,t,i,o,s){s||(s=e);let n=(0,E.ce)("TEXTAREA",{className:"emoji_tmp_textarea"});e.parentNode.appendChild(n),n.focus(),setTimeout((function(){let r=s.scrollTop;(0,E.re)(n),e.focus(),s.scrollTop=r,ue.setRange(o),t((0,S.clean)((0,E.val)(n))),i(e)}),0)},finalizeInsert:function(e){ue.cleanCont(e),setTimeout((()=>ue.correctCaret(e)),10)},getClipboard:function(e){return e.clipboardData?(0,S.clean)(e.clipboardData.getData("text")):!!window.clipboardData&&(0,S.clean)(window.clipboardData.getData("Text"))},processImagePaste:function(e,t,i,o){if((0,w.partConfigEnabled)("marusya_web_support_proccess_commands")&&(0,R.isMarusiaPeer)(ue.selectPeer()))o();else if(null!=e.clipboardData){let s=e.clipboardData;function n(e){let o,s;if(e.name=e.filename="upload_"+(new Date).toISOString()+"_"+(0,O.irand)(0,100)+".png",(0,E.hasClass)(t,"_im_text")){if(i.uploadActions)return void i.uploadActions.paste([e])}else"post_field"==t.id?o=cur.wallAddMedia:(s=(0,E.data)(t,"composer"),o=s&&s.addMedia);o&&(0,O.isFunction)(i.initUploadForImagePasteCallback)&&i.initUploadForImagePasteCallback(t,o,e)}function r(e){let i=Math.floor(1e3*Math.random()),s=(0,E.geByTag)("img",t);for(let e=0,t=s.length;e<t;e++){s[e]["_before_paste_"+i]=!0}return setTimeout((function(){let s=(0,E.geByTag)("img",t),n=!1;for(let t=0,o=s.length;t<o;t++){let o=s[t];o["_before_paste_"+i]||(e(o.src),(0,E.re)(o),n=!0)}n||o()}),1)}function c(e){if(e.match(/^webkit\-fake\-url\:\/\//))return;let t=new Image;return t.crossOrigin="anonymous",t.onload=function(){let e=document.createElement("canvas");e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0,e.width,e.height),e.toBlob((function(e){n(e)}),"image/png"),o(!0)},t.src=e}if(s.items){let a=!1;const{types:l}=s;if((0,w.partConfigEnabled)("emoji_disable_new_html_processing")||l.includes("Files")||l.includes("text/plain"))for(let _=0,d=s.items.length;_<d;_++){let u=s.items[_];if(u.type.match(/^image\//)&&"file"===u.kind){let m=new FileReader;m.onload=function(e){return c(e.target.result)},m.readAsDataURL(u.getAsFile()),a=!0}else if("text/plain"===u.type)return o()}else if(s.types.includes("text/html")){const h=(0,E.se)(`<div>${s.getData("text/html")}</div>`).querySelectorAll("img");a=h.length>0,h.forEach((e=>{c(e.src)}))}return a}if(-1!==Array.prototype.indexOf.call(s.types,"text/plain"))return o();r((function(e){return c(e)}))}else o()},detectInvalidClipboardData(e){if(!e.clipboardData)return!1;const t=e.clipboardData.types;if(t.includes("text/html")){if(t.includes("Files"))return!0;const i=e.clipboardData.getData("text/html");return i&&i.match(/<iframe/i)}return!1},onEditablePaste:function(e,t,i,o,s){let n=!1;"true"===e.getAttribute("contenteditable")&&(n=ue.getRange());let r=this.getClipboard(o),c=r&&n&&!s;this.detectInvalidClipboardData(o)&&(0,h.cancelEvent)(o),(this.processImagePaste(o,e,t,function(i){i||(c?(t.noLineBreaks?this.insertWithoutNL(n,r):this.insertWithBr(n,r),setTimeout(this.finalizeInsert.bind(this,e),0)):n&&this.focusTrick(e,t.noLineBreaks?()=>this.insertWithoutNL(n):()=>this.insertWithBr(n),this.finalizeInsert.bind(this,e),n))}.bind(this))||c)&&(0,h.cancelEvent)(o),ue.onChange(t)},cleanCont:function(e){let t=e.firstChild;for(;t;){let e=t.nextSibling;switch(t.nodeType){case 1:if("tmp_paste_cont"==t.id)break;if("DIV"==t.tagName||"P"==t.tagName||"SPAN"==t.tagName)t.setAttribute("style",""),t.className="",t.id="",ue.cleanCont(t);else if("IMG"==t.tagName)ue.getCode(t)||(0,E.re)(t);else if("BR"!=t.tagName){let e=ue.editableVal(t,{saveEmoji:!0}),i=(0,E.cf)((0,S.clean)(e).replace(/\n/g,"<br/>"));t.parentNode.replaceChild(i,t)}break;case 3:let e=(0,S.clean)(t.textContent||t.innerText),i=(0,n.emojiRegex)();e&&e.match(i)&&(e=e.replace(i,f.emojiReplace),t.parentNode.replaceChild((0,E.cf)(e),t))}t=e}},focus:function(e,t,i=!1){ue.editableFocus(e,!1,!0);let o=i||e.parentNode;if(t){let e=(0,E.getXY)(o)[1],t=(0,m.scrollGetY)(),i=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:boxLayerBG.offsetHeight,s=(0,E.getSize)(o)[1];t+i<e+s?(0,m.scrollToY)(e-i+s+60,100):t>e&&(0,m.scrollToY)(e-60,100)}},destroy:function(e){const t=ue.opts[e];t&&(t.txt&&t.txt.blur(),e===ue.shownId&&(ue.shownId=!1,ue.shown=!1),delete ue.opts[e])},editableFocus:function(e,t,i,o,s){if(!e||s&&document.activeElement===e)return!1;if((e=(0,E.ge)(e)).focus(),e.phonfocus&&e.phonfocus(),void 0!==window.getSelection&&void 0!==document.createRange){let s=window.getSelection();if(!r.browser.opera||r.browser.chrome||i){let n=document.createRange();t?n.selectNode(t):n.selectNodeContents(e),r.browser.mozilla&&e.innerHTML.endsWith("<br>")&&e.removeChild(e.lastChild),o||n.collapse(!i),s=window.getSelection(),s.removeAllRanges(),s.addRange(n)}else s.collapse(t||e,0)}else if(void 0!==document.body.createTextRange){let o=document.body.createTextRange();o.moveToElementText(t||e),o.collapse(!i),o.select()}},getRange:function(){if(window.getSelection){let e=window.getSelection();if(e.getRangeAt&&e.rangeCount)return e.getRangeAt(0)}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null},setRange:function(e){if(window.getSelection){let t=window.getSelection();t.removeAllRanges(),t.addRange(e)}else document.selection&&e.select&&e.select()},val:function(e,t){if(void 0===t)return ue.editableVal(e);{t=(t=(0,f.emojiToHTML)(t,!0)).replace(/ $/,"&nbsp;"),e.setValue?(e.setValue(t),e.phonblur&&e.phonblur()):e.innerHTML=t,ue.updateStickersHints();let i=(0,E.data)(e,"composer");return i&&window.Composer&&setTimeout((()=>Composer.updateAutoComplete(i))),!0}},editableVal:function(e,t){if(!e)return"";if("TEXTAREA"==e.tagName)return(0,E.val)(e);let i,o=e.firstChild,s="",n=new RegExp("^(DIV|P|LI|OL|TR|TD|BLOCKQUOTE)$");for(;o;){switch(o.nodeType){case 3:i=o.data.replace(/^\n|\n$/g," ").replace(/[\n\xa0]/g," ").replace(/[ ]+/g," "),s+=i;break;case 1:if(i=ue.editableVal(o),o.tagName&&o.tagName.match(n)&&i){"\n"!=i.substr(-1)&&(i+="\n");let e=o.previousSibling;for(;e&&3==e.nodeType&&""==(0,S.trim)(e.nodeValue);)e=e.previousSibling;!e||e.tagName&&(e.tagName.match(n)||"BR"==e.tagName)||(i="\n"+i)}else if("IMG"==o.tagName){let e=ue.getCode(o);e&&(t&&t.saveEmoji?i+=ue.getEmojiHTML(e):i+=ue.codeToChr(e))}else"BR"==o.tagName&&(i+="\n");s+=i}o=o.nextSibling}return s},cssEmoji:n.EMOJI_HINTS,getEmojiHTML:f.getEmojiHTML,codeToChr:p.emojiByteHexToSymbol,checkEditable:function(e,t,i){let o=t.scrollHeight,s=ue.opts[e];if(!s)return!1;s.scPaddings||(s.scPaddings=(0,S.intval)((0,E.getStyle)(t,"paddingTop"))+(0,S.intval)((0,E.getStyle)(t,"paddingBottom"))),o-=s.scPaddings;let n=s.tt;if(o>i.height+(r.browser.mozilla&&s.isChat?0:5)){if(!s.isSized){(0,E.setStyle)(t,{height:i.height+"px",overflowY:"auto"});let e=(0,E.geByClass1)("emoji_smile",s.controlsCont),o=(0,E.geByClass1)("emoji_smile_icon_promo",s.controlsCont),r=(0,E.ge)("im_upload"),c=(0,C.sbWidth)();s.ttWrap&&(c+=(0,E.getSize)(s.ttWrap)[0]-((0,E.getXY)(s.emojiBtn)[0]-(0,E.getXY)(s.ttWrap)[0])),(0,E.setStyle)(e,vk.rtl?{left:1+c}:{right:1+c}),o&&(0,E.setStyle)(o,vk.rtl?{left:2+c}:{right:2+c}),r&&(0,E.setStyle)(r.parentNode,vk.rtl?{left:1+c}:{right:1+c}),n&&(0,E.setStyle)(n,vk.rtl?{left:(s.ttDiff||31)+c}:{right:(s.ttDiff||31)+c}),s.isSized=!0}}else if(s.isSized){(0,E.setStyle)(t,{height:"auto",overflowY:"hidden"});let e=(0,E.geByClass1)("emoji_smile",s.controlsCont),i=(0,E.geByClass1)("emoji_smile_icon_promo",s.controlsCont),o=(0,E.ge)("im_upload");(0,E.setStyle)(e,vk.rtl?{left:1}:{right:1}),i&&(0,E.setStyle)(i,vk.rtl?{left:2}:{right:2}),o&&(0,E.setStyle)(o.parentNode,vk.rtl?{left:1}:{right:1}),n&&(0,E.setStyle)(n,vk.rtl?{left:s.ttDiff||31}:{right:s.ttDiff||31}),s.isSized=!1}s.onResize&&s.onResize()},stickersHintsShow:function(e,t,i){if((0,E.isVisible)(e)||(0,u.fadeIn)(e,i),!t.stickerEventsInited){(e&&(0,E.geByClass1)("_sticker_hints_inner",e)).addEventListener("wheel",ue.onWheelStickersHints),(0,h.addEvent)(document,"keydown",ue.stickerHintMove),t.onHintsMouseDown=function(){t.hintsClicked=!0,setTimeout((function(){delete t.hintsClicked}),0)},(0,h.addEvent)(e,"mousedown",t.onHintsMouseDown),t.txt&&(t.onTxtFocus&&((0,h.removeEvent)(t.txt,"focus",t.onTxtFocus),delete t.onTxtFocus),t.onTxtBlur=function(o){if(t.hintsClicked)return(0,h.cancelEvent)(o),!0;ue.stickersHintsHide(e,t,i)},(0,h.addEvent)(t.txt,"blur",t.onTxtBlur)),t.stickerEventsInited=!0}(0,ne.isNewStickerPicker)()?(0,te.moveStickersHintsToStickerPicker)(t.id,!1):ue.checkStickersHintsSize(e,t)},stickersHintsHide:function(e,t,i){if((0,u.fadeOut)(e,i),(0,h.removeEvent)(document,"keydown",ue.stickerHintMove),t.onHintsMouseDown&&(0,h.removeEvent)(e,"mousedown",ue.onHintsMouseDown),t.onHintsWheel){(e&&(0,E.geByClass1)("_sticker_hints_inner",e)).removeEventListener("wheel",ue.onWheelStickersHints)}t.txt&&(t.onTxtBlur&&((0,h.removeEvent)(t.txt,"blur",t.onTxtBlur),delete t.onTxtBlur),t.onTxtFocus&&(0,h.removeEvent)(t.txt,"focus",t.onTxtFocus),t.onTxtFocus=function(){let e=t.txt&&(0,E.geByClass1)("_sticker_hints",(0,E.domPN)(t.txt));e&&!(0,E.isVisible)(e)&&(delete t.stickerHintsString,ue.checkStickersKeywords(t.id,t,!1))},(0,h.addEvent)(t.txt,"focus",t.onTxtFocus)),delete t.stickerEventsInited,delete ue.shownHintId,ue.sendHintsLog()},stickerHintOver:function(e){ue.stickerHintOut(e),(0,E.addClass)(e,"over")},stickerHintOut:function(e){(0,S.each)((0,E.geByClass)("over",(0,E.domPN)(e)),(function(){(0,E.removeClass)(this,"over")}))},stickerHintClick:function(e,t,i,o){let s=ue.opts[e]||{},n=s.txt,r=n&&(0,E.geByClass1)("_sticker_hints",(0,E.domPN)(n)),c="suggestion_"+ue.stickerSuggestionQuery;"stories"===s.ref&&(c="story_suggestion_"+ue.stickerSuggestionQuery);let a=!1;return t<0&&(0,w.partConfigEnabled)("stickers_can_send_unpurchased_stickers")&&(t=-t,a=!0),t<0?ue.previewSticker(!1,o,{stickerId:-t,sticker_referrer:c}):((0,E.val)(n,""),ue.stickerClick(e,t,null,c,a),s.checkEditable&&s.checkEditable(e,n)),ue.stickersHintsHide(r,s,0),!1},stickerHintKeyOver:function(e,t){ue.stickerHintOver(t),ue.shownHintId=e},stickerHintKeyOut:function(e,t){ue.stickerHintOut(t),delete ue.shownHintId},stickerHintMove:function(e){let t=ue.shownHintId;if(void 0===t)return!0;let i=ue.opts[t],o=i&&(0,E.geByClass1)("_sticker_hints",(0,E.domPN)(i.txt));if(o&&(0,E.isVisible)(o)){let t=(0,E.geByClass1)("over",o)||(0,E.geByClass1)("emoji_sticker_item",o);switch(e.keyCode){case h.KEY.LEFT:return t=(0,E.domPS)(t),t&&(ue.stickerHintOver(t),ue.checkStickersHintsScroll(t)),(0,h.cancelEvent)(e),!1;case h.KEY.RIGHT:return t=(0,E.domNS)(t),t&&(ue.stickerHintOver(t),ue.checkStickersHintsScroll(t)),(0,h.cancelEvent)(e),!1;case h.KEY.ENTER:return t.click(),(0,h.cancelEvent)(e),!1}}return!0},checkStickersHintsSize:function(e,t,i){i&&((0,E.addClass)(e,"StickersHints__marginTransition"),(0,E.removeClassDelayed)(e,"StickersHints__marginTransition")),(0,E.setStyle)(e,{marginLeft:0});let o=(0,E.getXY)(e),s=(0,E.getSize)(e),n=ue.getEmojiTtXY(t.tt);t.tt&&n&&n[0]&&o[0]+s[0]+10>n[0]&&o[1]+s[1]>n[1]&&(0,E.setStyle)(e,{marginLeft:n[0]-o[0]-s[0]-10}),(0,E.domFC)(e)||ue.stickersHintsHide(e,t,0)},getEmojiTtXY:function(e){let t;return t=e&&(0,E.hasClass)(e,ue.SHOWN_TT_CLS)?(0,E.getXY)(e):[0,0],t},hintachCache:{},hintachNotFoundStickers:{},checkHintach:function(e,t,i){if((0,w.partConfigEnabled)("hintach"))return ue.hintachCache[e]?requestAnimationFrame((()=>ue.renderHintach(e,t,i,ue.hintachCache[e]))):void ajax.post("/hintach",{query:e},{onDone:o=>{ue.hintachCache[e]=o,ue.renderHintach(e,t,i,ue.hintachCache[e])}})},onHintachItemClick:function(e){const t=e.currentTarget.dataset.hint,i=parseInt(e.currentTarget.parentNode.dataset.opt);if(!t||isNaN(i))return;const o=ue.opts[i]||{},s=o.txt,n=s&&(0,E.geByClass1)("_sticker_hints",(0,E.domPN)(s)),r=(0,g.parseAttachmentId)(t);return r&&o.onHintachSend&&((0,E.val)(s,""),o.onHintachSend(r.type,r.rawId),o.checkEditable&&o.checkEditable(i,s),ue.stickersHintsHide(n,o,0)),!1},renderHintach:function(e,t,i,o){let s=t.txt,n=(0,E.geByClass1)("_sticker_hints",(0,E.domPN)(s));const r=(0,O.isArray)(o.photos)&&o.photos.length||(0,O.isArray)(o.docs)&&o.docs.length;if(e&&t.stickerHintsString&&r){let i=n&&(0,E.geByClass1)("_sticker_hints_inner",n);if(!i||t.noStickers)return!1;ue.clearHintsLog(),ue.hintachNotFoundStickers[e]&&(i.innerHTML="");let s=i.querySelector(".Hintach");s||(s=i.appendChild((0,E.ce)("div",{className:"Hintach"}))),s.setAttribute("data-opt",t.id),s.innerHTML="";const r=64*window.devicePixelRatio,c=64*window.devicePixelRatio;(o.photos||[]).forEach((e=>{const t=(0,g.getPhotoSize)(e.sizes,r,c);if(!t)return;const[i,o,n]=t,[a,l]=(0,g.prepareImageBounds)(o,n),_=(0,E.ce)("div",{className:"Hintach__item Hintach__item--photo"});_.setAttribute("data-hint","photo"+e.id),_.appendChild((0,E.ce)("div",{className:"Hintach__itemThumb"},{width:a,height:l,backgroundImage:`url(${i})`})),_.onclick=ue.onHintachItemClick,s.appendChild(_)})),(o.docs||[]).forEach((e=>{if(!e.preview)return;if(!e.preview.video&&!e.preview.graffiti)return;const[t,i,o]=e.preview.video||e.preview.graffiti,[n,r]=(0,g.prepareImageBounds)(i,o),c=(0,E.ce)("div",{className:"Hintach__item Hintach__item--doc"});c.setAttribute("data-hint","doc"+e.id);const a=c.appendChild((0,E.ce)(e.preview.video?"video":"img",{className:"Hintach__itemPreview",src:t},{width:n,height:r}));e.preview.video&&(c.appendChild((0,E.ce)("div",{className:"Hintach__itemType",innerHTML:"GIF"})),a.autoplay=!0,a.loop=!0),c.onclick=ue.onHintachItemClick,s.appendChild(c)})),s.childElementCount>0&&(ue.stickersHintsShow(n,t,100),i.scrollLeft=0,ue.checkStickersHintsScroll(n,i.scrollLeft))}},onMoneyTransferSuggestionClick:function(e,t,i){const o=ue.opts[e],s=o.txt.parentNode.querySelector("._sticker_hints");if(ue.stickersHintsHide(s,o,0),"send"===t&&o.suggestions.isMoneySendEnabled()||"request"===t&&o.suggestions.isMoneyRequestEnabled()){const{fromId:e,peer:s}=o.suggestions.config;v.default.onClick(e,s,t,i,{onSendStart:()=>{o.clearText&&o.clearText()}});const n=ue.moneyTransferTextMatch&&ue.moneyTransferTextMatch.input||"";(0,a.statlogsValueEvent)("stickers_money_transfer_suggestions","select",[t],n)}},renderMoneyTransferSuggestions:function(e,t){const i=ue.opts[e],o=(0,S.isRetina)()?128:64,s={};return i.suggestions.isMoneyRequestEnabled()?s.request=`<a\n        class="emoji_sticker_item"\n        data-money-transfer-type="request"\n        onclick="Emoji.onMoneyTransferSuggestionClick(${e}, 'request', ${t.amount||0});">\n        <img class="emoji_sticker_image" src="/images/money/request/${o}.png" />\n      </a>`:s.request="",i.suggestions.isMoneySendEnabled()?s.send=`<a\n        class="emoji_sticker_item"\n        data-money-transfer-type="send"\n        onclick="Emoji.onMoneyTransferSuggestionClick(${e}, 'send', ${t.amount||0});">\n        <img class="emoji_sticker_image" src="/images/money/send/${o}.png" />\n      </a>`:s.send="",t.request?s.request+s.send:s.send+s.request},checkStickersKeywords:function(e,t,i){if(t.noStickers||!window.stickersKeywords||!window.stickersKeywordsData||!window.stickersKeywordsData.length)return!1;let o=i?0:100,s=t.txt,n=(0,E.geByClass1)("_sticker_hints",(0,E.domPN)(s)),r=function(i,o){var s,r;if(!ue.stickers[ue.TAB_RECENT_STICKERS])return;let c=ue.sortStickersHints(window.stickersKeywords[i]),a=ue.stickers[ue.TAB_RECENT_STICKERS].promoted,l="";o&&(l+=ue.renderMoneyTransferSuggestions(e,o)),(0,S.each)(c,(function(){l+=ue.render.stickerHintRs(e,this,a[this])})),null==(s=(r=t).onStickersSuggestion)||s.call(r,c),t.suggestions.isBotLinkEnabled()&&(l+=ue.renderSuggestionsBotLink(e)),ue.showStickersHints(n,t,l)},c=function(){let c=t.suggestions.getQueries(ue.val(s));if(!c.length)return;const a=c[0],l=t.suggestions.isMoneyTransferEnabled()&&v.default.match(a,1);if(l&&(c=[v.default.DEFAULT_QUERY]),ue.moneyTransferTextMatch=l,!n&&(n=ue.initStickersHints(s),!n))return!1;if(a==t.stickerHintsString)return;const _=c.find((e=>e&&window.stickersKeywords[e]&&window.stickersKeywords[e].length||l));if(ue.stickerSuggestionQuery=_,_)if(ue.stickers[ue.TAB_RECENT_STICKERS])r(_,l);else{let i=t.onRecentEmojiUpdate;t.onRecentEmojiUpdate=function(e){i&&i(),e&&(i?t.onRecentEmojiUpdate=i:delete t.onRecentEmojiUpdate,r(_,l))},ue.emojiLoadMore(e)}else ue.hintachNotFoundStickers[a]=!0,ue.stickersHintsHide(n,t,o);!l&&a&&a.length<20&&t.onHintachSend&&(clearTimeout(t.hintachCheckTimeout),t.hintachCheckTimeout=setTimeout((()=>{ue.checkHintach(a,t,i)}),160)),t.stickerHintsString=a};i?c():(clearTimeout(t.stickerHintTT),t.stickerHintTT=setTimeout(c,n&&(0,E.isVisible)(n)?0:200))},showStickersHints:function(e,t,i){let o=e&&(0,E.geByClass1)("_sticker_hints_inner",e);if(!o||t.noStickers)return!1;ue.clearHintsLog(),(0,E.val)(o,i),ue.stickersHintsShow(e,t,100),o.scrollLeft=0,ue.checkStickersHintsScroll(e,o.scrollLeft)},checkStickersHintsScroll:function(e,t){let i=(0,E.domClosest)("_sticker_hints",e),o=i&&(0,E.geByClass1)("_sticker_hints_inner",i),s=i&&(0,E.geByClass1)("_sticker_left",i),n=i&&(0,E.geByClass1)("_sticker_right",i);if(!o)return!1;const r=(0,E.getSize)(s)[0],c=(0,E.getSize)(n)[0];if((0,E.hasClass)(e,"emoji_sticker_item")){let i=e.offsetLeft-8-r,s=e.offsetLeft+(0,E.getSize)(e)[1]+2+c-o.clientWidth;o.scrollLeft>i&&(o.scrollLeft=i),o.scrollLeft<s&&(o.scrollLeft=s),t=o.scrollLeft}let l=t>0,_=t+o.clientWidth<o.scrollWidth;(0,E.toggle)(s,l),(0,E.toggleClass)(i,"sticker_hints_left_pad",l),(0,E.toggle)(n,_),(0,E.toggleClass)(i,"sticker_hints_right_pad",_),t=void 0===t?o.scrollLeft:t;const d=o.querySelectorAll(".emoji_sticker_item"),u=l?r+8:0,m=_?c+2:0,h=Array.from(d).filter((e=>e.offsetLeft-u>=t&&e.offsetLeft+e.offsetWidth+m-o.clientWidth<=t));ue.logHints(h.map((e=>(0,S.intval)(e.getAttribute("data-sticker-id")))).filter((e=>e)));const p=h.map((e=>e.getAttribute("data-money-transfer-type"))).filter((e=>e));if(p.length){const e=ue.moneyTransferTextMatch&&ue.moneyTransferTextMatch.input||"";(0,a.statlogsValueEvent)("stickers_money_transfer_suggestions","show",p,e)}},logHints:function(e){ue.logHintsTimeout&&clearTimeout(ue.logHintsTimeout),ue.logHintsTimeout=setTimeout((()=>{ue.hintsLogBuffer=e.reduce(((e,t)=>(e[t]=1,e)),ue.hintsLogBuffer||{})}),ue.logHintsDelay)},clearHintsLog:function(){ue.logHintsTimeout&&clearTimeout(ue.logHintsTimeout),ue.hintsLogBuffer={}},sendHintsLog:function(){const e=ue.hintsLogBuffer&&Object.keys(ue.hintsLogBuffer),t=window.cur&&window.cur.emojiHintsSendLogHash;e&&e.length&&t&&ajax.post("stickers.php",{act:"log_hints",sticker_ids:e,hash:t}),ue.clearHintsLog()},scrollStickersHints:function(e,t,i){let o=(0,E.domClosest)("_sticker_hints",e),s=o&&(0,E.geByClass1)("_sticker_hints_inner",o),n=o&&(0,E.geByClass1)("_sticker_left",o),r=o&&(0,E.geByClass1)("_sticker_right",o);if(!s)return!1;let c=s.scrollLeft+t*(s.clientWidth-2*(0,E.getSize)(e)[0]),a=(0,E.geByClass)("emoji_sticker_item",s);(0,S.each)(a,(function(e,i){return t>0&&i.offsetLeft-8-(0,E.getSize)(n)[0]>c?(c=a[e-1]&&a[e-1].offsetLeft-8-(0,E.getSize)(n)[0]||c,!1):t<0&&i.offsetLeft+(0,E.getSize)(i)[1]+2+(0,E.getSize)(r)[0]-s.clientWidth>c?(c=i.offsetLeft+(0,E.getSize)(i)[1]+2+(0,E.getSize)(r)[0]-s.clientWidth||c,!1):void 0})),c=Math.max(0,Math.min(s.scrollWidth-s.clientWidth,c)),(0,u.animate)(s,{scrollLeft:c},{duration:Math.abs(s.scrollLeft-c)+50,transition:u.Fx.Transitions.easeOutCubic}),ue.checkStickersHintsScroll(s,c)},onWheelStickersHints:function(e){e.preventDefault(),e.stopPropagation();const t=e.currentTarget;t.scrollLeft+=Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX,ue.checkStickersHintsScroll(t,t.scrollLeft)},sortStickersHints:function(e){let t=[];ue.stickers[-1]&&(t=ue.stickers[-1].stickers);let i={},o=[];return(0,S.each)(t,(function(){(0,S.inArray)(this[0],e)&&!i[this[0]]&&(o.push(this[0]),i[this[0]]=1)})),(0,S.each)(e,(function(){i[this]||o.push(this)})),o},initStickersHints:function(e){return!!e&&(0,E.domPN)(e).insertBefore((0,E.se)(`<div class="_sticker_hints sticker_hints_tt">\n      <div class="sticker_hints_arrow sticker_left _sticker_left" onmousedown="Emoji.scrollStickersHints(this, -1, event);cancelEvent(event);" onclick="cancelEvent(event);">\n        ${(0,V.getIcon24ChevronLeft)().icon}\n      </div>\n      <div class="_sticker_hints_inner sticker_hints_inner"></div>\n      <div class="sticker_hints_arrow sticker_right _sticker_right" onmousedown="Emoji.scrollStickersHints(this, 1, event);cancelEvent(event);" onclick="cancelEvent(event);">\n        ${(0,U.getIcon24ChevronRight)().icon}\n      </div>\n    </div>`),e)},updateStickersHints:function(e){ue.opts&&(0,S.each)(ue.opts,(function(t,i){e&&delete i.stickerHintsString,ue.checkStickersKeywords(t,i,!0)}))},renderSuggestionsBotLink(e){const{suggestions:t}=ue.opts[e],i=(0,S.isRetina)()?128:64,o=Y.colorScheme.isDarkScheme()?"dark":"light";return`<a\n    class="emoji_sticker_item"\n    href="${t.getBotLinkUrl()}"\n    onClick="Emoji.onSuggestionsBotLinkClick(event, ${e});"\n    target="_blank">\n    <img class="emoji_sticker_image" src="${t.getBotLinkImageUrl(i,o)}" />\n  </a>`},onSuggestionsBotLinkClick(e,t){e.stopPropagation();const{suggestions:i}=ue.opts[t];(0,a.statlogsValueEvent)(i.getBotLinkClickStatName(),0,...i.getBotLinkClickStatKeys())},initPromotedStickerUrls:function(){if(!window.promotedStickerUrls){let e=ls.get("promoted_stickers_urls");if(e&&e.time&&e.time>(0,O.vkNow)()-ue.stickersKeywordsExpire)window.promotedStickerUrls=e.stickerUrls;else{let e={act:"get_promoted_stickers"};ajax.post("al_im.php",e,{onDone:function(e){ls.set("promoted_stickers_urls",{time:(0,O.vkNow)(),stickerUrls:e}),window.promotedStickerUrls=e}})}}},emojiEnter:function(e,t){let i=ue.opts[e],o=(i.ctrlSend?i.ctrlSend():i.noEnterSend)||cur.ctrl_submit&&!i.noCtrlSend;if(i.emojiFocused&&i.emojiOvered&&i.openedByTabKey&&(o?!(t.ctrlKey||r.browser.mac&&t.metaKey):!t.shiftKey)){if(0===i.curTab){let t=(0,E.geByTag1)("img",i.emojiOvered)||(0,E.geByTag1)("i",i.emojiOvered);ue.addEmoji(e,ue.getCode(t),i.emojiOvered)}return(0,h.cancelEvent)(t)}return!0},insertHTML:function(e){if(r.browser.msie&&parseInt(r.browser.version)<12)if(document.selection){let t=document.selection.createRange();t.pasteHTML&&t.pasteHTML(e)}else{let t=document.getSelection().getRangeAt(0),i=document.createElement("span");t.surroundContents(i),i.innerHTML=e,t.collapse(!1)}else e&&document.execCommand("insertHTML",!1,e)},addEmoji:function(e,t){if(!1===e||!1===t)return!1;let i=ue.opts[e];if(i){if(!((0,O.vkNow)()-i.ttShowT<ue.CLICK_DELAY)){if(i.editable){let e=ue.getEmojiHTML(t,ue.codeToChr(t),!0),o=i.txt,s=!!window.getSelection&&window.getSelection(),n=!1;if(s&&s.rangeCount){let e=s.getRangeAt(0);n=e.commonAncestorContainer?e.commonAncestorContainer:e.parentElement?e.parentElement():e.item(0)}let c=n;for(;c&&c!=o;)c=c.parentNode;let a=o.lastChild||{};r.browser.mozilla&&"BR"==a.tagName&&!a.previousSibling&&(0,E.re)(o.lastChild),c||ue.editableFocus(o,!1,!0),ue.insertHTML(e);let l=(0,E.geByClass)("emoji",o);l.push.apply(l,(0,E.geByClass)("emoji_css",o));for(let e in l)if(l.hasOwnProperty(e)){let t=l[e].previousSibling;if(t&&3==t.nodeType&&t.textContent&&32==t.textContent.charCodeAt(0)){let e=t.previousSibling;e&&3==e.nodeType&&e.textContent&&160==e.textContent.charCodeAt(e.textContent.length-1)&&(0,E.re)(t)}}o.check&&o.check(),setTimeout((()=>ue.correctCaret(o)),5),ue.onChange(i);let _=(0,E.data)(o,"composer");_&&window.Composer&&Composer.updateAutoComplete(_)}else{let e,o,s,n=i.txt,c=n.value;e=r.browser.iphone||r.browser.ipad?ue.codeToChr(t):ue.cssEmoji[t][1]+" ",null!=n.selectionStart&&null!=n.selectionEnd?(o=n.selectionEnd,n.value=c.slice(0,n.selectionStart)+e+c.slice(o),n.selectionStart=n.selectionEnd=o+e.length):void 0!==document.selection&&void 0!==document.selection.createRange&&(n.focus(),s=document.selection.createRange(),s.text=e,s.select())}i.checkEditable&&i.checkEditable(e,i.txt),ue.checkStickersKeywords(e,i),i.saveDraft&&i.saveDraft(),i.onEmojiAdded&&i.onEmojiAdded(),ue.incrRecentEmojiRate(e,t)}}else(0,l.logError)(new Error(`addEmoji got no opts by optId: ${e}, Emoji.opts === ${JSON.stringify(ue.opts)}`))},showShadow:function(){return!(r.browser.msie&&r.browser.version<10)},scrollTabsTo(e,t,i=!1){const o=ue.opts[e];if(!o.tt)return;const s=o.tt.querySelector(".emoji_tabs_wrap"),n=s.querySelector(".emoji_tabs_cont"),r=n.getBoundingClientRect().width-s.getBoundingClientRect().width,c=Math.max(0,Math.min(t,r));s.parentNode.classList.toggle("emoji_tabs--scrollable-left",c>0),s.parentNode.classList.toggle("emoji_tabs--scrollable-right",c<r),n.classList.toggle("emoji_tabs_cont--no-transition",i),n.style.setProperty("--scroll-left",-c+"px"),o.tabsScrollLeft=c,ue.vmojiTooltipCheckVisibilityByScroll(c,o.tt,e)},scrollTabsBy(e,t,i=!1){const{tabsScrollLeft:o=0}=ue.opts[e];ue.scrollTabsTo(e,o+t,i)},throwTabsScroll(e){ue.scrollTabsBy(e,0,!0)},scrollTabsLeft(e){ue.destroyVmojiOnboardingTooltip(),ue.scrollTabsBy(e,-170)},scrollTabsRight(e){ue.scrollTabsBy(e,170)},tabsWheel:function(e,t){(0,h.cancelEvent)(e);const i=Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX;ue.scrollTabsBy(t,i,!0)},scrollToTab:function(e,t){const{tt:i}=ue.opts[t],o=i.querySelector(`.emoji_tab_${e}`);if(!o)return;const s=o.getBoundingClientRect(),n=o.closest(".emoji_tabs_cont").getBoundingClientRect(),r=o.closest(".emoji_tabs_wrap").getBoundingClientRect(),c=s.left-n.left-(r.width-s.width)/2;ue.scrollTabsTo(t,c),ue.selectTab(t,e,o)},selectTab:function(e,t,i){var o;const s=ue.opts[e];if(void 0===i&&(i=(0,E.geByClass1)("emoji_tab_"+t,s.tt)),void 0===i)return;const n=i.closest(".emoji_tabs");null==(o=n.querySelector(".emoji_tab_sel"))||o.classList.remove("emoji_tab_sel"),i.classList.add("emoji_tab_sel"),s.curTab=t,cur.stickersTab=t,ls.set("stickers_tab",t);const r=i.closest(".emoji_tabs_group");r&&(r.classList.add("emoji_tabs_group--expanded"),r.style.setProperty("--width",r.scrollWidth+"px")),n.querySelectorAll(".emoji_tabs_group").forEach((e=>{e!==r&&e.classList.remove("emoji_tabs_group--expanded")}))},show:function(e,t){(0,ne.isNewStickerPicker)()?ue.showNewPicker(e):ue.showOldPicker(e,t)},showNewPicker:function(e){let t=(0,E.data)(e.parentNode,"optId");if(void 0===t||!window.StickerPickerViewer)return;const i=ue.opts[t];if(!i)return;const{noStickers:o,pickerHeight:s,pickerPosition:n}=i;Object.assign(window.StickerPickerViewer,{onlyEmoji:o,optId:t,pickerHeight:s,pickerPosition:n}),window.StickerPickerViewer.show(e),ue.shown=!0},showOldPicker:function(e,t){const i=(0,E.data)(e.parentNode,"optId");void 0!==i&&ue.ttShow(i,e,t)},hide:function(e,t,i){(0,ne.isNewStickerPicker)()?ue.hideNewPicker():ue.hideOldPicker(e,t,i)},hideNewPicker:function(){var e;null==(e=window.StickerPickerViewer)||e.hide(),ue.shown=!1},hideOldPicker:function(e,t,i){let o=(0,E.data)(e.parentNode,"optId");void 0!==o&&ue.ttHide(o,e,t,i)},ttShow:function(e,t,i){let o=ue.opts[e];clearTimeout(o.ctt),clearTimeout(o.stt),o.scrolling&&(o.afterScrollFn=!1),o.ttShown||(t?o.obj=t:t=o.obj,o.stt=setTimeout((function(){ue.ttClick(e,t,!1,!0,i)}),ue.SHOW_TT_TIMEOUT))},ttHide:function(e,t,i,o){let s=ue.opts[e];if(clearTimeout(s.stt),!s.ttShown)return;if(s.scrolling)return void(s.afterScrollFn=()=>ue.ttHide(e,t,i,o));t=t||s.obj||(0,E.geByClass1)("emoji_smile",s.controlsCont);let n=function(){ue.ttClick(e,t,!0,!1,i)};o?n():(clearTimeout(s.ctt),s.ctt=setTimeout(n,ue.HIDE_TT_TIMEOUT))},isVmojiStubIconVisibile(e){const t=e.querySelector(".emoji_tabs_wrap"),i=e.querySelector(".emoji_tab--vmoji-stub");if(!i||!t)return;const o=t.getBoundingClientRect(),s=i.getBoundingClientRect();return o.x<s.x},destroyVmojiOnboardingTooltip(){ue.vmojiOnboardingTooltipTimer&&(clearTimeout(ue.vmojiOnboardingTooltipTimer),ue.vmojiOnboardingTooltipTimer=null),ue.vmojiOnboardingTooltip&&(ue.vmojiOnboardingTooltip.destroy&&ue.vmojiOnboardingTooltip.destroy(),ue.vmojiOnboardingTooltip=null);const e=document.querySelector(".emoji_tab--vmoji-stub");e&&e.removeEventListener("click",ue.vmojiOnboardingToltipSendHideRequest)},buildVmojiOnboardingTooltip(e,t){var i;if(ue.vmojiOnboardingTooltipWasDone||ue.vmojiOnboardingTooltipTimer||(null==(i=ue.vmojiOnboardingTooltip)?void 0:i._isShown))return;const o=ue.stickers[ue.TAB_VMOJI]&&ue.stickers[ue.TAB_VMOJI].vmoji_tooltip_info;if(!e||!o)return;const s=e.querySelector(".emoji_tab--vmoji-stub");s&&(ue.vmojiOnboardingTooltipTimer=setTimeout((()=>{var i;ue.vmojiOnboardingTooltipTimer=null,ue.vmojiOnboardingTooltip=new Z.default(s,{content:o.content,autoShow:!1,width:"auto",forceSide:"top",appendTo:e,withCloseButton:!0,autoAdjustToViewport:!1,noAutoHideOnWindowClick:!0,cls:"EmojiTab__onboardingTooltip",delay:0,onClick:function(e){e.stopPropagation(),ue.vmojiOnboardingToltipSendHideRequest(),ue.tabSwitch(ue.TAB_VMOJI,ue.TAB_VMOJI,t)}}),ue.vmojiOnboardingTooltip.show&&ue.vmojiOnboardingTooltip.show(),s.addEventListener("click",ue.vmojiOnboardingToltipSendHideRequest,!0),null==(i=window.cur.destroy)||i.push(ue.destroyVmojiOnboardingTooltip)}),500))},vmojiTooltipCheckVisibilityByScroll(e,t,i){0===e?ue.buildVmojiOnboardingTooltip(t,i):ue.destroyVmojiOnboardingTooltip()},vmojiOnboardingToltipSendHideRequest(){const e=ue.stickers[ue.TAB_VMOJI]&&ue.stickers[ue.TAB_VMOJI].vmoji_tooltip_info;if(!e||ue.vmojiOnboardingTooltipWasDone)return;const{vmojiOnboardingHintHash:t,vmojiOnboardingHintId:i}=e;window.ajax.post("al_index.php",{act:"help_hints_hide",hash:t,hint_id:i}),ue.vmojiOnboardingTooltipWasDone=!0,ue.destroyVmojiOnboardingTooltip()},ttClick:function(e,t,i,o,s,n){window.stManager.add(["emoji.css"],(()=>{ue.buildOldPicker(e,t,i,o,s,n)}))},buildOldPicker:function(e,t,i,o,s,n){let c=ue.opts[e];if(!c)return;if(i&&!ue.shown||o&&ue.shown)return;if(!t&&!(t=ue.shown||(0,E.ge)(-3==cur.peer?"imw_smile":"im_smile")))return;t.tt&&t.tt.destroy&&t.tt.destroy(),!c.tt&&c.sharedTT&&c.sharedTT.emojiTT&&(c.tt=c.sharedTT.emojiTT,c.emojiScroll=c.sharedTT.emojiScroll,c.allEmojiId=c.sharedTT.emojiAllId);let a,l=c.tt;if(!l){let t=ue.getPrevTab(c.noStickers);c.curTab=cur.stickersTab=t,t==ue.TAB_EMOJI||c.noStickers||(ue.stickers[ue.TAB_RECENT_STICKERS]=ls.get("recent_stickers"));let i='<div class="emoji_tabs_l_s" onmousedown="Emoji.scrollTabsLeft('+e+'); return cancelEvent(event);" onclick="return cancelEvent(event)"><div class="emoji_sprite emoji_tabs_l_sc"></div><div class="emoji_sprite emoji_tabs_l_si"></div></div><div class="emoji_tabs_r_s" onmousedown="Emoji.scrollTabsRight('+e+'); return cancelEvent(event);" onclick="return cancelEvent(event);"><div class="emoji_sprite emoji_tabs_r_sc"></div><div class="emoji_sprite emoji_tabs_r_si"></div></div>';i+=ue.getTabsCode([[0,1]],e),i+='<span class="emoji_tabs_wrap"><span id="emoji_tabs_cont_'+e+'" class="emoji_tabs_cont">',c.noStickers||!1===window.emojiStickers||void 0===window.emojiStickers||(i+=ue.getTabsCode(window.emojiStickers,e));let o="",s='onmousedown="Emoji.showStickersStore('+e+'); return cancelEvent(event);" onclick="return cancelEvent(event);"',n="showTooltip(this, {text: '"+I.getLang("global_store_stickers")+"', shift: [4,6,6], showdt: 0, black: 1});";c.rPointer?s+=" onmouseover=\"addClass(this.parentNode.parentNode.parentNode, 'emoji_shop_over');"+n+'" onmouseout="removeClass(this.parentNode.parentNode.parentNode, \'emoji_shop_over\');"':s+=' onmouseover="'+n+'"',i+="</span></span>",c.noStickers||(i+='<a class="emoji_shop" '+s+'><div class="emoji_sprite emoji_shop_icon">'+(ue.hasNewStickers?'<div class="emoji_shop_icon_badge">'+Math.abs(ue.hasNewStickers)+"</div>":"")+"</div></a>"),ue.showShadow()||(o+=" emoji_no_opacity"),c.noStickers&&(o+=" emoji_no_tabs"),l=(0,E.ce)("div",{id:"emoji_block_"+e,className:"emoji_tt_wrap tt_down"+o,innerHTML:'<div class="emoji_block_cont"><div class="emoji_block_rel"><div class="emoji_list_cont"><div class="emoji_cats_title_helper"></div><div class="emoji_list"><div class="emoji_scroll emoji_scroll_smiles"></div><div class="emoji_scroll emoji_scroll_stickers"></div></div></div></div><div class="emoji_tabs">'+i+"</div></div>",onmouseenter:function(t){(0,E.hasClass)(l,"emoji_animated")||ue.ttShow(e,!1,t)},onmouseleave:function(t){(0,E.hasClass)(l,"emoji_animated")||ue.ttHide(e,!1,t)}}),c.tt=l,ue.reappendEmoji(e,l),ue.emojiOver(e,(0,E.geByClass1)("emoji_scroll_smiles",l).firstChild),(0,S.each)(["emoji_tabs_l_s","emoji_tabs_r_s","emoji_tabs_wrap"],(function(){(0,h.addEvent)((0,E.geByClass1)(this,c.tt),"DOMMouseScroll wheel",(function(t){ue.tabsWheel(t,e)}))})),c.sharedTT&&(c.sharedTT.emojiTT=l),ue.throwTabsScroll(e)}if(!1!==ue.shownId&&ue.shownId!=e&&ue.ttClick(ue.shownId,(0,E.geByClass1)("emoji_smile",ue.opts[ue.shownId].controlsCont),!0),ue.preventMouseOver=!1,c.emojiExpanded||ue.emojiUIScroll(e,l),ue.shown)ue.hideTt(l),a=(0,E.geByClass1)("_sticker_hints",(0,E.domPN)(c.txt)),a&&(0,E.isVisible)(a)&&ue.checkStickersHintsSize(a,c,!0),ue.shown=!1,ue.shownId=!1,c.ttShown=!1,c.emojiFocused=!1,c.emojiOvered=!1,cur.onMouseClick=!1,(0,h.removeEvent)(document,"keydown",ue.emojiMove),(0,E.removeClass)(t,"emoji_smile_on"),c.onHide&&c.onHide(),ue.destroyVmojiOnboardingTooltip();else{if(!(0,E.getXY)(c.emojiBtn)[0]||!(0,E.getXY)(c.emojiBtn)[1])return;c.openedByTabKey=!!n,ue.showTt(l),ue.buildVmojiOnboardingTooltip(l,e),ue.repositionEmoji(e,t,l),a=(0,E.geByClass1)("_sticker_hints",(0,E.domPN)(c.txt)),a&&(0,E.isVisible)(a)&&ue.checkStickersHintsSize(a,c,!0),ue.shownId=e,ue.shown=t,cur.emojiList=(0,E.geByClass1)("emoji_list",l),c.ttShown=!0,c.ttShowT=(0,O.vkNow)(),c.emojiFocused=!0,(0,h.removeEvent)(document,"keydown",ue.emojiMove),setTimeout((function(){cur.onMouseClick=function(t){let i=t.target;for(;i;){if("im_texts"==i.id||(0,E.hasClass)(i,"emoji_tt_wrap")||(0,E.hasClass)(i,"imw_emoji_wrap"))return!1;i=i.parentNode}ue.ttClick(e,!1,!0)},(0,h.addEvent)(document,"keydown",ue.emojiMove)}),0),(0,E.addClass)(t,"emoji_smile_on"),c.emojiScroll&&c.emojiExpanded&&(c.emojiScroll.update(),r.browser.msie&&0===c.curTab&&c.emojiOvered&&ue.scrollToListEl(e,c.emojiOvered)),c.currentPeerId=void 0,window.emojiStickers&&ue.resetStickerPackViews(e),ue.tabSwitch(c.curTab,c.curTab,e,!1,!0),c.onRecentEmojiUpdate&&c.onRecentEmojiUpdate(!0),c.onShow&&c.onShow(),c.tt.classList.toggle("emoji_tt_can_gift",!("im"===cur.module&&cur.gid))}return ue.hideStickersStoreNotification(),ue.noNewStickers=!0,c.noStickersStore?(0,E.addClass)((0,E.geByClass1)("emoji_tabs","emoji_block_"+e),"emoji_tabs_no_store"):(0,E.removeClass)((0,E.geByClass1)("emoji_tabs","emoji_block_"+e),"emoji_tabs_no_store"),(0,h.cancelEvent)(s)},getPrevTab:e=>e?ue.TAB_EMOJI:ls.get("stickers_tab")||ue.TAB_EMOJI,curEmojiKeys:{},curEmojiRecent:{},loadingPeerInfo:{},getPeerId:()=>cur.peer,getPeerInfo(e){if(this.loadingPeerInfo[e])return this.loadingPeerInfo[e];if(!M.Ranges.isUserId(e))return Promise.resolve(null);const t=new Promise(((t,i)=>ajax.post("stickers.php",{act:"get_peer_info",peer_id:e},{onDone:i=>{this.loadingPeerInfo[e]=null,t(i)},onFail(){this.onDone(null)}})));return this.loadingPeerInfo[e]=t,t},emojiLoadMore:function(e,t={},i){let o=ue.opts[e];o.emojiMoreSt||(o.emojiMoreSt=1,ue.emojiFetchMore(t).then((({stickers:t,recentEmoji:s})=>{ue.updateEmojiList(t,s,e,o),(0,O.isFunction)(i)&&i()}),(e=>{console.error("Emoji.emojiLoadMore error ",e),o.emojiMoreSt=0})),ue.curEmojiRecent&&o.onRecentEmojiUpdate&&o.onRecentEmojiUpdate())},emojiFetchMore(e={}){e.act="get_emoji_list",ue.stickerPacksToLoad&&(e.sticker_packs_to_load=ue.stickerPacksToLoad.join(",")),ue.hasNewStickers<0&&(e.new_shown=1);const t=Object.assign(e.sizes||{},ue.stickerSizes);return e.sizes=t&&Object.keys(t).join(","),new Promise(((t,i)=>{ajax.post("al_im.php",e,{onDone:function(...e){t(e)},onFail:function(e){return i(e),!0}})})).then((([e,i,o,s,n,r])=>{if(ue.buildStickersIndex(e),void 0!==e[ue.TAB_FAVORITE_STICKERS]){let t=e[ue.TAB_FAVORITE_STICKERS];ue.tabDefaultId=ue.TAB_FAVORITE_STICKERS,ue.favoriteAvailable=!0,ue.favoriteRemindOn=!!t.remind_on,ue.favoriteRemindOff=!!t.remind_off,ue.favoriteLimit=t.limit,ue.favoriteLimitNoticed=t.limit_noticed,ue.sendHintsLogHash=n,v.default.setIntroViewed(r)}s&&(0,S.extend)(cur.lang,s),Object.assign(ue.stickerSizes,t);const c=[];return void 0!==Object.values(e).find((e=>e.vmoji_character_id))&&c.push(window.jsc("web/vmoji.js")),o&&c.push(window.jsc("web/stickers.js")),window.stManager.add(c).then((()=>({stickers:e,recentEmoji:i})))}))},emojiPreloadMore(e,t){ue.isStickersPreloading||(ue.isStickersPreloading=!0,ue.emojiFetchMore(e).then((({stickers:e,recentEmoji:i})=>{ue.stickers=e,ue.stickers[ue.TAB_RECENT_STICKERS]&&ls.set("recent_stickers",ue.stickers[ue.TAB_RECENT_STICKERS]);const o=ue.emojiGetRecentFromStorage();o?ue.curEmojiRecent=ue.filterEmoji(o):ue.emojiOldRecentPrepare(i),t&&t()}),(e=>{console.error("Emoji.emojiPreloadMore error ",e)})).finally((()=>{ue.isStickersPreloading=!1})))},buildStickersIndex:function(e){let t={};if(e)for(let i in e)if(e.hasOwnProperty(i)&&i>0&&e[i].stickers){let o=e[i].stickers,s=o.length;for(;s--;){let e=o[s];t[e[0]]={sticker:e,packId:i}}}ue.stickersById=t},updateEmojiList:function(e,t,i,o){ue.stickers=e,o.emojiMoreSt=0,ue.stickers[-1]&&(ls.set("recent_stickers",ue.stickers[-1]),ue.updateRecentEmoji(i)),o.allEmojiId=0,o.sharedTT&&(o.sharedTT.emojiAllId=0),ue.onStickersLoad&&(o.afterLoad=1),ue.onStickersLoad&&window.emojiStickers&&(ue.onStickersLoad(),ue.onStickersLoad=!1);let s=ue.emojiGetRecentFromStorage();s?ue.curEmojiRecent=ue.filterEmoji(s):(ue.emojiOldRecentPrepare(t,i),ue.updateEmojiCont(i)),ue.updateRecentEmoji(i),o.onRecentEmojiUpdate&&o.onRecentEmojiUpdate(!0)},filterEmoji:function(e){let t=Object.keys(e);e:for(let e in k.EMOJI_SECTIONS_CODES)if(k.EMOJI_SECTIONS_CODES.hasOwnProperty(e))for(let i in k.EMOJI_SECTIONS_CODES[e])if(k.EMOJI_SECTIONS_CODES[e].hasOwnProperty(i)){let o=k.EMOJI_SECTIONS_CODES[e][i],s=t.indexOf(o);if(-1!=s&&(t.splice(s,1),0==t.length))break e}let i={};for(let o in e)e.hasOwnProperty(o)&&-1==t.indexOf(o)&&(i[o]=e[o]);return t.length>0&&ue.setRecentEmojiList(i),i},emojiGetRecentFromStorage:function(){try{return JSON.parse(localStorage.getItem("emoji_recent_list"))}catch(e){return!1}},emojiOldRecentPrepare:function(e){let t={};for(let i in e)if(e.hasOwnProperty(i)){let o,s,n=e[i];(0,O.isString)(n)?(o=1,s=n):(o=n,s=i),t[s]=o}ue.setRecentEmojiList(ue.filterEmoji(t))},getRecentEmojiSorted:function(){let e=[];for(let t in ue.curEmojiRecent)if(ue.curEmojiRecent.hasOwnProperty(t)){let i=ue.curEmojiRecent[t];e.push([t,i])}e.sort((function(e,t){return t[1]-e[1]}));let t=[];for(let i in e)e.hasOwnProperty(i)&&t.push(e[i][0]);return t.slice(0,20)},incrRecentEmojiRate:function(e,t){ue.emojiRecentRateTime||(ue.emojiRecentRateTime=Date.now()/1e3-6);let i=Date.now()/1e3-ue.emojiRecentRateTime;if(i>=6){let e=Math.min(100,Math.floor(i/6));for(let i in ue.curEmojiRecent)if(ue.curEmojiRecent.hasOwnProperty(i)){if(i==t)continue;ue.curEmojiRecent[i]*=Math.pow(.998076,e)}ue.emojiRecentRateTime+=6*e}ue.curEmojiRecent[t]||(ue.curEmojiRecent[t]=0),ue.curEmojiRecent[t]+=1;let o=ue.getRecentEmojiSorted();k.EMOJI_SECTIONS_CODES[-1]=o,o.length>=20&&-1==o.indexOf(t)&&(o.splice(-1),o.push(t));let s={};for(let e in o)if(o.hasOwnProperty(e)){let t=o[e];s[t]=ue.curEmojiRecent[t]}ue.setRecentEmojiList(s),window.Notifier&&Notifier.lcSend("recent_emoji_set",s)},setRecentEmojiList:function(e){localStorage.setItem("emoji_recent_list",JSON.stringify(e)),ue.curEmojiRecent=e},updateEmojiCont:function(e){let t=ue.opts[e];t&&0==t.curTab&&((0,E.val)((0,E.geByClass1)("emoji_scroll_smiles",t.tt),ue.getInitEmojiContent(e)),ue.updateEmojiCatTitle(e))},ttEmojiList:function(e,t){let i="",o=ue.emojiGetRecentFromStorage();o&&ue.setRecentEmojiList(o),k.EMOJI_SECTIONS_CODES[-1]=ue.getRecentEmojiSorted();let s=t||ue.SORTED_EMOJI_SECTIONS_CODES;for(let t in s)if(s.hasOwnProperty(t)){let o=s[t];i+=ue.getEmojiCategoryHtml(e,o)}return i},getInitEmojiContent:function(e){ue.setEmojiLastAddedCategoryIdx(e,1);return ue.ttEmojiList(e,[-1,1])},getEmojiCategoryHtml:function(e,t){let i="",o=k.EMOJI_SECTIONS_CODES[t];if(!o.length)return i;let s='<div class="emoji_cat_title_helper" data-id="'+t+'" id="emoji_recent_list'+e+"_"+t+'"><div class="emoji_cat_title">'+ue.getEmojiCategoryText(t)+"</div></div>";return s+=ue.emojiGetCatCont(e,o),i+=s,i},getEmojiCategoryText:function(e){switch(-1===e?"recent":parseInt(e,10)){case"recent":return I.getLang("global_emoji_cat_recent");case 1:return I.getLang("global_emoji_cat_1");case 2:return I.getLang("global_emoji_cat_2");case 3:return I.getLang("global_emoji_cat_3");case 4:return I.getLang("global_emoji_cat_4");case 5:return I.getLang("global_emoji_cat_5");case 6:return I.getLang("global_emoji_cat_6");case 7:return I.getLang("global_emoji_cat_7");case 8:return I.getLang("global_emoji_cat_8");case 9:return I.getLang("global_emoji_cat_9")}},getEmojiLastAddedCategoryIdx:function(e){return ue.opts[e].lastLoadedEmojiCategoriesIdxes[e]},setEmojiLastAddedCategoryIdx:function(e,t){ue.opts[e].lastLoadedEmojiCategoriesIdxes[e]=t},addNextEmojiCategoty:function(e){let t=ue.opts[e],i=t.tt,o=ue.getEmojiLastAddedCategoryIdx(e);if(t.emojiCategoryAdding||t.allEmojiLoaded)return;if(t.emojiCategoryAdding=!0,!o)return void(0,c.debugLog)("No emoji last category idx");let s=(0,E.geByClass1)("emoji_scroll_smiles",i);if(o++,ue.SORTED_EMOJI_SECTIONS_CODES.length>o){let i=ue.SORTED_EMOJI_SECTIONS_CODES[o];s.insertAdjacentHTML("beforeEnd",ue.getEmojiCategoryHtml(e,i)),ue.setEmojiLastAddedCategoryIdx(e,o),t.emojiScroll.update()}else t.allEmojiLoaded=!0;t.emojiCategoryAdding=!1},hideTt:function(e){(0,E.removeClass)(e,ue.SHOWN_TT_CLS)},showTt:function(e){(0,E.addClass)(e,ue.SHOWN_TT_CLS)},emojiGetCatCont:function(e,t){let i="",o="",s=t.length-1;for(let n=0;n<=s;n++)o+=ue.emojiWrapItem(e,t[n],n),(n>0&&n%10==9||n>=s)&&(i+='<div class="emoji_smiles_row">'+o+"</div>",o="");return i},updateRecentEmoji:function(e){let t=ue.getRecentEmojiSorted(),i=ue.emojiGetCatCont(e,t),o=(0,E.ge)("emoji_recent_list"+e+"_-1");if(!o)return;let s=o.nextSibling;for(;s&&(s=s.nextSibling,(0,E.hasClass)(s.previousSibling,"emoji_smiles_row"));)(0,E.re)(s.previousSibling);let n=(0,E.ce)("div",{innerHTML:i}),r=o.nextSibling,c=o.parentNode;for(;s=n.firstChild;)c.insertBefore(s,r)},findStickerIndex:function(e,t){if(e){let i=e.stickers,o=i.length;for(;o--;)if(String(i[o][0])===String(t))return o}return-1},findSticker:function(e,t){let i=ue.findStickerIndex(e,t);if(-1!==i)return e.stickers[i]},findFavoriteStickerIndex:function(e){return ue.findStickerIndex(ue.stickers[ue.TAB_FAVORITE_STICKERS],e)},findFavoriteSticker:function(e){return ue.findSticker(ue.stickers[ue.TAB_FAVORITE_STICKERS],e)},findRecentStickerIndex:function(e){return ue.findStickerIndex(ue.stickers[ue.TAB_RECENT_STICKERS],e)},findRecentSticker:function(e){return ue.findSticker(ue.stickers[ue.TAB_RECENT_STICKERS],e)},findPackSticker:function(e){if(ue.stickersById&&ue.stickersById.hasOwnProperty(e))return ue.stickersById[e].sticker},isStickersLoaded:function(){if(ue.stickers)for(let e in ue.stickers)if(ue.stickers.hasOwnProperty(e)&&e!==String(ue.TAB_RECENT_STICKERS))return!0;return!1},tabs:{favoriteTabContent:function(e,t){var i,o;let s=ue.TAB_FAVORITE_STICKERS,n="emoji_tab emoji_tab_img_cont emoji_tab_favorite emoji_tab_"+s;return cur.stickersTab===s&&(n+=" emoji_tab_sel"),ue.isStickersLoaded()?(0!==t&&0!==(null==(o=ue.stickers[s])||null==(i=o.stickers)?void 0:i.length)||(n+=" unshown"),'<a class="'+n+'" onmousedown="'+e+'" onclick="return cancelEvent(event)"><span class="emoji_tab_icon emoji_sprite emoji_tab_icon_favorite"></span></a>'):""}},favorite:{reminder:function(e){let t=(0,E.hasClass)(e,"on"),i=t?"favoriteRemindOff":"favoriteRemindOn";if(ue[i])return;let o={text:function(){return t?I.getLang("purchases_stickers_favorite_rm_tt"):I.getLang("purchases_stickers_favorite_add_tt")},black:1,hidedt:100,typeClass:"tt_black",noZIndex:!0,shift:[10,8]},s=(0,E.domClosest)("ui_scroll_container",e);o.appendEl=s;let n=(0,E.domClosest)("ui_scroll_overflow",e),r=(0,E.getXYRect)(e),c=(0,E.getXYRect)(n),a=r.top-c.top,l=(c.right,r.right,c.bottom-r.bottom),_=r.left-c.left,d=(c.width||c.right-c.left)/2;(!vk.rtl&&_>d||vk.rtl&&_<d)&&(o.needLeft=!0,o.shift[0]=9),o.forcetodown=a<ue.FAV_ICON_TT_MIN_HEIGHT,o.forcetoup=l<ue.FAV_ICON_TT_MIN_HEIGHT,(0,P.showTooltip)(e,o),ue[i]=!0,ajax.post("stickers.php",{act:"tt_favorite_off",tt_type:t?1:2})},markStickerAsFavorite:function(e){e[ue.STICKER_FIELD_IS_FAVORITE]=1},markStickerAsUnfavorite:function(e){e[ue.STICKER_FIELD_IS_FAVORITE]=0},addFavoriteSticker:function(e,t){var i;const o=null==(i=ue.stickers[ue.TAB_FAVORITE_STICKERS])?void 0:i.stickers,s=ue.findPackSticker(t);if(!o||!s)return;ue.favorite.markStickerAsFavorite(s),o.unshift(s),ue.favorite.increaseFavoritePackSize();const n=ue.findRecentSticker(t);n&&ue.favorite.markStickerAsFavorite(n),ls.set("recent_stickers",ue.stickers[ue.TAB_RECENT_STICKERS]);for(const[e,i]of Object.entries(ue.opts)){if(i.noStickers)continue;ue.favorite.changeRenderedPackViewsByStickerId(e,t,!0);const o=i.activePackViews.has(ue.TAB_FAVORITE_STICKERS);ue.resetStickerPackViews(e,!o),ue.favorite.showFavoriteTab(i.tt)}},deleteFavoriteSticker:function(e,t){const i=ue.stickers[ue.TAB_FAVORITE_STICKERS];if(!i)return;const o=ue.findFavoriteStickerIndex(t);if(-1===o)return;i.stickers.splice(o,1),ue.favorite.reduceFavoritePackSize();const s=ue.findRecentSticker(t);s&&ue.favorite.markStickerAsUnfavorite(s),ls.set("recent_stickers",ue.stickers[ue.TAB_RECENT_STICKERS]);const n=ue.findPackSticker(t);n&&ue.favorite.markStickerAsUnfavorite(n);for(const[e,o]of Object.entries(ue.opts))if(!o.noStickers){if(!i.stickers.length){ue.favorite.hideFavoriteTab(o.tt);const t=o.tt.querySelector(".emoji_favorite_stickers_cont");t&&t.parentElement.remove(),o.renderedPackViews.delete(ue.TAB_FAVORITE_STICKERS),ue.selectTab(e,ue.TAB_RECENT_STICKERS)}ue.favorite.changeRenderedPackViewsByStickerId(e,t,!1),ue.resetStickerPackViews(e,!o.activePackViews.has(ue.TAB_FAVORITE_STICKERS))}},reduceFavoritePackSize:function(){const e=window.emojiStickers.find((e=>e[0]===ue.TAB_FAVORITE_STICKERS));e&&e[ue.PACK_FIELD_COUNT]&&(e[ue.PACK_FIELD_COUNT]=e[ue.PACK_FIELD_COUNT]-1)},increaseFavoritePackSize:function(){const e=window.emojiStickers.find((e=>e[0]===ue.TAB_FAVORITE_STICKERS));e&&(e[ue.PACK_FIELD_COUNT]=e[ue.PACK_FIELD_COUNT]+1)},showFavoriteTab:function(e){const t=e.querySelector(`.emoji_tab_${ue.TAB_FAVORITE_STICKERS}`);t&&t.classList.remove("unshown")},hideFavoriteTab:function(e){const t=e.querySelector(`.emoji_tab_${ue.TAB_FAVORITE_STICKERS}`);t&&t.classList.add("unshown")},changeRenderedPackViewsByStickerId:function(e,t,i){const o=ue.opts[e],s=ue.findPackSticker(t);for(const[c,a]of o.renderedPackViews){const o=a.querySelector(`[data-sticker-id="${t}"]`);var n,r;if(i){if(o)o.classList.add("faved"),null==(n=o.querySelector(".emoji_sticker_item_fav"))||n.classList.add("on");else if(c===ue.TAB_FAVORITE_STICKERS){const t=ue.renderStickerView(e,c,s),i=a.querySelector("[data-sticker-id]");i?i.parentNode.insertBefore(t,i):a.appendChild(t)}}else if(o)if(c===ue.TAB_FAVORITE_STICKERS)o.parentNode.removeChild(o);else o.classList.remove("faved"),null==(r=o.querySelector(".emoji_sticker_item_fav"))||r.classList.remove("on")}}},updateEmojiCatTitle:function(e){let t=ue.opts[e];if(!t||!t.emojiScroll)return;let i,o,s,n=(0,E.ge)("emoji_block_"+e),r=(0,E.geByClass)("emoji_cat_title_helper",n),a=t.emojiScroll.data.scrollTop,l=(0,E.geByClass1)("emoji_cats_title_helper",t.tt);if(r.length){let e=r[0];i=ue.getSizeCached(e)[1]}for(let e=r.length-1;e>=0;e--)if(a>r[e].offsetTop-i){o=r[e],s=e;break}if(!o)return(0,c.debugLog)("title not found");let _=(0,S.intval)((0,E.attr)(o,"data-id"));if(t.curEmojiCatId!=_){t.curEmojiCatId=_;let e=[o],n=r[s-1];n&&((0,E.addClass)(n,"emoji_cat_title_fix"),(0,E.setStyle)(n.firstChild,"transform","translateY("+(o.offsetTop-n.offsetTop-i)+"px)"));let c=o.nextSibling;for(;c;)(0,E.hasClass)(c,"emoji_cat_title_fix")&&e.push(c),c=c.nextSibling;for(let t in e)e.hasOwnProperty(t)&&((0,E.removeClass)(e[t],"emoji_cat_title_fix"),(0,E.setStyle)(e[t].firstChild,"transform","translateY(0px)"));(0,E.val)(l,""),t.emojiTitleHelperIsSet=0}!t.emojiTitleHelperIsSet&&a>=o.offsetTop&&a>0?((0,E.val)(l,(0,E.val)(o)),t.emojiTitleHelperIsSet=1):t.emojiTitleHelperIsSet&&(a<o.offsetTop||0==a)&&((0,E.val)(l,""),t.emojiTitleHelperIsSet=0)},emojiWrapItem:function(e,t,i){let o,s=ue.cssEmoji[t];o=s?' title="'+s[1]+'"':"";let n="";return r.browser.mobile||(n=' onmouseover="return Emoji.emojiOver('+e+', this, true);"'),'<a class="emoji_smile_cont '+("2764"!=t&&i&&i<54?"emoji_smile_shadow":"")+'" '+o+" onmousedown=\"Emoji.addEmoji(Emoji.shownId, '"+t+'\', this); return cancelEvent(event);" onclick="return cancelEvent(event);" '+n+'><div class="emoji_bg"></div><div class="emoji_shadow"></div>'+ue.getEmojiHTML(t,!1,!1,!0)+"</a>"},reappendEmoji:function(e,t){let i=ue.opts[e];i&&i.rceCont&&(i.addMediaBtn?i.sendWrap.insertBefore(i.rceCont,i.addMediaBtn):i.sendWrap.appendChild(i.rceCont)),t&&(i.ttWrap?i.ttWrap.appendChild(t):i.emojiWrap?i.emojiWrap.appendChild(t):i.obj.appendChild(t),ue.hideTt(t))},ttCalcHeight:function(e,t,i){window.headH=window.headH||(0,E.ge)("page_header")&&ue.getSizeCached((0,E.ge)("page_header"))[1]||0;let o=(window.pageNode&&window.browser.mozilla?Math.min((0,E.getSize)(pageNode)[1],window.lastWindowHeight):window.lastWindowHeight)||(0,E.getScroll)()[3],s=window.scrollGetY?(0,m.scrollGetY)():(0,E.getScroll)()[1],n=(0,E.getXY)(t)[1],r=ue.getSizeCached(t)[1],c=(0,E.geByClass1)("emoji_list",i),a=ue.opts[e].emojiSmileHeigh,l=window.headH,_=ue.opts[e].emojiRowsCount;(0,E.isAncestor)(t,pageNode)||(l=0),(0,E.setStyle)(c,{height:_*a+8});let d,u=s+l,h=s+o,p=i,f=(0,E.getSize)(i)[1],k=0,g=0,w=0;for(;p!==document.body&&(p=(0,E.domClosestOverflowHidden)(p));){let e=(0,E.getXY)(p)[1];u=Math.max(u,e),h=Math.min(h,e+(0,E.getSize)(p)[1])}for(k=n-9-u,g=h-n-r-9,d=k<f&&g<f?k>=g:k>=f,ue.opts[e].forceUp&&(d=!0),w=d?k:g;w<f&&_>3;)_--,f-=a;ue.opts[e].emojiRowsCount=_,ue.opts[e].emojiSmileHeigh=a,(0,E.setStyle)(c,{height:_*a+8}),(0,E.toggleClass)(i,"tt_down",d),(0,E.toggleClass)(i,"tt_up",!d)},repositionEmoji:function(e,t,i){let o,s=ue.opts[e];if(!s)return;if(i.parentNode&&E.getXY&&E.getStyle&&E.setStyle&&E.geByClass&&(o=(0,E.geByClass1)("emoji_rpointer",i))){let e=parseInt((0,E.getStyle)(i,"width")),s=266,n=7,r=10,c=(0,E.getXY)(t)[0],a=parseInt((0,E.getStyle)(t,"width")),l=(0,E.getXY)(i.parentNode)[0];c+a/2<s+n+r?((0,E.setStyle)(i,"left",-e-l),(0,E.setStyle)(o,"left",c+a/2-2*r+"px")):((0,E.setStyle)(i,"left",""),(0,E.setStyle)(o,"left",""))}else(0,E.setStyle)(i,"left","");let n=(0,E.geByClass1)("emoji_list",i),r=(0,E.geByClass1)("emoji_smile_cont",n);if(ue.opts[e].emojiSmileHeigh=r&&ue.getSizeCached(r)[1]||26,ue.opts[e].emojiRowsCount=9,ue.ttCalcHeight(e,t,i),s.ttWrap){let e=(0,E.getSize)(s.ttWrap)[0]-((0,E.getXY)(s.emojiBtn)[0]-(0,E.getXY)(s.ttWrap)[0]);(0,E.setStyle)(i,"right",e-s.ttDiff+"px")}},emojiOver:function(e,t,i){if(r.browser.mobile||i&&ue.preventMouseOver)return!0;let o=ue.opts[e];(0,E.addClass)(t,"emoji_over"),o.emojiOvered&&o.emojiOvered!=t&&(0,E.removeClass)(o.emojiOvered,"emoji_over"),o.emojiOvered=t},updateEmojiCategories:function(e,t,i){e.data.scrollBottom-ue.BOTTOM_REST_FOR_ADD_EMOJI_CATEGORY<=0&&t.scrollStarted&&setTimeout((function(){ue.addNextEmojiCategoty(i),ue.updateEmojiCatTitle(i)}),0),ue.updateEmojiCatTitle(i)},calcStickerPackViews(e){const t=this.opts[e],i=new Map;let o=0,s=o;const{forceStickerPack:n,emojiScroll:r}=t;if(!window.emojiStickers)return;const c=[];for(const e of window.emojiStickers){const t=e[0];if(!this.stickers.hasOwnProperty(t))continue;const i=e[1],o=e[4]&&n===t,s=t===ue.TAB_VMOJI;if(!i&&!o)continue;const{stickers:r}=this.stickers[t];(r.length||s)&&c.push(e)}const a=[],l=[];for(const e of c){const t=e[0],i=e[9];t<0||i?a.push(e):l.push(e)}[...a,...l].forEach((e=>{const t=e[0],n=t===ue.TAB_VMOJI,{stickers:c}=this.stickers[t];let a=Math.ceil(c.length/ue.STICKERS_IN_RAW)*ue.STICKER_SIDE_SIZE;a+=ue.STICKER_PACK_HEADER_HEIGHT,n&&r&&(a+=r.data.viewportHeight);const l={id:t,top:o,bottom:o+a};i.set(t,l),o+=a,s+=a})),t.packViews=i,t.packViewsTotalHeight=s},renderStickerPackView(e,t){const i=this.opts[e],{id:o}=t,s=i.renderedPackViews.get(o);if(s)return s;const n=window.emojiStickers.find((([e])=>e===o));if(!n)return"";if(!ue.stickers.hasOwnProperty(o))return"";const{stickers:r,images:c}=ue.stickers[o],a=o===this.TAB_RECENT_STICKERS,l=o===this.TAB_FAVORITE_STICKERS,_=o===this.TAB_VMOJI;let d="";if(d+=ue.getStickerPackBlockHeaderHtml(e,n),a)d+=`<div class="emoji_recent_stickers_cont" id="emoji_recent_stickers_cont${e}">`;else if(l)d+=`<div class="emoji_favorite_stickers_cont" id="emoji_favorite_stickers_cont${e}">`;else if(_&&!vk.widget){const e=c[Y.colorScheme.isDarkScheme()?"dark":"light"]||Object.values(c)[0];d+=ue.getVmojiStubHtml(e)}for(const t of r)d+=this.renderStickerViewHtml(e,o,t);(a||l)&&(d+="</div>");const u=(0,E.se)(`\n     <div style="\n        position: absolute;\n        width: 100%;\n     ">${d}</div>\n  `);return i.renderedPackViews.set(o,u),u},getStickerPackBlockHeaderHtml:function(e,t){const i=t[0],o=t[8],s=t[9];let{title:n,base_id:r,can_gift:c}=ue.stickers[i],a="";if(a+=`\n    <div class="clear emoji_stickers_pack_header">\n      <div class="emoji_stickers_pack_header_main">\n        <div class="emoji_stickers_pack_title">${n}</div>`,r&&!vk.widget){let e="emoji_stickers_pack_settings";o&&(e+=" emoji_stickers_pack_settings--new"),a+=`<a class="${e}" href="javascript:void(0);" onclick="Emoji.showProductSettings(${r});" title="${I.getLang("purchases_stickers_select_style")}">${(0,F.getIcon20GearOutline)().icon}</a>`}if(s&&!vk.widget&&(a+=`\n      <a\n        class="emoji_stickers_pack_settings"\n        href="javascript:void(0);"\n        onclick="Vmoji.showAvatar(${vk.id}, '${s}', ${i});"\n        title="${I.getLang("purchases_stickers_keyboard_pack_setup")}"\n      >\n        ${(0,F.getIcon20GearOutline)().icon}\n      </a>\n    `),a+='\n    </div>\n    <div class="emoji_stickers_pack_header_aside">',c&&!vk.widget){a+=`\n      <div\n        class="emoji_stickers_pack_peer_info"\n        data-product-id="${i}"\n        ${r&&r!==i?"data-is-style":""}\n      ></div>\n      <a\n        class="emoji_stickers_pack_gift"\n        onclick="Emoji.giftStickerToCurrentPeer(${i}, event, { sticker_referrer: &quot;stickers_keyboard2&quot; });"\n      >\n        ${(0,$.getIcon20GiftOutline)().icon}\n      </a>`}return a+="\n    </div>\n  </div>",a},getVmojiStubHtml:function(e){return`\n    <div class="emoji_vmoji_stub">\n      <div class="emoji_vmoji_create_avatar">\n        <img class="emoji_vmoji_create_avatar__image" src="${e}" alt="" />\n        ${L.FlatButton.render({className:"emoji_vmoji_create_avatar__button",appearance:L.FlatButtonAppearance.TERTIARY,size:L.FlatButtonSize.M,children:I.getLang("vmoji_keyboard_create_avatar"),restAttrs:{onclick:"Emoji.createVmojiAvatar();"}}).outerHTML}\n      </div>\n    </div>\n  `},mountStickerPackView(e,t){const i=this.opts[e].tt.querySelector(`.emoji_scroll_stickers .${ue.STICKER_PACKS_CONTAINER_CLASS}`);if(!i)return;const o=this.renderStickerPackView(e,t);o.parentNode!==i&&i.appendChild(o);const{top:s,bottom:n}=t;o.style.cssText+=`height: ${n-s}px; top: ${s}px;`},showStickerPackView(e,t){const i=this.opts[e],{packViews:o,activePackViews:s}=i,n=o.get(t);n&&n!==s.get(t)&&(this.mountStickerPackView(e,n),s.set(n.id,n))},unmountStickerPackView(e,t){const i=this.opts[e].renderedPackViews.get(t);i&&i.parentNode&&(i.querySelectorAll(".sticker_animation").forEach((e=>{G.StickersAnimation.stopAnimation(e,!0)})),i.parentNode.removeChild(i))},hideStickerPackView(e,t){const i=this.opts[e];this.unmountStickerPackView(e,t),i.activePackViews.delete(t)},resetStickerPackViews(e,t=!1){const i=this.opts[e];ue.calcStickerPackViews(e);const o=document.querySelector(`.${ue.STICKER_PACKS_CONTAINER_CLASS}`);o&&(o.style.height=i.packViewsTotalHeight+"px");let s=0;if(t){const{packViews:e,activePackViews:t}=i;for(const{id:i,top:o}of e.values()){const e=t.get(i);e&&e.top!==o&&(s=o-e.top)}}ue.calcStickerPacksToShowHide(e),s?ue.updateStickerPackViews(e,(()=>{i.emojiScroll.scrollTop(i.emojiScroll.data.scrollTop+s)})):ue.updateStickerPackViews(e)},calcStickerPacksToShowHide:function(e){const t=this.opts[e];if(!t.emojiScroll)return;const{scrollTop:i,viewportHeight:o}=t.emojiScroll.data,{packViews:s,activePackViews:n}=t;t.packsToShow=new Set,t.packsToHide=new Set([...n.keys()]);for(const{id:e,top:n,bottom:r}of s.values())if(!(r<=i)){if(n>i+o)break;t.packsToShow.add(e),t.packsToHide.delete(e)}},hideStickerPacksViews:function(e){const t=this.opts[e],{packsToHide:i}=t;for(const t of i)this.hideStickerPackView(e,t)},showStickerPacksViews:function(e){const t=this.opts[e],{packsToShow:i}=t;for(const t of i)this.showStickerPackView(e,t)},updateStickerPackViews:function(e,t){ue.hideStickerPacksViews(e),ue.showStickerPacksViews(e),t&&t(e)},scrollToFirstShownPackTab:function(e){const t=this.opts[e].packsToShow.values().next().value;t&&this.scrollToTab(t,e)},scrollToStickerPackView:function(e,t,i){const o=this.opts[e],s=o.packViews.get(t);s&&o.emojiScroll.scrollTop(s.top,i?0:200)},emojiUIScroll:function(e,t){let i=ue.opts[e];(0,E.addClass)(t,"emoji_expanded"),ue.emojiLoadMore(e),i.emojiScroll?i.emojiScroll.update():(i.emojiScroll=new uiScroll((0,E.geByClass1)("emoji_list",t),{theme:"default emoji no_transition",shadows:!0,global:!0,noForceReFlow:!0,ondragstart:function(){i.scrolling=!0},ondragstop:function(){i.scrolling=!1,(0,O.isFunction)(i.afterScrollFn)&&i.afterScrollFn()},onscrollstart:function(){window.tooltips&&X.tooltips.destroyAll(),i.scrollStarted=!0},onupdate:function(t){i&&(i.curTab==ue.TAB_EMOJI?ue.updateEmojiCategories(t,i,e):(ue.calcStickerPacksToShowHide(e),ue.scrollToFirstShownPackTab(e),ue.updateStickerPackViews(e)))},onresize:({container:e,data:t})=>{e.style.setProperty("--scroll-viewport-height",t.viewportHeight+"px")}}),i.sharedTT&&(i.sharedTT.emojiScroll=i.emojiScroll)),i.emojiExpanded=!0},renderStickerViewHtml(e,t,i){const o=i[0],s=i[2],n=i[3],c=i[4],a=i[5]||"",l=this.getStickerReferrer(t,e);let _="";if(r.browser.msie&&!r.browser.msie_edge||!n)_=`<a\n      id="emoji_sticker_item${e}_${t}_${o}"\n      data-opt-id="${e}"\n      data-sticker-id="${o}"\n      data-pack-id="${t}"\n      data-src="${s}"\n      data-fav="${c}"\n      data-fav-hash="${a}"\n      class="emoji_sticker_item sticker_item_${o} ${c?"faved":""}"\n      onclick="Emoji.stickerClick(${e}, ${o}, ${t}, &quot;${l}&quot;);">\n      <img class="emoji_sticker_image" src="${s}" />\n    </a>`;else{const i=(0,O.rand)(1,1e5);_=`<a\n      id="emoji_sticker_item${e}_${t}_${o}"\n      data-opt-id="${e}"\n      data-sticker-id="${o}"\n      data-pack-id="${t}"\n      data-src="${s}"\n      data-animation-path="${n}"\n      data-uniq-id="${i}"\n      data-fav="${c}"\n      data-fav-hash="${a}"\n      class="emoji_sticker_item sticker_item_${o} ${c?"faved":""}"\n      onclick="Emoji.stickerClick(${e}, ${o}, ${t}, &quot;${l}&quot;);">\n      <div\n        data-uniq-id="${i}"\n        onmouseenter="StickersAnimation.loadAndPlaySticker(this, true);"\n        class="sticker_animation"\n        data-sticker-id="${o}"\n        data-animation-path="${n}">\n        <img class="sticker_img emoji_sticker_image" src="${s}" />\n      </div>\n    </a>`}return _},renderStickerView:(e,t,i)=>(0,E.se)(ue.renderStickerViewHtml(e,t,i)),emojiMove:function(e){let t=ue.shownId,i=ue.opts[t];if(ue.shown&&i&&i.emojiFocused&&i.openedByTabKey){let o=null;if(i.emojiOvered)switch(e.keyCode){case h.KEY.LEFT:o=ue.getEmojiEl(i.emojiOvered,"left"),(0,h.cancelEvent)(e);break;case h.KEY.RIGHT:o=ue.getEmojiEl(i.emojiOvered,"right"),(0,h.cancelEvent)(e);break;case h.KEY.UP:o=ue.getEmojiEl(i.emojiOvered,"up");break;case h.KEY.DOWN:o=ue.getEmojiEl(i.emojiOvered,"down");break;case h.KEY.ENTER:if(!ue.emojiEnter(t,e))return(0,h.cancelEvent)(e),!1;break;default:return!0}else o=ue.getFirstEmojiEl(t);if(o)return ue.preventMouseOver=!0,ue.emojiOver(t,o),ue.scrollToListEl(t,o),!1}return!0},scrollToListEl:function(e,t){let i=ue.opts[e];if(!i||!i.emojiScroll)return;let o=t.offsetTop,s=Math.max(o+30-i.emojiScroll.data.viewportHeight,Math.min(i.emojiScroll.data.scrollTop,o-30));i.emojiScroll.data.scrollTop!=s&&i.emojiScroll.scrollTop(s)},anim:function(e,t){clearInterval(cur._imAnim);let i=Math.floor(300/13),o=0,s=(0,E.domLC)(e),n=(0,E.domFC)(e),r=t?0:45,c=t?45:0,a=t?1:0,l=t?0:1;cur._imAnim=setInterval((function(){++o;let _=o>=i?c:r+1.95*o*(t?1:-1),d=_-45,u=o>=i?l:a+.043333333333333335*o*(t?-1:1),m=1-u;s.style.WebkitTransform=s.style.OTransform=s.style.transform="rotate("+_+"deg)",n.style.WebkitTransform=n.style.OTransform=n.style.transform="rotate("+d+"deg)",s.style.opacity=u,n.style.opacity=m,o>=i&&(clearInterval(cur._imAnim),(t?E.addClass:E.removeClass)(e,"emoji_smile_on"),s.style.WebkitTransform=s.style.OTransform=s.style.transform=n.style.WebkitTransform=n.style.OTransform=n.style.transform=s.style.opacity=n.style.opacity="")}),13)},tplSmile:function(e){return'<div class="emoji_smile_wrap _emoji_wrap"><div class="emoji_smile _emoji_btn" title="'+e+'" onmouseenter="return Emoji.show(this, event);" onmouseleave="return Emoji.hide(this, event);" onclick="return cancelEvent(event);"><div class="emoji_smile_icon"></div></div></div>'},emojiToHTML:f.emojiToHTML,emojiReplace:f.emojiReplace,emojiRegex:(0,n.emojiRegex)(),getCode:function(e){let t=!1;if("emoji_css"==e.className)t=e.getAttribute("emoji");else if(-1!=e.className.indexOf("emoji")){let i=e.src&&e.src.match(/\/([a-f0-9*]+)(_2x)?.png/);t=i?i[1]:e.getAttribute("emoji")}return t},showProductSettings(e){(0,D.previewStickerProduct)(e,{settings:!0})},updatePeerInfo(e,t=!1){const i=ue.opts[e];if("im"===cur.module&&cur.gid)return void this.renderPeerInfo(e,null);const o=this.getPeerId();(o!==i.currentPeerId||t)&&(i.currentPeerId=o,o?(i.tt.classList.add("emoji_tt_peer_info_loading"),this.getPeerInfo(o).then((t=>{i.tt.classList.remove("emoji_tt_peer_info_loading"),o===i.currentPeerId&&this.renderPeerInfo(e,t)}))):this.renderPeerInfo(e,null))},renderPeerInfo(e,t){const i=ue.opts[e];if(!t)return void i.tt.classList.add("emoji_tt_peer_info_unavailable");i.tt.classList.remove("emoji_tt_peer_info_unavailable");const o=t.product_ids.reduce(((e,t)=>(e[t]=1,e)),{});i.tt.querySelectorAll(".emoji_stickers_pack_peer_info").forEach((e=>{const i=e.dataset.productId;if(o.hasOwnProperty(i)){const i=void 0!==e.dataset.isStyle;e.innerHTML=`\n        <img\n          class="emoji_stickers_pack_peer_info__photo"\n          src="${t.photo}"\n          width="16"\n          height="16"\n          loading="lazy"\n        />\n        <div\n          class="emoji_stickers_pack_peer_info__purchased_icon"\n        >\n          ${(0,z.getIcon12CheckCircleFill)().icon}\n        </div>\n        <div\n          class="emoji_stickers_pack_peer_info__tooltip_overlay"\n          data-tooltip-text="${i?t.tooltip_style:t.tooltip_pack}"\n          onmouseover="Emoji.showPeerInfoTooltip(event);"\n        ></div>\n      `}else e.innerHTML=""}))},showPeerInfoTooltip(e){(0,P.showTooltip)(e.target,{text:e.target.dataset.tooltipText,center:!0,black:!0,shift:[4,8],appendEl:e.target.closest(".emoji_block_cont")})},getTabCont:function(e){ue.calcStickerPackViews(e);const t=ue.opts[e];return`<div class="${ue.STICKER_PACKS_CONTAINER_CLASS}" style="height: ${t.packViewsTotalHeight}px;"></div>`},updateStickersCont:function(e){let t=ue.opts[e],i=ue.getTabCont(e);(0,E.geByClass1)("emoji_scroll_stickers",t.tt).innerHTML=i},hintsStickerItemAnimation:function(){return'<a id="emoji_sticker_item%optId%_%selId%_%stickerId%" data-pack-id="%selId%" data-sticker-id="%stickerId%" class="emoji_sticker_item %class%" onclick="%onclick%" onmouseover="Emoji.stickerHintOver(this)" onmouseout="Emoji.stickerHintOut(this)" onmouseenter="StickersAnimation.loadAndPlaySticker(this);" data-animation-path="%animationUrl%" data-uniq-id="%uniqId%" data-sticker-id="%stickerId%"><img class="emoji_sticker_image sticker_img" src="%stickerUrl%" /></a>'},hintsStickerItem:function(){return'<a id="emoji_sticker_item%optId%_%selId%_%stickerId%" data-pack-id="%selId%" data-sticker-id="%stickerId%" class="emoji_sticker_item %class%" onclick="%onclick%" onmouseover="Emoji.stickerHintOver(this)" onmouseout="Emoji.stickerHintOut(this)"><img class="emoji_sticker_image" src="%stickerUrl%" /></a>'},tabSwitch:function(e,t,i){if(null==e)return;let o=ue.opts[i],s=o.tt;"number"==typeof e&&(e=(0,E.geByClass1)("emoji_tab_"+e,s)),o.curEmojiCatId=null,t==ue.TAB_EMOJI?ue.showEmojiTab(i,t,e):ue.showStickersTab(i,t,e)},showEmojiTab:function(e,t,i){let o=ue.opts[e],s=o.tt,n=(0,E.geByClass1)("emoji_scroll_smiles",s),r=(0,E.geByClass1)("emoji_scroll_stickers",s),c=(0,E.geByClass1)("emoji_cats_title_helper",s);(0,E.hide)(r),(0,E.show)(n),(0,E.show)(c),o.emojiInited||((0,E.val)(n,ue.getInitEmojiContent(e)),o.emojiInited=!0),o.imagesLoader&&o.imagesLoader.processLoad(),o.emojiOvered&&o.curTab===ue.TAB_EMOJI&&ue.emojiOver(e,ue.getFirstEmojiEl(e)),o.curTab!=ue.TAB_EMOJI&&o.emojiScroll&&o.emojiScroll.scrollTop(0),ue.updateRecentEmoji(e),ue.updateEmojiCatTitle(e),ue.selectTab(e,t,i)},showStickersTab:function(e,t,i){let o=ue.opts[e],s=o.tt,n=(0,E.geByClass1)("emoji_scroll_smiles",s),r=(0,E.geByClass1)("emoji_scroll_stickers",s),c=(0,E.geByClass1)("emoji_cats_title_helper",s);if((0,E.hide)(n),(0,E.show)(r),(0,E.hide)(c),ue.shouldLoadStickers(t))ue.onStickersLoad=function(){var i;ue.updateTabsOpt(e,void 0,!1),(null==(i=ue.stickers)?void 0:i[t])||(t=ue.TAB_RECENT_STICKERS),ue.tabSwitch(t,t,e)},ue.stickersLoadingProgress(e,t,i),o.stickersInited=!1,o.curTab=null,ue.emojiLoadMore(e);else{const s=window.emojiStickers.find((e=>e[0]===t));s&&s[7]&&(0,x.updateUserProductState)(t,B.UserProductStateKey.IsNew,0,!1).then((()=>{Array.from(document.querySelectorAll(`.emoji_tab_${t}`)).forEach((e=>{e.classList.remove("emoji_tab_is_new")}))})),o.stickersInited||(ue.updateStickersCont(e),o.stickersInited=!0),ue.calcStickerPackViews(e),ue.calcStickerPacksToShowHide(e),ue.scrollToStickerPackView(e,t,!0),ue.updateStickerPackViews(e),ue.selectTab(e,t,i)}o.afterLoad&&(o.afterLoad=0),o.stickersInited&&ue.updatePeerInfo(e)},shouldLoadStickers:function(e){let t=ue.stickers&&(0,S.clone)(ue.stickers);return t&&delete t[ue.TAB_RECENT_STICKERS],!window.emojiStickers||!t||(0,O.isEmpty)(t)||!t[e]&&e!=ue.TAB_RECENT_STICKERS},getFirstEmojiEl:function(e){let t=ue.opts[e],i=(0,E.geByClass1)("emoji_scroll_smiles",t.tt).firstChild;for(;i;){if((0,E.hasClass)(i,"emoji_smiles_row"))return i.firstChild;i=i.nextSibling}return null},getEmojiEl:function(e,t){let i,o=0,s=e.parentNode,n=0,r=s.firstChild;for(;r&&(n++,r!==e);)r=r.nextSibling;for(;e&&!i;){if("left"==t||"right"==t)i="left"==t?e.previousSibling:e.nextSibling,i||("left"==t?(t="up",n=10):(t="down",n=1));else{if("up"!=t&&"down"!=t)break;{let e=s;for(;e&&(e="up"==t?e.previousSibling:e.nextSibling,e&&!(0,E.hasClass)(e,"emoji_smiles_row")););if(!e)break;if(n&&e){let t=0,o=e.firstChild;for(;o&&t<n;){if(t++,t>=n){i=o;break}o=o.nextSibling}}if(i||!e)break;i="up"==t||n&&"down"==t?e.lastChild:e.firstChild}}if(o++,o>20){(0,c.debugLog)("ERR!!");break}}return i},addRecentSticker(e){const t=this.stickers[this.TAB_RECENT_STICKERS];if(!t)return;const i=this.findPackSticker(e);if(!i)return;const o=t.stickers.findIndex((([t])=>String(t)===String(e)));-1!==o&&t.stickers.splice(o,1),t.stickers.unshift(i);for(const[t,o]of Object.entries(this.opts)){if(o.noStickers)continue;const s=o.renderedPackViews.get(this.TAB_RECENT_STICKERS);if(s){const o=s.querySelector(`[data-sticker-id="${e}"]`)||this.renderStickerView(t,this.TAB_RECENT_STICKERS,i),n=s.querySelector("[data-sticker-id]");n&&n!==o&&n.parentNode.insertBefore(o,n)}if(o.tt){const e=o.tt.querySelector(`.emoji_tab_${this.TAB_RECENT_STICKERS}.unshown`);e&&e.classList.remove("unshown")}ue.resetStickerPackViews(t,!o.activePackViews.has(ue.TAB_RECENT_STICKERS))}ls.set("recent_stickers",this.stickers[this.TAB_RECENT_STICKERS])},stickerUGCClick:(e,t,i)=>{var o,s;const n=ue.opts[e];Date.now()-n.ttShowT<ue.CLICK_DELAY||n.preventDoubleClick&&Date.now()-n.preventDoubleClick<ue.CLICK_DELAY||(n.preventDoubleClick=Date.now(),null==(o=(s=n).onUGCStickerSend)||o.call(s,t,i),ue.hideNewPicker())},stickerClick:function(e,t,i,o,s){const n=ue.opts[e];if(!(Date.now()-n.ttShowT<ue.CLICK_DELAY||n.preventDoubleClick&&Date.now()-n.preventDoubleClick<ue.CLICK_DELAY)){if(n.preventDoubleClick=Date.now(),!(0,ne.isNewStickerPicker)()&&!s){let e=!0;var r,c;if(i)e=null==(c=window.emojiStickers)||null==(r=c.find((([e])=>e===i)))?void 0:r[1];e&&ue.addRecentSticker(t)}n.onStickerSend&&n.onStickerSend(t,o,"animation"),(0,a.statlogsValueEvent)("stickers_usage",n.ref,t,o),(0,ne.isNewStickerPicker)()?ue.hideNewPicker():ue.ttHide(e,!1,!1,!0),n.recentSticker=t}},stickerOver:function(e,t){let i={act:"a_stickers_hover",sticker_id:e,from:cur.module};if((0,O.isObject)(t.tt)&&"IMG"===t.firstChild.nodeName)return t.tt.show();ajax.post("al_im.php",i,{onDone:function(e,i){let o=(cur.tooltips||[]).length,s=["subscribe_post_tt","sticker_extra_tt","sticker_extra_tt"+o,e.image?"":"tt_text_only"];if(s=s.join(" "),!e.show)return;let n={index:o,className:s,content:i,shift:function(){return[-138,0,-200]},hasover:1,slideX:15,showsp:150,cache:1,forcetodown:!0,no_shadow:!0,dir:"left",onShowStart:function(e){let t=e.container,i=(0,E.getSize)(e.container)[1];if(i>=225)return;let o=(0,S.intval)((225-i)/2)+10,s=(0,S.intval)((0,E.getStyle)(t,"top",!0))+o;(0,E.setStyle)(t,"top",s)}};(0,E.gpeByClass)("_im_peer_history_w",t)&&(n.appendParentCls="_im_peer_history_w"),(0,P.showTooltip)(t,n)}})},selectPeer:function(e){if(void 0!==e){let t=ue.opts[e];if(t.peer)return t.peer}let t=cur.peer||(cur.mbTo?cur.mbTo[0]:"");if(-3==t&&cur.wdd.imw_dd){let e=0;for(let i in cur.wdd.imw_dd.selected)cur.wdd.imw_dd.selected.hasOwnProperty(i)&&(t=cur.wdd.imw_dd.selected[i][0],e+=1);e>1&&(t="")}return t},showMyStickers:function(){cur.boxMyStickers=(0,y.showBox)("al_im.php",{act:"stickers_my"},{stat:["im.css",window.jsc("web/imn.js"),window.jsc("web/sorter.js")]})},getSelectedStickersStoreTabId(){const e=document.querySelector("#im_stickers_tabs");if(e){const t=e.querySelector(".ui_tab_sel");if(t){const[,e]=t.parentNode.id.match(/^tbt_stickers_(.*)$/)||[];return e}}},showStickersStore:function(e,t,i={},s={}){const n=ue.selectPeer(!1!==e?e:void 0),r=ue.opts[e];i=(0,o._)({},i,{act:"stickers_store",peer:n,box:1}),t&&(i.ref=t),cur.boxStickersStore=(0,y.showBox)("al_im.php",i,{stat:["im.css",window.jsc("web/imn.js"),"page_help.css",window.jsc("web/sorter.js")],params:{onDestroy(){r&&r.onStoreHide&&r.onStoreHide(),cur.boxStickersStore=null}},onDone(){void 0!==s.scrollTop&&((0,W.getBoxLayerWrap)().scrollTop=s.scrollTop)}}),cur.boxStickersStore.reload=()=>{if(!cur.boxStickersStore)return;const i=ue.getSelectedStickersStoreTabId(),o=(0,W.getBoxLayerWrap)().scrollTop;cur.boxStickersStore.hide(),ue.showStickersStore(e,t,{tab:i},{scrollTop:o})},ue.hideStickersStoreNotification(),(0,S.each)((0,E.geByClass)("emoji_shop_icon_badge"),(function(e,t){(0,E.re)(t)})),ue.hasNewStickers=!1},previewSticker:function(e,t,i,o){if(e===_e.RANDOM_PRODUCT_ID)return(0,w.partConfigEnabled)("stickers_random_pack")&&(0,oe.openStickersRandomSelectorView)(),(0,h.cancelEvent)(o),!1;if(de()){const t=(i=i||{}).peerId||ue.selectPeer(),s={recipientIds:t?[t]:[],preview_ref:i.sticker_referrer||"store"};return i.stickerId?(0,D.previewSticker)(i.stickerId,s):(0,w.partConfigEnabled)("new_stickers_modal")?(0,ie.openStickersLayerView)({product_id:e,sticker_id:i.stickerId,recipient_ids:i.giftTo,vmoji_character_id:i.characterId,reference:i.sticker_referrer||"store"}):(0,D.previewStickerProduct)(e,s),(0,h.cancelEvent)(o),!1}if(i=i||{},o&&(0,h.checkEvent)(o))return!0;let s={act:"sticker_preview",pack_id:e},n=ue.selectPeer();if(i.peer?s.peer=i.peer:n&&(s.peer=n),i.preview&&(s.preview=1),i.gift&&(s.gift=1),i.giftTo&&(s.gift_to=i.giftTo),i.stickerId&&(s.sticker_id=i.stickerId),s.sticker_referrer=i.sticker_referrer||"store",i.name){let e=nav.objLoc[0].split("/");"stickers"==e[0]&&e[1]!=i.name&&nav.setLoc({0:"stickers/"+i.name})}return cur.boxStickersPreview=(0,y.showBox)("al_im.php",s,{stat:["im.css",window.jsc("web/imn.js")],onFail:function(t){if(window.cur.emojiStickersDisabled||(window.cur.emojiStickersDisabled={}),e&&(window.cur.emojiStickersDisabled[e]=!0),t)return!0}}),(0,h.cancelEvent)(o),!1},getStickerPack(e){if(window.emojiStickers){const t=window.emojiStickers.find((t=>t[ue.PACK_FIELD_ID]===e))||null;return Promise.resolve(t)}return new Promise(((t,i)=>{ajax.post("al_im.php",{act:"a_stickers_list"},{onDone(i){window.emojiStickers=i,t(i?ue.getStickerPack(e):null)},onFail:()=>(i(),!0)})}))},getClosestTextInput(e){if(e.getAttribute("contenteditable"))return e;const t=e.closest(".js-im-page, .fc_tab, .mv_chat");return t?t.matches(".fc_tab")?t.querySelector(".fc_editable"):t.matches(".js-im-page")?document.querySelector("._im_text"):t.matches(".mv_chat")?t.querySelector(".mv_chat_reply_input"):null:null},showPackInKeyboard(e,t){const i=ue.getClosestTextInput(t);if(!i||void 0===i.emojiId)return;const o=ue.opts[i.emojiId];(0,ne.isNewStickerPicker)()||ue.ttClick(i.emojiId,i.parentNode.parentNode.querySelector("._emoji_btn"),!1,!0);const s=o.tt.querySelector(`.emoji_tab_${e}`),n=void 0!==Object.keys(ue.stickers||{}).find((e=>e!==ue.TAB_RECENT_STICKERS));n?ue.tabSwitch(s,e,i.emojiId):(ue.onStickersLoad=()=>ue.tabSwitch(e,e,i.emojiId),ue.stickersLoadingProgress(i.emojiId,e,s))},clickSticker:function(e,t,i,o={}){var s;if(null==(s=window.cur.emojiStickersDisabled)?void 0:s[e])return!0;const{vmoji:n}=o;if(n&&(0,w.partConfigEnabled)("vmoji")&&!window.vk.widget){const{avatarOwnerId:i,avatarCharacterId:o}=n;if(!i)return window.vk.widget||ue.previewSticker(e,!1,{sticker_referrer:"message"}),!1;if(i===window.vk.id&&t){var r;const s=(0,ne.isNewStickerPicker)()?null==(r=window.StickerPickerViewer)?void 0:r.api.getPack({productId:e}):ue.getStickerPack(e);Promise.all([s,ue.getVmojiAvatar()]).then((([s,n])=>{var r,c,a;const l=(0,ne.isNewStickerPicker)()?null==(c=s)||null==(r=c.product)?void 0:r.active:Boolean(null==(a=s)?void 0:a[ue.PACK_FIELD_IS_ACTIVE]);var _;n&&n.character_id===o&&l?(0,ne.isNewStickerPicker)()?null==(_=window.StickerPickerViewer)||_.showPack(e,t):ue.showPackInKeyboard(e,t):ue.showVmojiAvatar(i,o,e)}))}else ue.showVmojiAvatar(i,o,e);return!1}if(t)return(0,se.showPackByClickOnSticker)(e,t),!1;window.vk.widget||ue.previewSticker(e,!1,{sticker_referrer:"message"})},stickersLoadingProgress:function(e,t,i){let o=ue.opts[e];(0,E.removeClass)((0,E.geByClass1)("emoji_tab_sel",o.tt),"emoji_tab_sel"),(0,E.addClass)(i,"emoji_tab_sel"),(0,E.geByClass1)("emoji_scroll_stickers",o.tt).innerHTML='<div class="emoji_scroll_progress">'+(0,E.rs)(vk.pr_tpl,{id:"",cls:"pr_big"})+"</div>"},buyStickers:function(e,t,i,o,s){if(i){if(L.FlatButton.getAppearance(i)===L.FlatButtonAppearance.SECONDARY)return!0}L.FlatButton.lock(i);return H.Cart.create([e]).order({hash:o,ref:s}).then((t=>{if(L.FlatButton.unlock(i),t&&!t.error){(0,d.showDoneBox)((0,W.getPurchaseResult)(t));try{vk.widget&&window.Rpc&&window.Rpc.callMethod("proxy","updateStickers")}catch(e){}"video_live"===s&&window.Videoview&&window.Videoview.onStickersPurchased(e),(0,w.partConfigEnabled)("stickers_catalog_reload_after_buy")&&(cur.boxStickersStore?cur.boxStickersStore.reload():nav.reload({params:{tab:ue.getSelectedStickersStoreTabId()},preventScroll:!0}))}})),(0,h.cancelEvent)(t)},stickerAct:function(e,t,i,o,s){const n=L.FlatButton.getAppearance(e)===L.FlatButtonAppearance.SECONDARY;if(s&&n)return!0;let r=(s?n:(0,E.hasClass)(e,"_im_sticker_activated"))?1:0,c=cur.tabbedStickersBox;if(c)for(let e in c.tbUpdate)c.tbUpdate.hasOwnProperty(e)&&(c.tbUpdate[e]=1);return ajax.post("/al_im.php",{act:"a_stickers_switch",pack_id:t,hash:i,state:r,from_btn:s?1:0},{onDone:function(i,o,n,c){s||(L.FlatButton.setLabel(e,i),e.onmouseover="",(0,E.setStyle)(e,{width:"auto"}),(0,E.toggleClass)(e,"_im_sticker_activated",!r)),(0,S.each)((0,E.geByClass)("_sticker_btn_"+t),(function(){L.FlatButton.setLabel(this,c),this.onmouseover="";const e=r?L.FlatButtonAppearance.PRIMARY:L.FlatButtonAppearance.SECONDARY;L.FlatButton.setAppearance(this,e)})),ue.updateTabs(o,n,!0);let a=e.parentNode.parentNode;if(!s){if(cur.stickersSorter.destroy(),r){(0,E.show)("im_stickers_deact");let e=(0,E.ge)("im_stickers_deact_wrap");e.firstChild?e.insertBefore(a,e.firstChild):e.appendChild(a),(0,E.setStyle)(a,{cursor:"default"})}else{(0,E.geByTag1)("div","im_stickers_my_wrap").appendChild(a),(0,E.ge)("im_stickers_deact_wrap").childNodes.length||(0,E.hide)("im_stickers_deact")}cur.stickersSorterInit()}},showProgress:()=>L.FlatButton.lock(e),hideProgress:()=>L.FlatButton.unlock(e)}),(0,h.cancelEvent)(o)},getTabsCode:function(e,t){let i=[];e&&i.push.apply(i,e),i.length>1&&(ue.hasNewStickers=!1);let o=ue.opts[t].forceStickerPack,n="",r="",c="";for(const e of i){const i=e[0],a=e[1],l=e[3],_=e[4]&&i===o,d=e[5];if(!a&&!l&&!_)continue;const u=e[6],m=e[7],h=e[8],p=e[9];let f;if(a||_?(i>0&&-1===ue.stickerPacksToLoad.indexOf(i)&&ue.stickerPacksToLoad.push(i),f="Emoji.tabSwitch(this, "+i+", "+t+"); return cancelEvent(event);"):f="Emoji.previewSticker("+i+", false, {sticker_referrer: 'keyboard'}); return cancelEvent(event);",e[2]&&(ue.hasNewStickers=e[2]),i===ue.TAB_VMOJI){n+=`\n        <a class="${(0,s.classNames)(`emoji_tab emoji_tab_${i} emoji_tab--vmoji-stub`,{emoji_tab_sel:cur.stickersTab==i})}" onmousedown="${f}" onclick="return cancelEvent(event);">\n          ${(0,q.getIcon24VmojiOutline)().icon}\n        </a>\n      `}else if(i===ue.TAB_RECENT_STICKERS){let e="emoji_tab emoji_tab_img_cont emoji_tab_recent emoji_tab_"+i;cur.stickersTab==i&&(e+=" emoji_tab_sel"),n+='<a class="'+e+'" onmousedown="'+f+'" onclick="return cancelEvent(event);"><span class="emoji_tab_icon emoji_sprite emoji_tab_icon_recent"></span></a>'}else if(i===ue.TAB_FAVORITE_STICKERS)n+=ue.tabs.favoriteTabContent(f,u);else if(i){let e="emoji_tab emoji_tab_img_cont emoji_tab_"+i;(m||h)&&(e+=" emoji_tab_is_new"),cur.stickersTab==i&&(e+=" emoji_tab_sel"),a||_||(e+=" emoji_tab_promo"),p&&(e+=" emoji_tab--vmoji");let t='<a class="'+e+'" onmousedown="'+f+'" onclick="return cancelEvent(event);"><img width="22" height="22" src="'+d+'" class="emoji_tab_img" /></a>';p?c+=t:_?r=t+r:r+=t}else{let e="emoji_tab emoji_tab_"+i;cur.stickersTab==i&&(e+=" emoji_tab_sel"),a||(e+=" emoji_tab_promo"),n+='<a class="'+e+'" onmousedown="'+f+'" onclick="return cancelEvent(event);"><div class="emoji_tab_icon emoji_sprite emoji_tab_icon_'+i+'"></div></a>'}}return c&&(c=`<span class="emoji_tabs_group emoji_tabs_group--vmoji">${c}</span>`),n+c+r},updateTabsOpt:function(e,t,i=!0){let o=ue.opts[e];if(o.noStickers)return;let s=(0,E.ge)("emoji_tabs_cont_"+e);s&&(s.innerHTML=ue.getTabsCode(window.emojiStickers,e)),i&&ue.throwTabsScroll(e),ue.checkNewStickers(o),void 0!==typeof t&&(o.stickersInited=!!t)},updateTabs:function(e,t,i){e&&i&&window.Notifier&&Notifier.lcSend("emoji",{act:"updateTabs",newStickers:e,keywords:t});let o=0;void 0===t?((0,ee.initStickersKeywords)(),window.stickersKeywordsData||(o=1)):(window.stickersKeywordsData=t,(0,ee.setStickersKeywords)(window.stickersKeywordsData,i)),void 0===e?window.emojiStickers&&window.stickersKeywordsData||(0,Q.cachedStickersKeywordsTime)().then((e=>{ajax.post("al_im.php",{act:"a_stickers_list",need_keywords:o,cache_time:e},{onDone:ue.updateTabs})})):window.emojiStickers=e;for(let e in ue.opts)ue.opts.hasOwnProperty(e)&&ue.updateTabsOpt(e,!1);let s=ue.stickers&&(0,S.clone)(ue.stickers);s&&delete s[ue.TAB_RECENT_STICKERS],ue.onStickersLoad&&window.emojiStickers&&!(0,O.isEmpty)(s)&&(ue.onStickersLoad(),ue.onStickersLoad=!1)},showStickersStoreNotification(){Array.from(document.querySelectorAll(".emoji_smile")).filter((e=>!e.querySelector(".emoji_smile_icon_promo"))).forEach((e=>{e.appendChild((0,E.ce)("div",{className:"emoji_smile_icon_promo"}))})),ae.leftMenu.setBadge(le.PAGE_ID_STICKERS,"prominent")},hideStickersStoreNotification(){document.querySelectorAll(".emoji_smile_icon_promo").forEach((e=>{e.parentNode.removeChild(e)})),ae.leftMenu.removeBadge(le.PAGE_ID_STICKERS)},checkNewStickers:function(e){let t=e.txt;if(!e.noStickers&&!e.noStickersStore&&window.emojiStickers&&t&&t.getAttribute("contenteditable")){for(let e in window.emojiStickers)if(window.emojiStickers.hasOwnProperty(e)&&window.emojiStickers[e][2]){ue.hasNewStickers=window.emojiStickers[e][2];break}ue.hasNewStickers<0&&!ue.noNewStickers&&setTimeout((()=>ue.showStickersStoreNotification()),(0,E.hasClass)(t,"fc_editable")?200:0)}},giftStickerToCurrentPeer(e,t,i){const o=this.getPeerId();M.Ranges.isUserId(o)||M.Ranges.isChatOrChannelPeer(o)?this.giftSticker(e,o,t,i):this.giftSticker(e,"",t,i)},giftSticker:function(e,t,i,o){if(de())return(0,N.giftStickerProducts)([e],t?String(t).split(",").map((e=>Number(e))):[],{ref:o.sticker_referrer||"store",gift_ref:o.ref}),(0,h.cancelEvent)(i);let s={act:"stickers_gift_box",pack_id:e,peers:t,ref:(o=o||{}).ref};return o.from&&(s.from=o.from),s.sticker_referrer=o.sticker_referrer||"store",boxLayerWrap.scrollTop=0,(0,y.showBox)("/al_im.php",s,{stat:[window.jsc("web/wide_dd.js"),"wide_dd.css","notifier.css",window.jsc("web/notifier.js")]}),(0,h.cancelEvent)(i)},toggleStickers:function(e,t){let i=ue.opts[e];i&&(i.noStickers=t,i.tt&&((0,E.toggleClass)(i.tt,"emoji_no_tabs",t),i.curTab&&ue.tabSwitch(0,0,e)))},getSizeCached:function(e){return(e=(0,E.ge)(e))?(void 0!==e[ue.CACHED_WIDTH_PROP]&&void 0!==e[ue.CACHED_HEIGHT_PROP]||(e[ue.CACHED_WIDTH_PROP]=e.offsetWidth,e[ue.CACHED_HEIGHT_PROP]=e.offsetHeight),[e[ue.CACHED_WIDTH_PROP],e[ue.CACHED_HEIGHT_PROP]]):[0,0]},clearSizeCached:function(e){(e=(0,E.ge)(e))&&(e[ue.CACHED_WIDTH_PROP]=void 0,e[ue.CACHED_HEIGHT_PROP]=void 0)},getStickerReferrer:function(e,t=null){const i=ue.opts[t];return i&&"stories"===i.ref?ue.STICKER_REFERRERS.STORY_KEYBOARD:e===ue.TAB_RECENT_STICKERS?ue.STICKER_REFERRERS.RECENT:e===ue.TAB_FAVORITE_STICKERS?ue.STICKER_REFERRERS.FAVORITE:e===ue.TAB_NEW_CONVO_STICKERS?ue.STICKER_REFERRERS.NEW_CONVO:ue.STICKER_REFERRERS.KEYBOARD},render:{stickerHintRs:function(e,t,i){let o=t,s="";const n=o<0&&!(0,w.partConfigEnabled)("stickers_can_send_unpurchased_stickers");if(o<0)s=window.promotedStickerUrls&&window.promotedStickerUrls[-o];else if(i)s=i[2];else{const e=(0,K.getSticker)(o);e&&(s=(0,A.getStickerImageUrl)(e,64,64))}let c=i?i[3]:"",a={optId:e,selId:0,stickerId:o,stickerUrl:s,class:n?"promo":"",onclick:"Emoji.stickerHintClick("+e+", "+o+", '"+s+"', this)"},l="";return(!r.browser.msie||r.browser.msie_edge)&&c&&s?(l=ue.hintsStickerItemAnimation(),a.animationUrl=c,a.class+=" sticker_animation"):s&&(l=ue.hintsStickerItem()),(0,E.rs)(l,a)}},resetStickersCache(){ue.stickers={},ue.resetVmojiAvatarCache(),cur.boxMyStickers&&(cur.boxMyStickers.isVisible()||cur.boxMyStickers.setOptions({onShow(){cur.boxMyStickers.hide(),ue.showMyStickers()}}))},_vmojiAvatarCache:void 0,showVmojiAvatar(e,t,i){const o=(0,d.showBoxLoader)();window.stManager.add(window.jsc("web/vmoji.js")).then((()=>{(0,d.isBoxLoadingCancelled)(o)||((0,d.hideBoxLoader)(),window.Vmoji.showAvatar(e,t,i))}))},getVmojiAvatar:()=>void 0!==ue._vmojiAvatarCache?Promise.resolve(ue._vmojiAvatarCache):(0,J.vmojiGetAvatar)().then((({avatar:e=null})=>(ue._vmojiAvatarCache=e,e))),resetVmojiAvatarCache(){ue._vmojiAvatarCache=void 0},createVmojiAvatar(){const e=(0,d.showBoxLoader)();window.stManager.add(window.jsc("web/vmoji.js")).then((()=>{(0,d.isBoxLoadingCancelled)(e)||((0,d.hideBoxLoader)(),window.Vmoji.createAvatar())}))},__eof:1}},943938:(e,t,i)=>{i.d(t,{getCaretBoundingRect:()=>o});const o=function(e){const t=e.getBoundingClientRect();let i=null,o=null;if(t.top===t.bottom)return{left:0,top:0,bottom:0};if(document.selection)o=document.selection.createRange(),i=o.getClientRects()||[],i.length||(o.text="_",o.moveStart("character",-1),i=o.getClientRects(),o.text=""),i=i[i.length-1];else if(window.getSelection){const e=getSelection();if(e.anchorNode){if(o=e.getRangeAt(0),o.collapsed){const e=o.startOffset;o.setStart(o.startContainer,0),i=o.getClientRects(),o.setStart(o.startContainer,e)}i=i&&i.length?i[i.length-1]:{right:t.left,top:t.top,bottom:t.top}}else i={right:0,top:0,bottom:0}}return{left:i.right-t.left,top:i.top-t.top,bottom:i.bottom-t.top}}},286283:(e,t,i)=>{i.d(t,{EMOJI_SECTIONS_CODES:()=>n});var o=i(472207);const s={1:["😀","😃","😄","😁","😅","😆","😂","🤣","😉","😊","☺","🙂","🙃","😇","😗","😙","😚","😘","😍","🥰","🤩","🤗","😋","😜","🤪","😛","😝","🤑","🤭","🤐","🤫","😶","🤔","🤨","🧐","😐","😑","🙄","😬","🤥","😏","😌","🤤","😴","🤓","😎","🥳","🤠","😒","😔","😪","😕","😟","🙁","☹","😮","😯","😲","😳","🥺","😦","😧","😨","😰","😥","😢","😭","😱","😖","😣","😞","😓","😩","😫","😷","🤒","🤕","🤢","🤮","🤧","🥶","🥵","🥴","😵","🤯","😤","😠","😡","🤬","😈","👿","💀","☠","💩","🤡","👹","👺","👻","👽","👾","🤖","😺","😸","😹","😻","😼","😽","🙀","😿","😾","🙈","🙉","🙊","🦠"],2:["🐵","🐒","🦍","🐶","🐕","🐩","🐺","🦊","🦝","🐱","🐈","🦁","🐯","🐅","🐆","🐴","🐎","🦄","🦓","🦌","🐮","🐂","🐃","🐄","🐷","🐽","🐖","🐗","🐏","🐑","🐐","🐪","🐫","🦙","🦒","🐘","🦏","🦛","🐭","🐁","🐀","🐹","🐰","🐇","🐿","🦔","🦇","🐻","🐨","🐼","🦘","🦡","🐾","🦃","🐔","🐓","🐣","🐤","🐥","🐦","🐧","🕊","🦅","🦆","🦢","🦉","🦚","🦜","🐸","🐊","🐢","🦎","🐍","🐲","🐉","🦕","🦖","🐳","🐋","🐬","🐟","🐠","🐡","🦈","🐙","🦀","🦞","🦐","🦑","🐚","🐌","🦋","🐛","🐜","🐝","🐞","🦗","🕷","🕸","🦂","🦟","💐","🌸","💮","🏵","🌹","🥀","🌺","🌻","🌼","🌷","🌳","🌲","🎄","🌴","🌵","🌾","🌱","🌿","☘","🍀","🍁","🍂","🍃","🌑","🌒","🌓","🌔","🌕","🌖","🌗","🌘","🌙","🌚","🌛","🌜","🌡","☀","🌝","🌞","⭐","🌟","🌠","☁","⛅","⛈","🌤","🌥","🌦","🌧","🌨","🌩","🌪","🌫","🌬","💨","🌀","🌈","🌂","☂","☔","⛱","⚡","❄","☃","⛄","☄","🔥","💦","💧","🌊"],3:["👍🏻","👎🏻","👌🏻","✌🏻","🤞🏻","🤟🏻","🤘🏻","🤙🏻","🖕🏻","✊🏻","👊🏻","🤛🏻","🤜🏻","👈🏻","👉🏻","👆🏻","👇🏻","☝🏻","👋🏻","🤚🏻","🖐🏻","✋🏻","🖖🏻","👏🏻","🙌🏻","👐🏻","🤲🏻","🤝🏻","🙏🏻","💪🏻","🦵🏻","🦶🏻","👂🏻","👃🏻","🧠","🦷","🦴","👀","👁","👅","👄","✍🏻","💅🏻","🤳","👫","👭","👬","👩‍❤️‍💋‍👨","👨‍❤️‍💋‍👨","👩‍❤️‍💋‍👩","👩‍❤️‍👨","👨‍❤️‍👨","👩‍❤️‍👩","👪","👶","🧒","👦","👧","🧑","👱","👨","🧔","👱‍♂️","👨‍🦰","👨‍🦱","👨‍🦳","👨‍🦲","👩","👱‍♀️","👩‍🦰","👩‍🦱","👩‍🦳","👩‍🦲","🧓️","👴️","👵️","🙍‍♂️️","🙍‍♀️️","🙎‍♂️","🙎‍♀️️","🙅‍♂️","🙅‍♀️","🙆‍♂️","🙆‍♀️","💁‍♂️","💁‍♀️️","🙋‍♂️","🙋‍♀️️","🙇‍♂️","🙇‍♀️️","🤦‍♂️","🤦‍♀️","🤷‍♂️","🤷‍♀️","💆‍♂️️","💆‍♀️","💇‍♂️️","💇‍♀️","🚶‍♂️️","🚶‍♀️️","🏃‍♂️️","🏃‍♀️","💃","🕺","🕴️","👯‍♂️️","👯‍♀️","🧖‍♂️","🧖‍♀️️","👼","🎅","🤶","🦸‍♂️","🦸‍♀️","🦹‍♂️","🦹‍♀️","🧙‍♂️","🧙‍♀️","🧚‍♂️","🧚‍♀️","🧛‍♂️","🧛‍♀️","🧜‍♂️","🧜‍♀️","🧝‍♂️","🧝‍♀️","🧞‍♂️","🧞‍♀️","🧟‍♂️","🧟‍♀️","👨‍⚕️","👩‍⚕️","👨‍🎓","👩‍🎓","👨‍🏫","👩‍🏫","👨‍⚖️","👩‍⚖️","👨‍🌾","👩‍🌾","👨‍🍳","👩‍🍳","👨‍🔧","👩‍🔧","👨‍🏭","👩‍🏭","👨‍💼","👩‍💼","👨‍🔬","👩‍🔬","👨‍💻","👩‍💻","👨‍🎤","👩‍🎤","👨‍🎨","👩‍🎨","👨‍✈️","👩‍✈️","👨‍🚀","👩‍🚀","👨‍🚒","👩‍🚒","👮‍♂️","👮‍♀️","🕵️‍♂️","🕵️‍♀️","💂‍♂️","💂‍♀️","👷‍♂️","👷‍♀️","🤴","👸","👳‍♂️","👳‍♀️","👲","🧕","🤵","👰","🤰","🤱","🛀","🛌"],4:["🍏","🍎","🍐","🍅","🥝","🍑","🍒","🍓","🍇","🍈","🍉","🍊","🍋","🍌","🍍","🥭","🥥","🥑","🍆","🥔","🥕","🌽","🌶","🥒","🥬","🥦","🍄","🥜","🌰","🍞","🥐","🥖","🥨","🥯","🥞","🧀","🍖","🍗","🥩","🥓","🍔","🍟","🍕","🌭","🥪","🌮","🌯","🥙","🥚","🍳","🥘","🍲","🥣","🥗","🍿","🧂","🥫","🍱","🍘","🍙","🍚","🍛","🍜","🍝","🍠","🍢","🍣","🍤","🍥","🥮","🍡","🥟","🥠","🥡","🍦","🍧","🍨","🍩","🍪","🎂","🍰","🧁","🥧","🍫","🍬","🍭","🍮","🍯","🍼","🥛","☕","🍵","🍶","🍾","🍷","🍸","🍹","🍺","🍻","🥂","🥃","🥤","🥢","🍽","🍴","🥄"],5:["⚽","⚾","🥎","🏀","🏐","🏈","🏉","🎾","🥏","🎳","🏏","🏑","🏒","🥍","🏓","🏸","🥊","🥋","🥅","⛳","⛸","🎣","🎽","🛹","🎿","🛷","🥌","🎯","🎱","🎮","🕹","🎰","🎲","🧩","♟","🧗‍♂️️","🧗‍♀️","🤺","🏇","⛷","🏂","🏌️‍♂️","🏌️‍♀️","🏄‍♂️","🏄‍♀️","🚣‍♂️","🚣‍♀️","🏊‍♂️","🏊‍♀️","⛹️‍♂️","⛹️‍♀️","🏋️‍♂️","🏋️‍♀️","🚴‍♂️","🚴‍♀️","🚵‍♂️","🚵‍♀️","🤸","🤼‍♂️","🤼‍♀️","🤽‍♂️","🤽‍♀️","🤾‍♂️","🤾‍♀️","🤹‍♂️","🤹‍♀️","🧘‍♂️","🧘‍♀️","🎖","🏆","🏅","🥇","🥈","🥉"],6:["🚂","🚃","🚄","🚅","🚆","🚇","🚈","🚉","🚊","🚝","🚞","🚋","🚌","🚍","🚎","🚐","🚑","🚒","🚓","🚔","🚕","🚖","🚗","🚘","🚙","🚚","🚛","🚜","🏎","🏍","🛵","🚲","🛴","🚏","🛣","🛤","🛢","⛽","🚨","🚥","🚦","🛑","🚧","⚓","⛵","🛶","🚤","🛳","⛴","🛥","🚢","✈","🛩","🛫","🛬","💺","🚁","🚟","🚠","🚡","🛰","🚀","🛸","🌍","🌎","🌏","🌐","🗺","🗾","🧭","🏔","⛰","🌋","🗻","🏕","🏖","🏜","🏝","🏞","🏟","🏛","🏗","🧱","🏘","🏚","🏠","🏡","🏢","🏣","🏤","🏥","🏦","🏨","🏩","🏪","🏫","🏬","🏭","🏯","🏰","💒","🗼","🗽","⛪","🕌","🕍","⛩","🕋","⛲","⛺","🌁","🌃","🏙","🌄","🌅","🌆","🌇","🌉","♨","🌌","🎠","🎡","🎢","💈","🎪"],7:["🎙","🎚","🎛","🎤","🎧","📻","🎷","🎸","🎹","🎺","🎻","🥁","📯","🎭","🖼","🎨","🧵","🧶","🔮","🧿","🧸","🃏","🀄","🎴","🎃","🎆","🎇","🧨","✨","🎈","🎉","🎊","🎋","🎍","🎎","🎏","🎐","🎑","🧧","🎀","🎁","🎗","🎟","🎫","🛎","🧳","⌛","⏳","⌚","⏰","⏱","⏲","🕰","👓","🕶","🥽","🥼","👔","👕","👖","🧣","🧤","🧥","🧦","👗","👘","👙","👚","👛","👜","👝","🛍","🎒","👞","👟","🥾","🥿","👠","👡","👢","👑","👒","🎩","🎓","🧢","⛑","📿","💄","💍","💎","📱","📲","☎","📞","📟","📠","🔋","🔌","💻","🖥","🖨","⌨","🖱","🖲","💽","💾","💿","📀","🧮","🎥","🎞","📽","🎬","📺","📷","📸","📹","📼","🔍","🔎","🕯","💡","🔦","🏮","📔","📕","📖","📗","📘","📙","📚","📓","📒","📃","📜","📄","📰","🗞","📑","🔖","🏷","💰","💴","💵","💶","💷","💸","💳","🧾","💹","💱","💲","✉","💌","📧","📨","📩","📤","📥","📦","📫","📪","📬","📭","📮","🗳","✏","✒","🖋","🖊","🖌","🖍","📝","💼","📁","📂","🗂","📅","📆","🗒","🗓","📇","📈","📉","📊","📋","📌","📍","📎","🖇","📏","📐","✂","🗃","🗄","🗑","🔒","🔓","🔏","🔐","🔑","🗝","🔨","⛏","⚒","🛠","🗡","⚔","🔪","🔫","🏹","🛡","🔧","🔩","⚙","🗜","⚖","🔗","⛓","🧰","🧲","⚗","🧪","🧫","🧬","🔬","🔭","📡","💉","💊","🚪","🛏","🛋","🚽","🚿","🛁","🧴","🧷","🧹","🧺","🧻","🧼","🧽","🧯","🛒","🚬","⚰","⚱","🏺","🗿"],8:["💋","❤","💔","❣","💘","💝","💖","💗","💓","💞","💕","💟","💜","🧡","💛","💚","💙","🖤","💯","💢","💥","💫","🕳","💣","💬","👁️‍🗨️","🗨","🗯","💭","💤","🗣","👤","👥","👣","🔇","🔊","📢","📣","🔔","🔕","🎼","🎵","🎶","⚠","🚸","☢","☣","🆚","🆓","🆕","🚮","🚾","🚭","✅","♻","⚕","🔱","‼","⁉","❓","❗","🆘","⛔","🚫","🚳","🚯","🚱","🚷","📵","🔞"],9:["🇷🇺","🇰🇿","🇧🇾","🇺🇦","🇲🇳","🇬🇪","🇦🇿","🇹🇯","🇧🇷","🇱🇹","🇱🇻","🇪🇪","🇦🇲","🏁","🚩","🎌","🏴","🏳","🏳️‍🌈","🏴‍☠️","🇦🇨","🇦🇩","🇦🇪","🇦🇫","🇦🇬","🇦🇮","🇦🇱","🇦🇴","🇦🇶","🇦🇷","🇦🇸","🇦🇹","🇦🇺","🇦🇼","🇦🇽","🇧🇦","🇧🇧","🇧🇩","🇧🇪","🇧🇫","🇧🇬","🇧🇭","🇧🇮","🇧🇯","🇧🇱","🇧🇲","🇧🇳","🇧🇴","🇧🇶","🇧🇸","🇧🇹","🇧🇻","🇧🇼","🇧🇿","🇨🇦","🇨🇨","🇨🇩","🇨🇫","🇨🇬","🇨🇭","🇨🇮","🇨🇰","🇨🇱","🇨🇲","🇨🇳","🇨🇴","🇨🇵","🇨🇷","🇨🇺","🇨🇻","🇨🇼","🇨🇽","🇨🇾","🇨🇿","🇩🇪","🇩🇬","🇩🇯","🇩🇰","🇩🇲","🇩🇴","🇩🇿","🇪🇨","🇪🇬","🇪🇭","🇪🇷","🇪🇸","🇪🇹","🇪🇺","🇫🇮","🇫🇯","🇫🇰","🇫🇲","🇫🇴","🇫🇷","🇬🇦","🇬🇧","🇬🇩","🇬🇫","🇬🇬","🇬🇭","🇬🇮","🇬🇱","🇬🇲","🇬🇳","🇬🇵","🇬🇶","🇬🇷","🇬🇸","🇬🇹","🇬🇺","🇬🇼","🇬🇾","🇭🇰","🇭🇲","🇭🇳","🇭🇷","🇭🇹","🇭🇺","🇮🇨","🇮🇩","🇮🇪","🇮🇱","🇮🇲","🇮🇳","🇮🇴","🇮🇶","🇮🇷","🇮🇸","🇮🇹","🇯🇪","🇯🇲","🇯🇴","🇯🇵","🇰🇪","🇰🇬","🇰🇭","🇰🇮","🇰🇲","🇰🇳","🇰🇵","🇰🇷","🇰🇼","🇰🇾","🇱🇦","🇱🇧","🇱🇨","🇱🇮","🇱🇰","🇱🇷","🇱🇸","🇱🇺","🇱🇾","🇲🇦","🇲🇨","🇲🇩","🇲🇪","🇲🇫","🇲🇬","🇲🇭","🇲🇰","🇲🇱","🇲🇲","🇲🇴","🇲🇵","🇲🇶","🇲🇷","🇲🇸","🇲🇹","🇲🇺","🇲🇻","🇲🇼","🇲🇽","🇲🇾","🇲🇿","🇳🇦","🇳🇨","🇳🇪","🇳🇫","🇳🇬","🇳🇮","🇳🇱","🇳🇴","🇳🇵","🇳🇷","🇳🇺","🇳🇿","🇴🇲","🇵🇦","🇵🇪","🇵🇫","🇵🇬","🇵🇭","🇵🇰","🇵🇱","🇵🇲","🇵🇳","🇵🇷","🇵🇸","🇵🇹","🇵🇼","🇵🇾","🇶🇦","🇷🇪","🇷🇴","🇷🇸","🇷🇼","🇸🇦","🇸🇧","🇸🇨","🇸🇩","🇸🇪","🇸🇬","🇸🇭","🇸🇮","🇸🇯","🇸🇰","🇸🇱","🇸🇲","🇸🇳","🇸🇴","🇸🇷","🇸🇸","🇸🇹","🇸🇻","🇸🇽","🇸🇾","🇸🇿","🇹🇦","🇹🇨","🇹🇩","🇹🇫","🇹🇬","🇹🇭","🇹🇰","🇹🇱","🇹🇲","🇹🇳","🇹🇴","🇹🇷","🇹🇹","🇹🇻","🇹🇼","🇹🇿","🇺🇬","🇺🇲","🇺🇳","🇺🇸","🇺🇾","🇺🇿","🇻🇦","🇻🇨","🇻🇪","🇻🇬","🇻🇮","🇻🇳","🇻🇺","🇼🇫","🇼🇸","🇽🇰","🇾🇪","🇾🇹","🇿🇦","🇿🇲","🇿🇼"]},n=Object.keys(s).reduce(((e,t)=>(e[t]=s[t].map((e=>(0,o.emojiSymbolToByteHex)(e))),e)),{})},933943:(e,t,i)=>{function o(e){if(!e||"string"!=typeof e)return null;const t=e.match(/(photo|doc)(-?\d+)_(\d+)/);if(!t)return null;const i=t[1],o=parseInt(t[2]),s=parseInt(t[3]),n=[o,s].join("_");return{type:i,ownerId:o,id:s,rawId:n}}function s(e,t){let i=e;e>68&&(i=68),t>68&&(i=68*e/t);return[i,i*(t/e)]}function n(e,t,i){if(!e||!t||!i)return null;const o=Object.values(e).sort(((e,t)=>e[1]-t[1]||e[2]-t[2]));return o.find((e=>e[1]>=t&&e[2]>=i))||o[parseInt(o.length/2)]||o[0]}i.d(t,{getPhotoSize:()=>n,parseAttachmentId:()=>o,prepareImageBounds:()=>s})},783098:(e,t,i)=>{i.d(t,{default:()=>p});var o=i(434788),s=i(241312),n=i(95432);const r=["мне","тебе","ему","ей","маме","папе","сестре","брату","родителям"],c=["ден(?:ьги|ежки|ьгу|ежку|ег|ежек|як)","дол(?:г|жок)","(?:(?:в|на)\\s)подар(?:ок|ки)"],a=["переводом","(?:(?:по|на)\\s)(?:номеру?\\s)?(?:карт(?:у|очку|ы|очки)|тел(?:ефона)?)","(?:по\\s)?безнал(?:у|ичке|ом|ичкой)","на\\sсбер(?:банк)?"],l=["сот(?:оч)ку","\\d+(?:\\s*р(?:[.,\\s]|уб(?:лей)?|$))?"],_=new RegExp(`(${l.join(")|(")})`);function d(e,t){return"amount"===e?function(e){const t=e.match(_);if(t){if(t[1])return 100;if(t[2])return parseInt(t[2])}return 0}(t):t}const u=new RegExp(`^(?:(${["(?:за|с|пере)?кин(?:ь(?:ся)?|ьте(?:сь)?|ешь(?:ся)?|ете(?:сь)?)","переве(?:ди|дите|дешь|дете)","отправ(?:ь|ьте|ишь|ите)","соб(?:ери|ерите|ерешь|ерете)","(?:от)?да(?:й|йте|шь|дите)","верн(?:и|ите|ешь|ете)","возвра(?:ти|тите|тишь|щай|щайте)","займ(?:и|ите|ешь)"].join("|")})|(${["перевод","(?:за|с|пере)?кин(?:уть(?:ся)?|у(?:сь)?|ем(?:ся)?)","переве(?:сти|вожу|дим|ду|ем)","отправ(?:ить|ляю|ляем|лю|им)","(?:со)?б(?:рать|ираю|ираем|еру|ерем)","(?:от)?да(?:ть|ю|ем|м|дим)","верн(?:уть|у|ем)","возвра(?:тить|щу|тим|щаю|щаем)"].join("|")}))((?:\\s+(?:${[...r,...c,...a,...l].join("|")}))+)\\s*$`),m=new RegExp(`(${r.join("|")})|(${c.join("|")})|(${a.join("|")})|(${l.join("|")})`,"gi"),h={DEFAULT_QUERY:"деньги",introViewed:!1,match:function(e,t=0){let i=e.toLowerCase().replace(/ё/g,"е").match(u);if(i){const t={input:e,request:i[1],send:i[2],context:i[3]};for(;i=m.exec(t.context),i;){const e={receiver:i[1],subject:i[2],method:i[3],amount:i[4]};for(const[i,o]of Object.entries(e))o&&(t[i]=d(i,o))}if(t.subject||t.method||t.amount)return t}return null},setIntroViewed:function(e){this.introViewed=e},onClick:function(e,t,i,r=0,c={}){if(this.introViewed){const o=[e,t,i,r].join("_");s.MoneyTransfer.showMoneyTransferBox({tab:i,amount:r,owner_id:e,to_id:t,from:"sticker_link"},{cache:this.lastBoxId===o},void 0,(()=>{cur.paymentsOptions&&(cur.paymentsOptions.onSendStart=c.onSendStart)})),this.lastBoxId=o}else(0,n.showWiki)((0,o._)({w:"moneysend_promo",fromId:e,toId:t,action:i},r?{amount:r}:{})),this.introViewed=!0}},p=h},824478:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{tooltips:()=>tooltips});var _shared_lib_common__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(664988),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(953908),_web_lib_fx__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(893106),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(82161),_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(795558),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(643897);const tooltips={show:function(el,options){if(window.AudioPage&&window.AudioPage.forceFix&&window.AudioPage.forceFix(),el.hidetimer)return el.hidetimer&&clearTimeout(el.hidetimer),void(el.hidetimer=0);if(!el.tt)return;if("object"==typeof el.tt&&(el.tt.shown=!1),el.ttimer&&clearTimeout(el.ttimer),(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isFunction)(options.text)){const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domByClass)(el.tt.container,"tt_text");if(e){const t=options.text();if(!t)return;e.innerHTML=t}}const opts=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.extend)(el.tt.opts?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.clone)(el.tt.opts):{},options||{}),isNewTT=void 0!==opts.dir;if(!el.tt.el)return el.tt="show",void(el.ttimer=setTimeout((function(){if(el.tt.el)return opts.showdt=0,void tooltips.show(el,opts);el.tt="shownow"}),opts.showdt||0));let canshow;if(opts.js){const evalString="(function(){return function(){var tip=this;"+opts.js+"};})()";try{const evalResult=eval(evalString),evalApply=evalResult.apply(el.tt);canshow=!1!==evalApply}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_5__.logEvalError)(e,evalString)}}else canshow=!0;canshow&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isVisible)(el.tt.container)?el.tt.showing||(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_2__.animate)(el.tt.container,{opacity:1},void 0!==opts.showsp?opts.showsp:200):el.ttimer=setTimeout((function(){const e=el.tt.container;if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isVisible)(e))return;const t=opts.forcexy?opts.forcexy:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getXY)(el),i=opts.forcesize?opts.forcesize:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)(el,!1,!0);let o=opts.toup;const s=vk.rtl&&!opts.asrtl||opts.asrtl&&!vk.rtl,n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.ge)("page_header_wrap")&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isAncestor)(el,"page_layout")?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)("page_header_wrap"):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.ge)("ads-app-header")?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)("ads-app-header"):[0,0];if(!i[0]&&!i[1])return void(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hide)(el.tt.container);e.style.opacity=0,opts.width&&(e.style.width=opts.width+"px"),opts.maxWidth&&(e.style["max-width"]=opts.maxWidth+"px"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.show)(e),isNewTT||(e.firstChild.className="toup"+(opts.toup?1:""));let r=opts.shift;(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isFunction)(r)&&(r=r()),void 0!==r&&2==r.length&&r.push(r[1]);let c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domPN)(e);const a=document.body.scrollTop||htmlNode.scrollTop||0;let l=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)(e);const _=t[1]-l[1]-r[1]-n[1]-a,d=lastWindowHeight-(t[1]+i[1]+l[1]+r[2])+a,u=_<0,m=d<0;let h=_<0;u&&m?(_>d&&_+a>0&&(o=!0,h=!1),o&&h?o=!1:o||!m||h||(o=!0)):o&&u?o=!1:o||!m||u||(o=!0);let p=opts.needLeft||(opts.black||opts.checkLeft)&&window.lastWindowWidth&&lastWindowWidth-(t[0]+(s?i[0]+r[0]:l[0]-r[0]))<1,f="";opts.forceright&&(p=0),opts.forcetodown&&(o=!1),opts.forcetoup&&(o=!0),isNewTT?((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.removeClass)(e,"tt_up"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.removeClass)(e,"tt_down"),f=opts.dir&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.inArray)(opts.dir,["up","down","left","right"])?"tt_"+opts.dir:"tt_"+(o?"down":"up"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.addClass)(e,f),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.toggleClass)(e,"toleft",!!p),l=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)(e)):(f="toup"+(o?1:""),(o!=opts.toup||p)&&(f+=p?" toleft":"",l=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)(e)),e.firstChild.className=f,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.addClass)(e,o?"tt_toup":""));const k=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getXY)(c);if(t[0]-=k[0],t[1]-=k[1],el.tt.zIndexEls=[],!opts.noZIndex)for(;c&&c!=document.body&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hasClass)(c,"scroll_fix");){const e=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getStyle)(c,"zIndex")),t=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(c.ttCount);if(e&&!t)break;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.setStyle)(c,"zIndex",opts.zIndex||100),el.tt.zIndexEls.push(c),c.ttCount=t+1,c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domPN)(c)}let g;g=isNewTT?!(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.inArray)(opts.dir,["left","right"])||opts.forcetoup||opts.forcetodown?o?t[1]-(l[1]+r[1]):t[1]+i[1]+r[2]:t[1]-Math.floor(l[1]/2)-r[1]:t[1]+(o?-(l[1]+r[1]):i[1]+r[2]);const w=g+(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(opts.slide)*(o?-1:1);let S=t[0]+(s?r[0]+i[0]-l[0]:o?-r[0]:-(r[3]||r[0]));p&&(S-=(l[0]-(opts.reverseOffset||39))*(s?-1:1)),opts.center&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.addClass)(e,"tocenter"),l[0]!=i[0]&&(S-=s?0:(l[0]-i[0])/2));const E=S+(s?-1:1)*(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(opts.slideX);if(opts.showIfFit&&(S+k[0]<0||S+k[0]+l[0]>lastWindowWidth||g+k[1]<0||g+k[1]+l[1]>lastWindowHeight))return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hide)(el.tt.container);el.tt.showing=!0,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.setStyle)(e,{top:w,left:E});const v={opacity:1};E!=S&&(v.left=S),w!=g&&(v.top=g),(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_2__.animate)(e,v,void 0!==opts.showsp?opts.showsp:200,(function(){el.tt&&el.tt.showing&&(el.tt.showing=!1),opts.onShowEnd&&opts.onShowEnd(),"object"==typeof el.tt&&el.tt&&(el.tt.shown=!0)})),opts.onShowStart&&opts.onShowStart(el.tt)}),opts.showdt||0))},clearZindex:function(e){e.tt&&e.tt.opts&&e.tt.zIndexEls&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.each)(e.tt.zIndexEls,(function(){const e=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(this.ttCount);e<=1?((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.setStyle)(this,"zIndex",""),this.ttCount=0):this.ttCount=e-1}))},hide:function(e,t){if("shownow"!==e.tt){if(e.tt&&"object"==typeof e.tt&&(e.tt.shown=!1),(t||{}).fasthide)return clearTimeout(e.hidetimer),clearTimeout(e.ttimer),e.hidetimer=0,e.tt&&e.tt.el&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hide)(e.tt.container),void tooltips.clearZindex(e);e.hidetimer||(e.hidetimer=setTimeout((function(){if(e.hidetimer=0,clearTimeout(e.ttimer),!e.tt||"hide"==e.tt||e.tt.el&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isVisible)(e.tt.container))return e.tt&&e.tt.el&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hide)(e.tt.container),void tooltips.clearZindex(e);const i=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.extend)(e.tt.opts?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.clone)(e.tt.opts):{},t||{});e.tt.el?e.ttimer=setTimeout((function(){i.hasover||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.setStyle)(e.tt.container,{pointerEvents:"none"}),(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_2__.fadeOut)(e.tt.container,void 0!==i.showsp?i.showsp:200,(function(){e.tt&&e.tt.container&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.setStyle)(e.tt.container,{pointerEvents:"auto"}),tooltips.clearZindex(e)})),i.onHide&&i.onHide()}),i.hidedt||0):e.tt="hide"}),1))}},hideAll:function(e){if(cur.tooltips)for(let t=0;t<cur.tooltips.length;++t){const i=cur.tooltips[t];e&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isAncestor)(i.el,e)||(i.opts.forceNoHide||(i.el&&i.el.ttimer&&clearTimeout(i.el.ttimer),i.hide({fasthide:!0})))}},rePositionTT:function(e){if(!e)return;const t=e.opts,i=e.el,o=e.container,s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getXY)(i),n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)(i,!1,!0);if(!n[0]&&!n[1])return;const r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)(o),c=t.needLeft||t.black&&lastWindowWidth&&lastWindowWidth-(s[0]+r[0])<1,a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hasClass)(o.firstChild,"toup1")||t.toup||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hasClass)(o,"tt_down");let l=t.shift;const _=vk.rtl&&!t.asrtl||t.asrtl&&!vk.rtl;(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isFunction)(l)&&(l=l());const d=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getXY)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domPN)(o));s[0]-=d[0],s[1]-=d[1];let u=s[0]+(_?l[0]+n[0]-r[0]:a?-l[0]:-(l[3]||l[0]));c&&(u-=r[0]-39),t.center&&r[0]!=n[0]&&(u-=(r[0]-n[0])/2);const m=s[1]+(a?-(r[1]+l[1]):n[1]+l[2]);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.setStyle)(o,{left:u,top:m})},rePositionAll:function(){if(cur.tooltips)for(let e=0;e<cur.tooltips.length;++e){const t=cur.tooltips[e].opts;t&&(t.nohideover||t.nohide)&&tooltips.rePositionTT(cur.tooltips[e])}},destroy:function(e){if(e){if(clearTimeout(e.ttimer),clearTimeout(e.hidetimer),e.tt&&e.tt.el){if(e.tt.onClean&&e.tt.onClean(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.cleanElems)(e.tt.container),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.removeEvent)(e,"mouseout",e.tthide),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.removeEvent)(e,"click",e.tthide),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.removeEvent)(window,"scroll",e.tthide),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.removeEvent)(document,"click",e.tthide),e.tt.container){const t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domPN)(e.tt.container);t&&t.removeChild(e.tt.container)}tooltips.clearZindex(e),e.tt.el=!1}(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.removeAttr)(e,"tt","tthide","ttimer","hidetimer")}},destroyAll:function(e){if(cur.tooltips){for(let t=0;t<cur.tooltips.length;++t)e&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isAncestor)(cur.tooltips[t].el,e)||cur.tooltips[t].destroy();e||delete cur.tooltips}},create:function(e,t){let i;void 0!==t.shift&&2==t.shift.length&&t.shift.push(t.shift[1]);const o=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.extend)({shift:t.black?[11,8,8]:void 0!==t.dir?[2,8,8]:[2,3,3],toup:!0},t);t.black&&!o.dir&&(o.dir="auto",o.typeClass="tt_black"),e.tthide||(e.tthide=tooltips.hide.pbind(e),t.nohide||((0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(e,"mouseout",e.tthide),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(window,"scroll",e.tthide),t.hideOnTooltipContainerClick||(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(e,"click",e.tthide),t.hasover||(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(document,"click",e.tthide)));const s=o.no_shadow?" tt_no_shadow":"";if(!o.content){if(e.tt&&!o.force)return e.hidetimer?(clearTimeout(e.hidetimer),void(e.hidetimer=0)):void 0;if(!o.text){if(!o.url)return;return clearTimeout(e.ttimer),void(e.ttimer=setTimeout((function(){e.tt="show",ajax.post(o.url,o.params||{},{onDone:function(t,i){const s=e.tt,n=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.clone)(o);(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.extend)(n,{content:t||"",js:i}),tooltips.create(e,n),"shownow"==s&&tooltips.show(e,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.extend)(n,{showdt:0}))},onFail:function(){return!0},cache:o.cache||0}),tooltips.show(e,o)}),o.ajaxdt||0))}o.content='<div class="tt_text">'+((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isFunction)(o.text)?o.text():o.text),o.link&&(o.content+='<br /><a style="display: flex; margin-top: 8px" target="_blank" href="'+o.link.link+'">'+o.link.text+"</a>"),o.content+="</div>"}let n;n=void 0!==o.dir?"tt_w":"tt";const r=n+" "+(void 0!==o.dir?o.typeClass||"tt_default":"")+" "+(o.className||"");if(e.tt&&e.tt.el){const i=e.tt.container;e.tt.onClean&&e.tt.onClean(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.geByClass1)("wrapped",i).innerHTML=o.content,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.extend)(e.tt,{opts:o,show:tooltips.show.pbind(e,t)}),i.className=r,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hide)(i)}else{let n;n=o.black?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.ce)("div",{innerHTML:o.content,className:r},{display:"none"}):void 0!==o.dir?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.ce)("div",{innerHTML:'<div class="wrapped">'+o.content+"</div>",className:r+s},{display:"none"}):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.ce)("div",{innerHTML:`<table cellspacing="0" cellpadding="0">\n    <tr><td colspan="3" class="tt_top"><div class="top_pointer"></div></td></tr>\n    <tr>\n      <td class="side_sh"></td>\n      <td class="outer"><table cellspacing="0" cellpadding="0">\n        <tr><td class="side_sh"></td>\n          <td class="wrapped">${o.content}</td>\n        <td class="side_sh"></td></tr>\n        <tr><td colspan="3"><div class="bottom_sh"></div></td></tr>\n      </table></td>\n      <td class="side_sh"></td>\n    </tr>\n    <tr><td colspan="3" class="tt_bottom"><div class="bottom_sh"></div><div class="bottom_pointer${s}"></div></td></tr>\n  </table>`,className:r},{display:"none"});let c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domPN)(e);if(t.appendEl)c=t.appendEl;else if(t.appendParentCls)c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domClosest)(t.appendParentCls,c);else if(c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domClosest)("tt_w",c)||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domClosest)("tt_default",c),!c)do{c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domClosestPositioned)(c||e,{noOverflow:!0})}while((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hasClass)(c,"tt_noappend"));c||(c=document.body),c.appendChild(n),i=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.extend)({el:e,opts:o,show:tooltips.show.pbind(e,t),hide:e.tthide,destroy:tooltips.destroy.pbind(e),container:n},o.tip||{}),o.nohideover||o.text&&!o.hasover||((0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(n,"mouseover",i.show),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(n,"mouseout",i.hide)),o.hideOnTooltipContainerClick&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(n,"click",i.hide),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.removeClass)(i.container,"fixed"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.setStyle)(i.container,{position:"absolute"}),e.tt=i,cur.tooltips||(cur.tooltips=[]),cur.tooltips.push(i)}o.init&&o.init(i)},addAudio:function(e,t,i,o){ajax.post("audio.php",{act:"a_add",oid:t,aid:i,hash:o},{onDone:function(){e.parentNode.replaceChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.ce)("div",{className:"fl_r add_audio_plus done"}),e)},onFail:function(){return!0},showProgress:function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hide)(e.nextSibling),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.show)(e.previousSibling)},hideProgress:function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hide)(e.previousSibling),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.show)(e.nextSibling)}})}}}}]);try{stManager.done("dist/a1258c00747aa03727abf8c40b9e7df9.19b8bde02a621624127c.js")}catch(e){}